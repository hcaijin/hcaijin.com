<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>hcaijin.com</title>
  
  <subtitle>Graz&#39;s Blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://hcaijin.com/"/>
  <updated>2020-07-04T08:54:27.806Z</updated>
  <id>http://hcaijin.com/</id>
  
  <author>
    <name>Graz</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Nexus6p虚焊导致无限重启之救砖教程</title>
    <link href="http://hcaijin.com/bootlooping-nexus6p-fix/"/>
    <id>http://hcaijin.com/bootlooping-nexus6p-fix/</id>
    <published>2020-07-03T06:44:06.000Z</published>
    <updated>2020-07-04T08:54:27.806Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>前两天手机在使用过程中，无故死机，重启发现在logo显示画面停留一会儿又重启，后面就一直不断的循环这个过程。<br>本来以为重新做系统就好了，没想到再还原回去还是一样。我以为就这么变砖了，最后还是因为穷的力量，搜索nexus6p无限重启原因就发现原来这是由于前几天我手机摔过一次，可能导致cpu虚焊部分出了毛病，才导致现在手机无限重启的情况。<br>没办法，通过这几天各种google，终于找到网络上很多大神都有解决的方案，后面后提供大神帖子链接。</p></blockquote><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ul><li>备份当前的文件和数据</li><li>在手机上启用USB调试和OEM解锁</li><li>下载<a href="https://developer.android.com/studio/releases/platform-tools.html" target="_blank" rel="noopener">ADB驱动程序</a>，安装到你的PC机里。这里有个问题，要安装低版本的，大于29.0的版本再使用时报了个错误,提示找不到可用的命令，网上解决方法就是下载安装26.0版本的解决了这个问题。</li><li>去这里<a href="https://twrp.me/Devices/" target="_blank" rel="noopener">下载</a>符合nexus6p的TWRP，这里我下载了3.3.1版本的</li><li>去magisk官网下载最新版本应用包括manage</li><li>下载要用到的刷机固件<a href="https://androidfilehost.com/?w=files&flid=302684" target="_blank" rel="noopener">Lineage OS</a>，<a href="https://developers.google.com/android/ota#angler" target="_blank" rel="noopener">原厂镜像 Nexus6p</a></li><li>下载我打包的要用到的boot.img</li></ul><h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><blockquote><p>由于已经进入不了系统了，备份需要链接USB进到REF里使用这个方法<code>adb pull sdcard</code>备份自己重要的数据</p></blockquote><h1 id="开始刷系统"><a href="#开始刷系统" class="headerlink" title="开始刷系统"></a>开始刷系统</h1><blockquote><p>这里要提一点，一开始我找到的方法是刷指定原厂镜像，刷写4核boot.img就可以重新进入系统。后面又找到不一定原厂镜像的版本，比如lingage17.1的镜像也可以通过大神的方法。<br>所以，这两种方法都可以解决无限重启进不了系统的问题，我都写在这里，只要看一种方法就好了。</p></blockquote><h2 id="第一种方法：刷原厂镜像"><a href="#第一种方法：刷原厂镜像" class="headerlink" title="第一种方法：刷原厂镜像"></a>第一种方法：刷原厂镜像</h2><blockquote><p>先说一下刷原厂镜像7.1.2版本号n2g48c,<a href="https://bbs.gfan.com/android-9270440-1-1.html" target="_blank" rel="noopener">参考文档</a>,<a href="https://forum.xda-developers.com/nexus-6p/general/guide-fix-nexus-6p-bootloop-death-blod-t3640279" target="_blank" rel="noopener">英文原档</a></p></blockquote><ul><li>具体怎么刷参考文档里已经写得很清楚了，主要说一下，如果没有刷过twrp的先刷这个<code>fastboot flash recovery twrp3_1_1_4Cores.img</code></li><li>先线刷7.1.2, 具体线刷的操作，即进入TWRP界面，选Advanced再点sideload，滑块确认，等待pc端执行<code>adb sideload angler-ota-n2g48c-b004b71e.zip</code></li><li>接下来刷入修改版本的boot:<code>adb flash boot 6p48C.img</code></li><li>如果前面你先刷twrp就不用再刷一次了。</li><li>最后就是进入twrp卡刷性能包6pEX4_1_2.zip。具体操作：把zip包上传到手机sdcard,在twrp界面选择install指定的zip包安装，一路下一步就可以了。如果需要优化就得自己研究其他选项了。</li><li>以上就可以完美开机了。</li></ul><h2 id="第二种方法：刷第三方镜像lineage-17-1"><a href="#第二种方法：刷第三方镜像lineage-17-1" class="headerlink" title="第二种方法：刷第三方镜像lineage 17.1"></a>第二种方法：刷第三方镜像lineage 17.1</h2><blockquote><p>理论上刷其他所有的镜像都可以使用这个方法重进系统。<a href="https://forum.xda-developers.com/nexus-6p/general/bootloop-death-blod-workaround-zip-t3819515" target="_blank" rel="noopener">参考文档</a></p></blockquote><ul><li>下载重要的改写cpu核心的软件<a href="https://androidfilehost.com/?w=files&flid=312881" target="_blank" rel="noopener">N5x-6P_BLOD_Workaround_Injector_Addon-AK3-signed</a></li><li>USB链接手机，使用命令<code>adb reboot bootloader</code>重启</li><li>进入原先系统已经刷过twrp的可以直接进入twrp线刷lineage 17.1<code>adb sideload lineage-17.1-20200308-UNOFFICIAL-angler.zip</code> <a href="https://forum.xda-developers.com/nexus-6p/orig-development/rom-lineageos-17-0-nexus-6p-angler-t4012099" target="_blank" rel="noopener">参考文档</a></li><li>刷写twrp <code>fastboot flash recovery twrp-3.3.1-0-fbe-4core-angler.img</code></li><li>然后进入REC模式，上传zip包到sdcard,线刷Addon-AK3.signed.zip这个包<code>adb sideload N5X-6P_BLOD_Workaround_Injector_Addon-AK3-signed.zip</code></li><li>最后重启，等待一会儿就可以进入系统了。</li></ul><h3 id="解决指纹功能bug问题"><a href="#解决指纹功能bug问题" class="headerlink" title="解决指纹功能bug问题"></a>解决指纹功能bug问题</h3><blockquote><p>就上一篇文章，我再刷PixelExperience时已经提到过，使用magisk安装补丁的方法重新刷boot就好了。<a href="https://topjohnwu.github.io/Magisk/install.html" target="_blank" rel="noopener">参考文档</a></p></blockquote><ul><li>上传boot-17.img到手机<code>adb push boot-17.img sdcard/</code></li><li>在手机里安装最新版本的magisk manager</li><li>打开magisk点击安装-&gt;安装-&gt;选择要安装的boot-17.img</li><li>magisk manager 将生成新的文件magisk_patched.img到sdcard/Download/</li><li>下载这个补丁到PC机<code>adb pull /sdcard/Download/magisk_patche.img</code></li><li>最后重启进入bootloader刷写这个补丁<code>fastboot flash boot magisk_patched.img</code></li><li>以上完成就可以重进系统使用指纹的功能了。</li></ul><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><blockquote><p>其实这两个方法最主要是线刷的zip包不同，第二种方法里的AK3包实现了任何系统修改cpu4核心的方法。</p></blockquote><h1 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h1><blockquote><p>我打包了一下所有要用到的软件（不包括原厂镜像包，这些都可以去官网下载)，防止原链接失效。<a href="https://drive.google.com/file/d/1Bd4nASTMve23qh28x3BR3OJWJp2NZJyI/view?usp=sharing" target="_blank" rel="noopener">备份包</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;blockquote&gt;&lt;p&gt;前两天手机在使用过程中，无故死机，重启发现在logo显示画面停留一会儿又重启，后面就一直不断的循环这个过程。&lt;br&gt;
      
    
    </summary>
    
    
    
      <category term="bootloop" scheme="http://hcaijin.com/tags/bootloop/"/>
    
      <category term="nexus6p" scheme="http://hcaijin.com/tags/nexus6p/"/>
    
      <category term="android" scheme="http://hcaijin.com/tags/android/"/>
    
      <category term="magisk" scheme="http://hcaijin.com/tags/magisk/"/>
    
  </entry>
  
  <entry>
    <title>Nexus6p Root提权以及刷机攻略</title>
    <link href="http://hcaijin.com/root-nexus6p-use-twrp-magisk/"/>
    <id>http://hcaijin.com/root-nexus6p-use-twrp-magisk/</id>
    <published>2020-03-25T10:00:20.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>Android 10.0也出来一段时间了，想着给自己的手机刷一下。所以就有了这个攻略，记录一下过程。</p></blockquote><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><ul><li>确保设备电池电量超过50%</li><li>备份当前的文件和数据</li><li>在手机上启用USB调试和OEM解锁</li><li>下载ADB驱动程序，安装到你的PC机里</li><li>去这里<a href="https://twrp.me/Devices/" target="_blank" rel="noopener">下载</a>符合nexus6p的TWRP，这里我下载了3.3.1版本的</li><li>去magisk官网下载最新版本应用包括manage</li><li>下载刷机的固件<a href="https://download.pixelexperience.org/angler" target="_blank" rel="noopener">PixelExperience 10</a></li></ul><h1 id="使用ADB和Fastboot解锁Bootloader"><a href="#使用ADB和Fastboot解锁Bootloader" class="headerlink" title="使用ADB和Fastboot解锁Bootloader"></a>使用ADB和Fastboot解锁Bootloader</h1><p>打开终端运行如下命令重启手机到fastboot模式，<a href="https://developers.google.com/android/images" target="_blank" rel="noopener">参考</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br><span class="line">fastboot flashing unlock</span><br></pre></td></tr></table></figure><p>完成以后，就成功解锁了Bootloader，再次检查以启用“开发人员选项”，然后转到“开发人员选项”并启用USB调试模式OEM解锁。有时，他们在启动后会自行禁用。</p><h1 id="安装TWRP"><a href="#安装TWRP" class="headerlink" title="安装TWRP"></a>安装TWRP</h1><p>还是一样先进到启动模式，把TWRP镜像刷进recovery,如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb reboot bootloader</span><br><span class="line">fastboot flash recovery twrp-3.3.1-0-angler.img</span><br></pre></td></tr></table></figure><blockquote><p>完成上面两个准备刷机的步骤基本上就不用担心手机变砖了，下面开始刷机</p></blockquote><h1 id="刷PixelExperience-10-到Nexus6p"><a href="#刷PixelExperience-10-到Nexus6p" class="headerlink" title="刷PixelExperience 10 到Nexus6p"></a>刷PixelExperience 10 到Nexus6p</h1><p>首先确保Nexus6p没有刷过其他第三方Rom，如果刷过，要先通过官方Rom还原到指定<a href="https://developers.google.com/android/images#angler" target="_blank" rel="noopener">版本</a><br>这里我们需要下载8.1.0 (OPM7.181205.001, Dec 2018)版本，解压进入文件夹执行shell就可以还原了。当然首先还得USB链接成功。</p><h2 id="刷入Pixel-10固件"><a href="#刷入Pixel-10固件" class="headerlink" title="刷入Pixel 10固件"></a>刷入Pixel 10固件</h2><p>确保nexus6p是最新版本8.1.0以后，我们就可以通过TWRP刷入Pixel这个最新的固件了</p><p>重启手机，进入手机端的TWRP界面，点选Advanced选项，然后在手机界面里点选ADB sideload选项，然后滑动下面的滑块确认选择，等待电脑端执行adb sideload 刷机包名.zip命令</p><p>这里有一点要注意，下载固件的时候要把版本10的两个文件都下载了，因为最新的那版本指纹，锁屏功能有问题。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">unzip -x PixelExperience_angler-10.0-20191231-1607-OFFICIAL.zip -d piexl2019</span><br><span class="line">unzip -x PixelExperience_angler-10.0-20200101-0925-OFFICIAL.zip -d piexl2020</span><br><span class="line">cp piexl2019&#x2F;boot.img piexl2020</span><br><span class="line">cd piexl2020</span><br><span class="line">zip -r -v -o pixel20200101.zip .</span><br></pre></td></tr></table></figure><p>完成以上，生成我们要刷入的pixel20200101.zip这个固件包了，可以进入TWRP界面三清数据以后线刷就OK了<br>这里的三清指的是擦除system &amp; data &amp; cache 这三个分区，还有格式化data分区<br>最后执行以下，重启就能进入新系统了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb sideload pixel20200101.zip</span><br></pre></td></tr></table></figure><p>到这里，如果不需要Root手机的话就不用看下面的了</p><h1 id="Root提权"><a href="#Root提权" class="headerlink" title="Root提权"></a>Root提权</h1><p><a href="https://www.youtube.com/watch?v=3pxOeiIBrHI&t=582s" target="_blank" rel="noopener">参考</a><br>首先进到新系统（别忘了还是要先开启开发者选项）安装magisk manager这个app,把上一步解压出来的boot.img复制到手机里</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb push boot.img &#x2F;sdcard&#x2F;</span><br></pre></td></tr></table></figure><p>操作magisk manager安装magisk的补丁，生成magisk_patched.img<br>把补丁下载回PC</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb pull &#x2F;sdcard&#x2F;Download&#x2F;magisk_patched.img .</span><br></pre></td></tr></table></figure><p>重启手机进入快速启动模式,把补丁刷入boot</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash boot magisk_patched.img</span><br></pre></td></tr></table></figure><p>最后重启手机，进入magisk manager检查root权限。</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://forum.xda-developers.com/nexus-6p/development/rom-pixel-experience-t3970525" target="_blank" rel="noopener">PixelExperience for Google Nexus 6P 【angler】</a></li><li><a href="https://forum.xda-developers.com/nexus-6p/orig-development/rom-lineageos-17-0-nexus-6p-angler-t4012099" target="_blank" rel="noopener">【ROM】【UNOFFICIAL】LineageOS 17.1 for Nexus 6P (angler)</a></li><li><a href="https://mikey2008.github.io/2019/12/31/%E3%80%90%E6%95%99%E7%A8%8B%E3%80%91%E4%B8%80%E5%8A%A05%E5%88%B7LineageOS%E5%85%A8%E8%BF%87%E7%A8%8B/" target="_blank" rel="noopener">【教程】一加5刷LineageOS全过程</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;Android 10.0也出来一段时间了，想着给自己的手机刷一下。所以就有了这个攻略，记录一下过程。&lt;/p&gt;&lt;/blockquote&gt;&lt;h1 id=&quot;准备工作&quot;&gt;&lt;a href=&quot;#准备工作&quot; class=&quot;headerlink&quot; title=&quot;准备
      
    
    </summary>
    
    
    
      <category term="nexus6p" scheme="http://hcaijin.com/tags/nexus6p/"/>
    
      <category term="android" scheme="http://hcaijin.com/tags/android/"/>
    
      <category term="magisk" scheme="http://hcaijin.com/tags/magisk/"/>
    
      <category term="twrp" scheme="http://hcaijin.com/tags/twrp/"/>
    
  </entry>
  
  <entry>
    <title>树莓派安装配置软路由</title>
    <link href="http://hcaijin.com/openwrt-raspberry/"/>
    <id>http://hcaijin.com/openwrt-raspberry/</id>
    <published>2019-07-17T07:43:15.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><ul><li>Raspberry Pi 2 Model B Rev 1.1</li><li>SD卡闪盘(4G+)</li><li>主机我用的是ArchLinux,内核4.19.52-1-lts</li><li>主路由器一个TPlink</li><li>USB网卡</li><li>一条网线</li></ul><h1 id="刷openwrt固件"><a href="#刷openwrt固件" class="headerlink" title="刷openwrt固件"></a>刷openwrt固件</h1><h2 id="下载解压"><a href="#下载解压" class="headerlink" title="下载解压"></a>下载解压</h2><p>去<a href="https://www.openwrt.org" target="_blank" rel="noopener">官网</a>下载对应的安装固件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;downloads.openwrt.org&#x2F;releases&#x2F;18.06.4&#x2F;targets&#x2F;brcm2708&#x2F;bcm2709&#x2F;openwrt-18.06.4-brcm2708-bcm2709-rpi-2-ext4-factory.img.gz</span><br><span class="line">gzip -d openwrt-18.06.4-brcm2708-bcm2709-rpi-2-ext4-factory.img.gz</span><br></pre></td></tr></table></figure><h2 id="烧写SD卡"><a href="#烧写SD卡" class="headerlink" title="烧写SD卡"></a>烧写SD卡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l   #列出闪盘设备名 &#x2F;dev&#x2F;mmcblk0</span><br><span class="line">sudo dd if&#x3D;openwrt-18.06.4-brcm2708-bcm2709-rpi-2-ext4-factory.img of&#x3D;&#x2F;dev&#x2F;mmcblk0</span><br></pre></td></tr></table></figure><h2 id="链接树莓派"><a href="#链接树莓派" class="headerlink" title="链接树莓派"></a>链接树莓派</h2><p>配置主机IP(192.168.1.1) 网线直接连接树莓派接口 浏览器打开192.168.1.1 配置密码和ssh登陆以后，在终端里登陆<code>ssh root@192.168.1.1</code></p><p>修改lan口配置如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;config&#x2F;network</span><br><span class="line"></span><br><span class="line">config interface &#39;lan&#39;</span><br><span class="line">        option type &#39;bridge&#39;</span><br><span class="line">        option ifname &#39;eth0&#39;</span><br><span class="line">        option proto &#39;static&#39;</span><br><span class="line">        option netmask &#39;255.255.255.0&#39;</span><br><span class="line">        option ip6assign &#39;60&#39;</span><br><span class="line">        option ipaddr &#39;192.168.10.109&#39;</span><br><span class="line">        option gateway &#39;192.168.10.1&#39;</span><br><span class="line">        option broadcast &#39;255.255.255.0&#39;</span><br><span class="line">        option dns &#39;114.114.114.114&#39;</span><br></pre></td></tr></table></figure><p>重启路由，用网线连接主路由器就可以链接外网了。</p><h2 id="安装软件"><a href="#安装软件" class="headerlink" title="安装软件"></a>安装软件</h2><p>安装支持网卡的模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install kmod-rtl8192cu</span><br></pre></td></tr></table></figure><h3 id="修改无线网络配置"><a href="#修改无线网络配置" class="headerlink" title="修改无线网络配置"></a>修改无线网络配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;config&#x2F;wireless</span><br><span class="line"></span><br><span class="line">config wifi-iface &#39;default_radio0&#39;</span><br><span class="line">        option device &#39;radio0&#39;</span><br><span class="line">        option network &#39;lan&#39;</span><br><span class="line">        option mode &#39;ap&#39;</span><br><span class="line">        option encryption &#39;none&#39;</span><br><span class="line">        option ssid &#39;CMCCFREE&#39;</span><br></pre></td></tr></table></figure><h3 id="修改路由网络配置"><a href="#修改路由网络配置" class="headerlink" title="修改路由网络配置"></a>修改路由网络配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat &#x2F;etc&#x2F;config&#x2F;network</span><br><span class="line"></span><br><span class="line">config interface &#39;loopback&#39;</span><br><span class="line">        option ifname &#39;lo&#39;</span><br><span class="line">        option proto &#39;static&#39;</span><br><span class="line">        option ipaddr &#39;127.0.0.1&#39;</span><br><span class="line">        option netmask &#39;255.0.0.0&#39;</span><br><span class="line"></span><br><span class="line">config globals &#39;globals&#39;</span><br><span class="line">        option ula_prefix &#39;fd3c:ca1e:c593::&#x2F;48&#39;</span><br><span class="line"></span><br><span class="line">config interface &#39;lan&#39;</span><br><span class="line">        option proto &#39;static&#39;</span><br><span class="line">        option netmask &#39;255.255.255.0&#39;</span><br><span class="line">        option ipaddr &#39;192.168.10.1&#39;</span><br><span class="line">        option ip6assign &#39;64&#39;</span><br><span class="line"></span><br><span class="line">config interface &#39;wan&#39;</span><br><span class="line">        option ifname &#39;eth0&#39;</span><br><span class="line">        option proto &#39;dhcp&#39;</span><br><span class="line">        option dns &#39;127.0.0.1&#39; #### 连接该 OpenWrt 路由器的所有设备发出的 DNS 请求都会由该路由器的 dnsmasq 来响应（当然，前提是设备没有手动去修改默认的 DNS 服务器 IP，而使用路由器默认提供的 DNS 服务器 IP）。</span><br><span class="line">        option peerdns &#39;0&#39; #### 忽略通告的DNS服务器地址</span><br></pre></td></tr></table></figure><h3 id="修改DHCP配置如下"><a href="#修改DHCP配置如下" class="headerlink" title="修改DHCP配置如下"></a>修改DHCP配置如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">root@OpenWrt:~# cat &#x2F;etc&#x2F;config&#x2F;dhcp</span><br><span class="line"></span><br><span class="line">config dnsmasq</span><br><span class="line">        option domainneeded &#39;1&#39;</span><br><span class="line">        option localise_queries &#39;1&#39;</span><br><span class="line">        option rebind_protection &#39;1&#39;</span><br><span class="line">        option rebind_localhost &#39;1&#39;</span><br><span class="line">        option domain &#39;lan&#39;</span><br><span class="line">        option expandhosts &#39;1&#39;</span><br><span class="line">        option authoritative &#39;1&#39;</span><br><span class="line">        option readethers &#39;1&#39;</span><br><span class="line">        option leasefile &#39;&#x2F;tmp&#x2F;dhcp.leases&#39;</span><br><span class="line">        option nonwildcard &#39;1&#39;</span><br><span class="line">        option localservice &#39;1&#39;</span><br><span class="line">        option logqueries &#39;1&#39;</span><br><span class="line">        option noresolv &#39;1&#39;</span><br><span class="line">        option local &#39;&#x2F;lan&#x2F;&#39;</span><br><span class="line">        option allservers &#39;1&#39;</span><br><span class="line">        list server &#39;114.114.114.114&#39; #### 配置DNS转发 注意，此为路由器默认查询的 DNS 服务器，你可以根据你的实际情况选择一个较快的 DNS 服务器</span><br><span class="line"></span><br><span class="line">config dhcp &#39;lan&#39;</span><br><span class="line">        option interface &#39;lan&#39;</span><br><span class="line">        option dhcpv6 &#39;server&#39;</span><br><span class="line">        option ra &#39;server&#39;</span><br><span class="line">        option ra_management &#39;1&#39;</span><br><span class="line"></span><br><span class="line">config dhcp &#39;wan&#39;</span><br><span class="line">        option interface &#39;wan&#39;</span><br><span class="line">        option ignore &#39;1&#39;</span><br></pre></td></tr></table></figure><h3 id="提交修改并重启"><a href="#提交修改并重启" class="headerlink" title="提交修改并重启"></a>提交修改并重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uci commit &#x2F;etc&#x2F;config&#x2F;wireless</span><br><span class="line">uci commit &#x2F;etc&#x2F;config&#x2F;network</span><br><span class="line">uci commit &#x2F;etc&#x2F;config&#x2F;dhcp</span><br><span class="line"></span><br><span class="line">## 重启路由也是一样的或者执行以下命令重启服务</span><br><span class="line">&#x2F;etc&#x2F;init.d&#x2F;dnsmasq restart</span><br><span class="line">&#x2F;etc&#x2F;ini.d&#x2F;network restart</span><br><span class="line">ifup wan &amp;&amp; wifi</span><br></pre></td></tr></table></figure><h1 id="安装SS"><a href="#安装SS" class="headerlink" title="安装SS"></a>安装SS</h1><h2 id="安装-shadowsocks-libev-相关的包"><a href="#安装-shadowsocks-libev-相关的包" class="headerlink" title="安装 shadowsocks-libev 相关的包"></a>安装 shadowsocks-libev 相关的包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install shadowsocks-libev-config shadowsocks-libev-ss-local shadowsocks-libev-ss-redir shadowsocks-libev-ss-rules shadowsocks-libev-ss-tunnel luci-app-shadowsocks-libev</span><br></pre></td></tr></table></figure><h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><p>进入openwrt web配置界面，选择 Service-&gt;shadowsocks-libev</p><p>点击 Remote Servers, 里面已经默认配置一个服务器 sss0，修改地址，端口，密码，加密方式，最重要的，将disabled的勾去掉，点击 save&amp;apply 按钮。</p><p>再点击 Local Instances, 点击 ss-local.cfgXXXXX (XXX为随机数字)条目对应的Disabled 按钮，将其变成 Enabled，点击 Save &amp; Apply。配置保存生效以后, ss-local.cfgXXXX 条目的Running 状态由no变为yes。这时，路由器上已经运行一个SOCKS5服务器，端口1080。设置电脑浏览器的代理服务器为路由器地址，端口1080，尝试访问谷歌，如果成功则说明ss客户端在openwrt上工作一切正常。</p><p>接着要测试iptables+ss-redir自动转发代理(透明代理)的功能，在Local Instances中，将ss-redir.hi 设为Enabled。再点击 Redir Rules, Disabled勾去掉，点击Destination Settings，dst default 由bypass改为 forward。点击Save&amp;Apply 使配置生效。将电脑浏览器的代理设置取消，访问谷歌，如果成功，则说明无条件透明代理设置成功。所有数据包都由路由器转发到ss服务器了。</p><h2 id="3-进阶配置"><a href="#3-进阶配置" class="headerlink" title="3. 进阶配置"></a>3. 进阶配置</h2><p>上面最后配置的透明代理将全部流量都转发到远端SS服务器，显然太浪费流量，而且国内的网站去国外转一圈效率也很低。因此我们需要在路由器上识别国内国外流量，区别对待。</p><p>1.首先将 Destination Settings中的dst forward 设为 bypass。</p><ol start="2"><li>将opkg列表更新由http 改为https, http存在更新不全的情况，可能是GFW搞鬼</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg install libustream-mbedtls (如果提示找不到，opkg update 多运行几次)</span><br><span class="line">sed -i s&#x2F;http:&#x2F;https:&#x2F;g &#x2F;etc&#x2F;opkg&#x2F;distfeeds.conf</span><br><span class="line">opkg update</span><br></pre></td></tr></table></figure><ol start="3"><li>安装各种依赖包</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg remove dnsmasq</span><br><span class="line">opkg install dnsmasq-full</span><br><span class="line">opkg install coreutils-base64 curl ca-certificates ca-bundle</span><br></pre></td></tr></table></figure><h1 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h1><h2 id="dnsmasq服务不启动"><a href="#dnsmasq服务不启动" class="headerlink" title="dnsmasq服务不启动"></a>dnsmasq服务不启动</h2><p>最早手动添加域名到 /etc/dnsmasq.d/下的配置文件中，经过测试，发现无法解析该域名，经过排查，可能是配置文件编码格式的问题，导致了dnsmasq服务无法启动</p><h2 id="主机路由地址"><a href="#主机路由地址" class="headerlink" title="主机路由地址"></a>主机路由地址</h2><p>排查问题我们在主机上用<code>nslookup</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graz@graz ~ % nslookup twitter.com</span><br><span class="line">Server:192.168.1.1</span><br><span class="line">Address:192.168.1.1#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:twitter.com</span><br><span class="line">Address: 104.244.42.65</span><br><span class="line">Name:twitter.com</span><br><span class="line">Address: 104.244.42.1</span><br></pre></td></tr></table></figure><p>如上，看server项，是上上级的路由地址，这就绕过了树莓派的路由直接走上级路由查询。</p><p>然后，我们再看一下<code>cat /etc/resolv.conf</code><br>可以看到有多个路由地址，包括<code>192.168.10.1</code>，<code>192.168.1.1</code></p><p>以上，主机路由地址获取到了上上级的路由，也不知道怎么回事，(有知道的可以邮件通知我一下，谢谢大家)，只能先手动修改一下主机路由如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;resolv.conf</span><br><span class="line">nameserver 192.168.10.1 ## 这里是树莓派路由器的路由地址，一开始获取的还有上上级的路由地址如：192.168.1.1 。要把这个删掉</span><br></pre></td></tr></table></figure><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>最后，查看日志或者安装tcpdump抓取5353端口看是否正常配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg update </span><br><span class="line">opkg install tcpdump</span><br><span class="line">tcpdump -vv -i lo port 5353</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://blog.kompaz.win/2017/03/24/OpenWRT%20Shadowsocks+GFWList%20%E6%B5%81%E9%87%8F%E8%87%AA%E5%8A%A8%E5%88%86%E6%B5%81/" target="_blank" rel="noopener">OpenWRT Shadowsocks+GFWList 流量自动分流</a></li><li><a href="https://medium.com/@cnnbysy/openwrt-18-06-1-%E9%85%8D%E7%BD%AE%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91-30e231958c38" target="_blank" rel="noopener">openwrt 18.06.1 配置科学上网</a></li><li><a href="https://swsmile.info/2019/01/30/%E3%80%90Network%E3%80%91Shadowsocks%20-Shadowsocks-OpenWRT-dnsmasq-full-ipset-gfwList-%E5%AE%9E%E7%8E%B0%E8%B7%AF%E7%94%B1%E5%99%A8%EF%BC%88%E5%B0%8F%E7%B1%B3%E8%B7%AF%E7%94%B1%E5%99%A8mini%EF%BC%89%E8%87%AA%E5%8A%A8%E7%BF%BB%E5%A2%99/" target="_blank" rel="noopener">Shadowsocks + OpenWRT + dnsmasq-full + ipset + gfwList 实现路由器</a></li><li><a href="https://blog.ch3n2k.com/posts/xin-de-ji-yu-openwrt-lu-you-qi-de-bu-wan-quan-zi-dong-fan-qiang-fang-an.html" target="_blank" rel="noopener">新的基于OpenWrt路由器的（不完全）自动翻墙方案</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;准备&quot;&gt;&lt;a href=&quot;#准备&quot; class=&quot;headerlink&quot; title=&quot;准备&quot;&gt;&lt;/a&gt;准备&lt;/h1&gt;&lt;ul&gt;&lt;li&gt;Raspberry Pi 2 Model B Rev 1.1&lt;/li&gt;&lt;li&gt;SD卡闪盘(4G+)&lt;/li&gt;&lt;li&gt;主机我用的是A
      
    
    </summary>
    
    
    
      <category term="openwrt" scheme="http://hcaijin.com/tags/openwrt/"/>
    
      <category term="raspberry" scheme="http://hcaijin.com/tags/raspberry/"/>
    
  </entry>
  
  <entry>
    <title>用OPENWRT路由器抓包网络流量笔记</title>
    <link href="http://hcaijin.com/openwrt-wireshark-setting/"/>
    <id>http://hcaijin.com/openwrt-wireshark-setting/</id>
    <published>2018-06-13T11:50:11.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>openwrt是一款基于linux的路由器系统，可以安装很多相关的工具包，完成像linux系统服务器可以完成的工作，比如今天我们要讲的路由器的网络数据包抓包。</p><h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><ul><li>安装了openwrt的路由器，ip地址：192.168.10.1</li><li>要抓包流量的Android手机，ip地址：192.68.10.235</li><li>工作台笔记本，ip地址：192.168.10.234</li></ul><h1 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h1><blockquote><p>以下介绍两种方法都可以实现路由器数据包抓取的功能</p></blockquote><p><strong><em>简单的说明<br>根据openwrt文档，所有的局域网的数据最后都是通过br-lan虚拟网卡来做转发，所以对此网卡进行监控即可<br>此命令本质是远程在路由器上执行网络监控命令，输入文本到本机的wireshark里面<br>使用wireshark作为可视化工具来查看</em></strong></p><h2 id="捕获与tcpdump的通信"><a href="#捕获与tcpdump的通信" class="headerlink" title="捕获与tcpdump的通信"></a>捕获与tcpdump的通信</h2><blockquote><p>Tcpdump可以安装在OpenWrt路由器上。因此，这种方法消除了让远程Wireshark或类似听众实时分析流量的需要。</p></blockquote><p>ssh登陆到openwrt(默认端口：22)，更新并安装tcpdump</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install tcpdump</span><br></pre></td></tr></table></figure><p>执行以下命令在接口（-i）上侦听并将捕获的信息存储到文件（-w），并在执行此操作时（-v）进行冗长操作。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i any -v -w pcap.cap</span><br></pre></td></tr></table></figure><p>生成的pcap.cap文件，我们可以传回工作台，用wireshark打开做进一步的分析</p><blockquote><p>以下是一些使用tcpdump的例子：</p></blockquote><ul><li><a href="https://www.rationallyparanoid.com/articles/tcpdump.html" target="_blank" rel="noopener">https://www.rationallyparanoid.com/articles/tcpdump.html</a></li></ul><h3 id="制作一键命令脚本"><a href="#制作一键命令脚本" class="headerlink" title="制作一键命令脚本"></a>制作一键命令脚本</h3><p>命令格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p ssh端口 -o StrictHostKeyChecking&#x3D;no ssh用户名@ssh地址 &#39;tcpdump -s 0 -U -n -w - -i br-lan not port ssh端口&#39; | wireshark -k -i -</span><br></pre></td></tr></table></figure><p>由于我环境配置了不用密码登陆的方式所以我们可以直接写成如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh openwrt &#39;tcpdump -s 0 -U -n -w - -i br-lan not port 22&#39; | wireshark -k -i -</span><br><span class="line">ssh -p 22 -o StrictHostKeyChecking&#x3D;no root@192.168.10.1 &#39;tcpdump -s 0 -U -n -w - -i br-lan not port 22&#39; | wireshark -k -i -</span><br></pre></td></tr></table></figure><blockquote><p>前面讲述了基本的原理和操作手段，但是缺点是每次都需要输入长串命令行和密码，可以利用linux的一些小操作技巧，简化此过程，做成一个命令工具，方便随时调用。<br>基本原理：</p></blockquote><ul><li>使用 sshpass 工具来做密码输入</li><li>使用 alias 别名来做成命令语句</li></ul><p>在工作台安装sshpass，执行以下脚本：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S sshpass</span><br><span class="line">sshpass -p &#39;password&#39; ssh -p 22 -o StrictHostKeyChecking&#x3D;no root@192.168.10.1 &#39;tcpdump -s 0 -U -n -w - -i br-lan not port 22&#39; | wireshark-gtk -k -i -</span><br></pre></td></tr></table></figure><p>把执行语句写到<code>.bash_rc</code>就可以一条命令执行抓包分析了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias tsharkbyopenwrt&#x3D;&quot;sshpass -p &#39;password&#39; ssh -p 22 -o StrictHostKeyChecking&#x3D;no root@192.168.10.1 &#39;tcpdump -s 0 -U -n -w - -i br-lan not port 22&#39; | wireshark-gtk -k -i -&quot;</span><br></pre></td></tr></table></figure><h3 id="完善脚本"><a href="#完善脚本" class="headerlink" title="完善脚本"></a>完善脚本</h3><p>通过命名管道来导回数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfifo &#x2F;tmp&#x2F;fifo</span><br><span class="line">sshpass -p &#39;passwrod&#39; ssh openwrt &#39;tcpdump -s 0 -U -n -w - -i br-lan not port 22&#39; &gt; &#x2F;tmp&#x2F;fifo &amp; wireshark-gtk -k -i &#x2F;tmp&#x2F;fifo</span><br></pre></td></tr></table></figure><p><em>这里我配置了<code>.ssh/config</code>，所以可以直接使用<code>ssh openwrt</code>命令代替前面指定端口与用户名的方式。</em></p><blockquote><p>我们还有一个方法可以不用安装sshpass,直接使用密钥的方式来登陆路由器抓包,以上就可以写为：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id openwrt</span><br><span class="line">ssh openwrt &#39;tcpdump -s 0 -U -n -w - -i br-lan not port 22&#39; &gt; &#x2F;tmp&#x2F;fifo &amp; wireshark-gtk -k -i &#x2F;tmp&#x2F;fifo</span><br></pre></td></tr></table></figure><h2 id="使用远程Wireshark侦听器进行分析"><a href="#使用远程Wireshark侦听器进行分析" class="headerlink" title="使用远程Wireshark侦听器进行分析"></a>使用远程Wireshark侦听器进行分析</h2><p>ssh登陆到openwrt(默认端口：22)，更新并安装iptables-mod-tee</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update </span><br><span class="line">opkg install iptables-mod-tee</span><br></pre></td></tr></table></figure><p>运行以下iptables命令以“在输出接口（-o）上将源IP（-s）的每个数据包的副本转发到网关IP（ - 网关）”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A POSTROUTING -t mangle -o br-lan ! -s 192.168.10.235 -j TEE --gateway 192.168.10.234</span><br></pre></td></tr></table></figure><p>运行以下iptables命令以“在接口（-i）上将目的IP（-d）的每个数据包的副本转发到网关IP（ - 网关）”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -A PREROUTING -t mangle -i br-lan ! -d 192.168.10.235 -j TEE --gateway 192.168.10.234</span><br></pre></td></tr></table></figure><p>在Wireshark上开始捕获流量并应用下面的过滤器：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(ip.src &#x3D;&#x3D; 192.168.9.121) || (ip.dst &#x3D;&#x3D; 192.168.9.121)</span><br></pre></td></tr></table></figure><p>关于iptable规则一些有用的资源：</p><ul><li><a href="https://wiki.openwrt.org/doc/howto/netfilter" target="_blank" rel="noopener">https://wiki.openwrt.org/doc/howto/netfilter</a></li><li><a href="http://www.faqs.org/docs/iptables/index.html" target="_blank" rel="noopener">http://www.faqs.org/docs/iptables/index.html</a></li><li><a href="http://ipset.netfilter.org/iptables-extensions.man.html#lbDW" target="_blank" rel="noopener">http://ipset.netfilter.org/iptables-extensions.man.html#lbDW</a></li></ul><h2 id="安装使用CloudShark"><a href="#安装使用CloudShark" class="headerlink" title="安装使用CloudShark"></a>安装使用CloudShark</h2><p>CloudShark是一个独立的，与LEDE无关的云分析平台。它依靠cshark插件远程发送数据包进行分析。请检查您的内部规则，是否允许将网络流量发送到云平台。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install cshark luci-app-cshark</span><br></pre></td></tr></table></figure><p>请查看<a href="https://support.cloudshark.org/openwrt/openwrt-cloudshark.html" target="_blank" rel="noopener">Cloud Shark文档</a>以获取更多信息。</p><h1 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h1><p>在工作台使用wireshark-gtk的时候报错：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Couldn&#39;t run &#x2F;usr&#x2F;bin&#x2F;dumpcap in child process: Permission denied</span><br></pre></td></tr></table></figure><p>这是由于dumpcap这个的权限问题。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll &#x2F;usr&#x2F;bin&#x2F;dumpcap                                                                  :(</span><br><span class="line">-rwxr-xr-- 1 root wireshark 102K May 23 06:39 &#x2F;usr&#x2F;bin&#x2F;dumpcap</span><br></pre></td></tr></table></figure><p>只要把当前用户加入到wireshark用户组里，重启就ok了（暂时不明为什么一定要重启，反正我是重启以后才正常使用的)。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG wireshark $LOGNAME</span><br><span class="line">sudo setcap cap_net_raw,cap_net_admin+eip &#x2F;usr&#x2F;bin&#x2F;dumpcap</span><br></pre></td></tr></table></figure><p><em>setcat对应使用getcap查看当前的方法权限</em></p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="http://www.ayomaonline.com/security/analyzing-network-traffic-with-openwrt/" target="_blank" rel="noopener">ANALYZING NETWORK TRAFFIC WITH OPENWRT</a></li><li><a href="https://openwrt.org/docs/guide-user/firewall/capture-filter-inspect-packets" target="_blank" rel="noopener">How to capture, filter and inspect packets</a></li><li><a href="http://www.ayomaonline.com/security/getting-started-with-openwrt-linuxfying-routers/" target="_blank" rel="noopener">GETTING STARTED WITH OPENWRT – LINUXFYING ROUTERS</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;openwrt是一款基于linux的路由器系统，可以安装很多相关的工具包，完成像linux系统服务器可以完成的工作，比如今天我们要讲的路由器
      
    
    </summary>
    
    
    
      <category term="openwrt" scheme="http://hcaijin.com/tags/openwrt/"/>
    
      <category term="wireshark" scheme="http://hcaijin.com/tags/wireshark/"/>
    
      <category term="cloudshark" scheme="http://hcaijin.com/tags/cloudshark/"/>
    
  </entry>
  
  <entry>
    <title>UEFI+GPT安装Archlinux与Win10双系统教程</title>
    <link href="http://hcaijin.com/archlinux-uefi-bootloader/"/>
    <id>http://hcaijin.com/archlinux-uefi-bootloader/</id>
    <published>2018-06-09T16:42:24.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><blockquote><p>最近新入手一台Thinkpad,使用UEFI+GPT预安装好了Win10操作系统，准备开始安装Archlinux。</p></blockquote><p>如果你准备在一块新硬盘上安装双系统，那么应该先安装windows。<br>如果你安装的是Win10，那么它应该默认就是按UEFI+GPT方式安装的，可以按Win+X键打开磁盘管理，如果是UEFI安装的，那么应该有一个EFI分区，可能是250M。<br>其它还有Windows的恢复分区和基本数据分区。不用管恢复分区，如果现在磁盘上没有剩余空间，可以右键点击基本数据分区，点击压缩卷，给Arch的安装腾出空间。用右键点击磁盘，查看属性，可以知道自己是否采用了GPT分区方式。</p><p>在安装之前，请在电源计划中关掉Windows的快速启动，并在BIOS中关掉Secure Boot，可以很容易搜到对应自己电脑的具体方法。<br>如果上面有哪一条没有满足，请只看一看我遇到的问题，具体安装请再参考其它教程</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="安装之前"><a href="#安装之前" class="headerlink" title="安装之前"></a>安装之前</h2><ul><li>准备一个大于4G的U盘</li><li>安装镜像，可以从Arch Linux的<a href="www.archlinux.org">官方网站</a>下载</li></ul><h2 id="制作U盘启动盘"><a href="#制作U盘启动盘" class="headerlink" title="制作U盘启动盘"></a>制作U盘启动盘</h2><p>这里我只介绍linux系统下使用<code>dd</code>的方式，windows下面的方法可以看一下这个<a href="https://github.com/mytbk/Linux_Notes/blob/master/install/install-archlinux.md" target="_blank" rel="noopener">安装教程</a></p><p>插入U盘，查看U盘设备名,不需求挂载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br><span class="line">sudo dd if&#x3D;archlinux-2018.06.01-x86_64.iso of&#x3D;&#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure><p>这样，就制作好了U盘启动了，把U盘插入要安装的机子，配置BIOS通过U盘启动，就可以进入光盘引导的临时系统。</p><h2 id="选择镜像源"><a href="#选择镜像源" class="headerlink" title="选择镜像源"></a>选择镜像源</h2><p>Arch Linux是通过网络进行安装的，为了以更快的速度下载软件包，建议先配置镜像源。配置镜像源的方法是编辑/etc/pacman.d/mirrorlist这个文件，将想用的镜像源的放到第一个非井号开头的行即可。如下可将中科大镜像源作为首选镜像源。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;pacman.d&#x2F;mirrorlist</span><br><span class="line"># This is the USTC mirror</span><br><span class="line">Server &#x3D; http:&#x2F;&#x2F;mirrors.ustc.edu.cn&#x2F;archlinux&#x2F;$repo&#x2F;os&#x2F;$arch</span><br><span class="line"></span><br><span class="line"># and other mirrors</span><br><span class="line">## Score: 4.6, China</span><br><span class="line">Server &#x3D; http:&#x2F;&#x2F;mirrors.163.com&#x2F;archlinux&#x2F;$repo&#x2F;os&#x2F;$arch</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>配置完成后可以执行pacman -Syy试一下，可以看一下pacman从镜像站下载文件的速度。</p><h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><blockquote><p>我们前面提过已经默认有安装的Win10系统,使用<code>fdisk</code>可以看到已经有一个EFI分区为250M大小。因此不要单独为Linux分出EFI分区，因为要双系统启动的话应该把Win10的EFI分区挂载到/boot上。</p></blockquote><p>以下是我的硬盘分区情况,因为我还有一块硬盘用来挂载/home，所以我只要创建根分区和swap分区</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Device             Start       End   Sectors  Size Type</span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p1      2048    534527    532480  260M EFI System</span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p2    534528    567295     32768   16M Microsoft reserved</span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p3    567296 254337023 253769728  121G Microsoft basic data</span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p4 254337024 485023743 230686720  110G Linux filesystem</span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p5 498069504 500117503   2048000 1000M Windows recovery environment</span><br><span class="line">&#x2F;dev&#x2F;nvme0n1p6 485023744 497606655  12582912    6G Linux swap</span><br></pre></td></tr></table></figure><h2 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a>格式化</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 &#x2F;dev&#x2F;nvme0n1p4</span><br><span class="line"></span><br><span class="line">mkswap &#x2F;dev&#x2F;nvme0n1p6</span><br><span class="line">swapon &#x2F;dev&#x2F;nvme0n1p6</span><br></pre></td></tr></table></figure><h2 id="挂载分区"><a href="#挂载分区" class="headerlink" title="挂载分区"></a>挂载分区</h2><p>首先，一定是先挂载/分区，再挂载其它分区。因为要使用双系统启动，所以即使没有分/boot分区，还是应该把windows的EFI分区挂载到/上。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount &#x2F;dev&#x2F;nvme0n1p4 &#x2F;mnt&#x2F;</span><br><span class="line">mkdir -p &#x2F;mnt&#x2F;boot</span><br><span class="line">mount &#x2F;dev&#x2F;nvme0n1p1 &#x2F;mnt&#x2F;boot</span><br></pre></td></tr></table></figure><h2 id="基本软件安装"><a href="#基本软件安装" class="headerlink" title="基本软件安装"></a>基本软件安装</h2><p>安装Arch Linux的软件很简单，执行下面这条命令就行了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap &#x2F;mnt base base-devel</span><br></pre></td></tr></table></figure><h1 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h1><h2 id="创建fstab"><a href="#创建fstab" class="headerlink" title="创建fstab"></a>创建fstab</h2><p>生成一个fstab文件（使用-U或-L分别由UUID或标签定义）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U &#x2F;mnt &gt;&gt; &#x2F;mnt&#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure><h2 id="切换新系统"><a href="#切换新系统" class="headerlink" title="切换新系统"></a>切换新系统</h2><p>现在我们执行<code>arch-chroot /mnt</code>，这样就以chroot的方式进入了新的系统。</p><h2 id="配置时间"><a href="#配置时间" class="headerlink" title="配置时间"></a>配置时间</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -sf &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Shanghai &#x2F;etc&#x2F;localtime</span><br><span class="line">hwclock --systohc</span><br></pre></td></tr></table></figure><h2 id="配置本地化"><a href="#配置本地化" class="headerlink" title="配置本地化"></a>配置本地化</h2><p>在/etc/locale.gen中取消注释en_US.UTF-8 UTF-8和其他所需的本地化，并使用<code>local-gen</code>更新本地语言编码</p><h2 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;hcaijin.com&#39; &gt; &#x2F;etc&#x2F;hostname</span><br></pre></td></tr></table></figure><h2 id="设置root密码"><a href="#设置root密码" class="headerlink" title="设置root密码"></a>设置root密码</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd</span><br></pre></td></tr></table></figure><h2 id="设置启动"><a href="#设置启动" class="headerlink" title="设置启动"></a>设置启动</h2><p>按照上面的步骤，efi分区应该被挂载到了/boot目录下。这时，我们使用<code>bootctl install</code>命令，安装bootloader，然后用<code>cp /usr/share/systemd/bootctl/arch.conf /boot/loader/entries/</code>把示例文件复制过来，只要修改它的options部分就可以了。<br>以我的/boot分区为例，用<code>blkid -s PARTUUID -o value /dev/nvme0n1p1</code>就可以生成所需要的PARTUUID，最后加上rw就行了。</p><p>格式大概为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title       Arch Linux</span><br><span class="line">linux       &#x2F;vmlinuz-linux</span><br><span class="line">initrd      &#x2F;initramfs-linux.img</span><br><span class="line">options     root&#x3D;UUID&#x3D;6278bd34-44cd-41b9-9bdd-239d9ce4020a rw</span><br></pre></td></tr></table></figure><p>意思是创建一个标题为Arch Linux的启动项，它用bootloader所在分区(/dev/sda1)根目录下的vmlinuz-linux作为Linux内核，initramfs-linux.img作为initramfs镜像(可以认为是一个临时rootfs镜像)，并且用root=/dev/sda2 ro作为内核参数。</p><p>再编辑/boot/loader/loader.conf.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timeout 3</span><br><span class="line">default arch</span><br></pre></td></tr></table></figure><p>意思是默认用arch.conf的配置启动，等待3秒没有键盘操作即使用默认配置启动。</p><h2 id="新系统的网络"><a href="#新系统的网络" class="headerlink" title="新系统的网络"></a>新系统的网络</h2><p>启动盘中默认配置好了有关网络的软件，但新的系统中却没有。<br>如果你只是使用单一且固定的有线网络，使用<code>systemctl enable dhcpcd@interface.service</code>就可以了（interface是你的网络接口名，可以使用ip link查看，类似enp3s0）。<br>如果要使用无线网络，那么就要使用<code>pacman -S iw wpa_supplicant dialog</code>命令安装这些软件包。如果失败，可能要安装固件。</p><p>至此，新系统的配置就完成了。</p><p>使用exit命令退出chroot环境，umount -R /mnt卸载挂载的分区，然后使用reboot重启一下就好了。</p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>可能会启动失败，解决方法是进入BIOS里的设置把UEFI作为唯一的启动方式。然后保存退出，就可以看到有三个启动项（分别是Arch Linux, Windows Manage, Default），选择你要进入的系统就可以了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;blockquote&gt;&lt;p&gt;最近新入手一台Thinkpad,使用UEFI+GPT预安装好了Win10操作系统，准备开始安装Archlinux。&lt;
      
    
    </summary>
    
    
    
      <category term="archlinux" scheme="http://hcaijin.com/tags/archlinux/"/>
    
      <category term="windows" scheme="http://hcaijin.com/tags/windows/"/>
    
      <category term="uefi" scheme="http://hcaijin.com/tags/uefi/"/>
    
  </entry>
  
  <entry>
    <title>Chromium OS源码编译、U盘安装及使用笔记</title>
    <link href="http://hcaijin.com/chromium-os-install/"/>
    <id>http://hcaijin.com/chromium-os-install/</id>
    <published>2018-06-02T15:41:10.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>根据官方文档 <a href="https://www.chromium.org/chromium-os/quick-start-guide" target="_blank" rel="noopener">https://www.chromium.org/chromium-os/quick-start-guide</a> 只有Ubuntu Trusty版本的安装方式写了个ArchLinux的安装方法</p></blockquote><h1 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h1><ul><li>Arch Linux 4.16.12-1-ARCH</li><li>x86_64 GNU/Linux</li><li>有sudo权限的用户</li></ul><h2 id="基本依赖"><a href="#基本依赖" class="headerlink" title="基本依赖"></a>基本依赖</h2><p>确保有如下包就好了，没有就用<code>pacman -S</code> 安装就是：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pacman -S git-core gitk git-gui subversion curl lvm2 thin-provisioning-tools python-pkg-resources python-virtualenv python-oauth2client</span><br></pre></td></tr></table></figure><h2 id="安装depot-tools"><a href="#安装depot-tools" class="headerlink" title="安装depot_tools"></a>安装depot_tools</h2><p>用git克隆下来就好了,但要注意python的版本，后面会说.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~&#x2F;Source&#x2F;</span><br><span class="line">git clone https:&#x2F;&#x2F;chromium.googlesource.com&#x2F;chromium&#x2F;tools&#x2F;depot_tools</span><br></pre></td></tr></table></figure><p>确保deport_tools目录在PATH变量里</p><h2 id="sudoers配置"><a href="#sudoers配置" class="headerlink" title="sudoers配置"></a>sudoers配置</h2><p>要设置Chrome操作系统构建环境，应该关闭sudo的tty_tickets选项，因为它与cros_sdk不兼容。执行如下操作：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">cat &gt; .&#x2F;sudo_editor &lt;&lt;EOF</span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">echo Defaults \!tty_tickets &gt; \$1          # Entering your password in one shell affects all shells </span><br><span class="line">echo Defaults timestamp_timeout&#x3D;180 &gt;&gt; \$1 # Time between re-requesting your password, in minutes</span><br><span class="line">EOF</span><br><span class="line">chmod +x .&#x2F;sudo_editor </span><br><span class="line">sudo EDITOR&#x3D;.&#x2F;sudo_editor visudo -f &#x2F;etc&#x2F;sudoers.d&#x2F;relax_requirements</span><br></pre></td></tr></table></figure><h1 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h1><p>创建一个目录来保存源文件“${SOURCE_REPO}”。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export SOURCE_REPO&#x3D;&quot;~&#x2F;Source&#x2F;chromiumos&quot;</span><br><span class="line">mkdir $&#123;SOURCE_REPO&#125;</span><br><span class="line">cd $&#123;SOURCE_REPO&#125;</span><br><span class="line">virtualenv -p &#x2F;usr&#x2F;bin&#x2F;python2 venv#这里我们要把python环境切换为2.7，才能使用下面的repo</span><br><span class="line">repo init -u https:&#x2F;&#x2F;chromium.googlesource.com&#x2F;chromiumos&#x2F;manifest.git</span><br><span class="line"></span><br><span class="line"># Optional: Make any changes to .repo&#x2F;local_manifests&#x2F;local_manifest.xml before syncing</span><br><span class="line">repo sync</span><br></pre></td></tr></table></figure><h1 id="创建chromiumos"><a href="#创建chromiumos" class="headerlink" title="创建chromiumos"></a>创建chromiumos</h1><h2 id="构建包"><a href="#构建包" class="headerlink" title="构建包"></a>构建包</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export BOARD&#x3D;amd64-generic</span><br><span class="line">cros_sdk -- .&#x2F;build_packages --board&#x3D;$&#123;BOARD&#125;</span><br></pre></td></tr></table></figure><h2 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cros_sdk -- .&#x2F;build_image --board&#x3D;$&#123;BOARD&#125;</span><br></pre></td></tr></table></figure><h2 id="烧入USB"><a href="#烧入USB" class="headerlink" title="烧入USB"></a>烧入USB</h2><p>键入 <code>sudo fdisk -l</code> 查看插入U盘所在区域，然后执行如下操作烧录编译的系统到U盘</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cros_sdk -- cros flash usb:&#x2F;&#x2F;&#x2F;dev&#x2F;sdd ~&#x2F;chromiumos&#x2F;src&#x2F;build&#x2F;images&#x2F;amd-generic&#x2F;latest&#x2F;chromiumos_test_image.bin</span><br></pre></td></tr></table></figure><h2 id="修改分区"><a href="#修改分区" class="headerlink" title="修改分区"></a>修改分区</h2><p>如果要使用自定义大小容量的分区构建镜像，请考虑在 build_library/legacy_disk_layout.json 中添加新的磁盘布局或使用 adjust_part。请参阅下面的帮助，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adjust_part &#x3D;&#39;STATE：1G&#39; ---- 将1GB添加到状态分区</span><br><span class="line">adjust_part &#x3D;&#39;ROOT-A：-1G&#39; ---- 从主rootfs分区中删除1GB</span><br><span class="line">adjust_part &#x3D;&#39;STATE：&#x3D; 1G&#39; --- 设置状态分区为1GB</span><br></pre></td></tr></table></figure><p>这里键入 <code>cros_sdk -- ./build_image --board=${BOARD} --noenable_rootfs_verification test --adjust_part=&#39;STATE:+10G&#39;</code>，这样我们的Chromium OS用户空间便增加10G，如果使用默认设置你会发现用户空间容量不足（约140MB）</p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>修改要安装到目标机器的bios启动项为U盘启动，插入U盘，启动。</p><p>进入系统，按Ctrl + Alt + Back（F2）。在提示符下输入chronos并使用以下命令进行安装。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;sbin&#x2F;chromeos-install</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;根据官方文档 &lt;a href=&quot;https://www.chromium.org/chromium-os/quick-start-guide&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.chromium.o
      
    
    </summary>
    
    
    
      <category term="archlinux" scheme="http://hcaijin.com/tags/archlinux/"/>
    
      <category term="ChromiumOS" scheme="http://hcaijin.com/tags/ChromiumOS/"/>
    
  </entry>
  
  <entry>
    <title>Arch Linux 内核更新 修复无线模块rtl8821ce编译失败的问题</title>
    <link href="http://hcaijin.com/kernel-upgrade-fix-rtl8821ce/"/>
    <id>http://hcaijin.com/kernel-upgrade-fix-rtl8821ce/</id>
    <published>2018-05-18T17:36:07.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近更新系统，内核从4.15 更新到了 4.16.9发现原来的无线模块编译不通过，找不到头文件stdarg.h</p></blockquote><h1 id="查看无线驱动信息"><a href="#查看无线驱动信息" class="headerlink" title="查看无线驱动信息"></a>查看无线驱动信息</h1><p>通过<code>ip l</code>可以看到只有有线网卡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: enp3s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 8c:16:45:3f:68:0d brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure><p>查看无线网卡驱动，找到相应的驱动去下载就好了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i &#39;newwork&#39;</span><br><span class="line"></span><br><span class="line">Network controller: Realtek Semiconductor Co., Ltd. RTL8821CE 802.11ac PCIe Wireless Network Adapter</span><br></pre></td></tr></table></figure><h1 id="下载无线驱动源码"><a href="#下载无线驱动源码" class="headerlink" title="下载无线驱动源码"></a>下载无线驱动源码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;endlessm&#x2F;linux</span><br></pre></td></tr></table></figure><p>由于这个项目特别的大，这里只需要下载drivers/net/wireless/rtl8821ce</p><h1 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h1><h2 id="修改Makefile"><a href="#修改Makefile" class="headerlink" title="修改Makefile"></a>修改Makefile</h2><p>这里需要修改Makefile中TopDIR变量的值为当前路径，否则会提示错误退出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd drivers&#x2F;net&#x2F;wireless&#x2F;rtl8821ce</span><br><span class="line">sed -i &#39;s&#x2F;export TopDIR ?&#x3D;&#x2F;export TopDIR ?&#x3D; $(shell pwd)&#x2F;g&#39; Makefile</span><br></pre></td></tr></table></figure><h2 id="执行make"><a href="#执行make" class="headerlink" title="执行make"></a>执行<code>make</code></h2><p>在最新的内核版本（4.16.9-1-ARCH）下编译失败，提示如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graz@graz ~&#x2F;Source&#x2F;driver_net_wireless&#x2F;rtl8821ce % make</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;make ARCH&#x3D;x86_64 CROSS_COMPILE&#x3D; -C &#x2F;lib&#x2F;modules&#x2F;4.16.9-1-ARCH&#x2F;build M&#x3D;&#x2F;home&#x2F;graz&#x2F;Source&#x2F;driver_net_wireless&#x2F;rtl8821ce  modules</span><br><span class="line">make[1]: Entering directory &#39;&#x2F;usr&#x2F;lib&#x2F;modules&#x2F;4.16.9-1-ARCH&#x2F;build&#39;</span><br><span class="line">  CC [M]  &#x2F;home&#x2F;graz&#x2F;Source&#x2F;driver_net_wireless&#x2F;rtl8821ce&#x2F;core&#x2F;rtw_cmd.o</span><br><span class="line">In file included from .&#x2F;include&#x2F;linux&#x2F;list.h:9,</span><br><span class="line">                 from .&#x2F;include&#x2F;linux&#x2F;module.h:9,</span><br><span class="line">                 from &#x2F;home&#x2F;graz&#x2F;Source&#x2F;driver_net_wireless&#x2F;rtl8821ce&#x2F;include&#x2F;basic_types.h:81,</span><br><span class="line">                 from &#x2F;home&#x2F;graz&#x2F;Source&#x2F;driver_net_wireless&#x2F;rtl8821ce&#x2F;include&#x2F;drv_types.h:31,</span><br><span class="line">                 from &#x2F;home&#x2F;graz&#x2F;Source&#x2F;driver_net_wireless&#x2F;rtl8821ce&#x2F;core&#x2F;rtw_cmd.c:22:</span><br><span class="line">.&#x2F;include&#x2F;linux&#x2F;kernel.h:6:10: fatal error: stdarg.h: No such file or directory</span><br><span class="line"> #include &lt;stdarg.h&gt;</span><br><span class="line">          ^~~~~~~~~~</span><br><span class="line">compilation terminated.</span><br></pre></td></tr></table></figure><p>通过<code>locate stdarg.h</code>找到头文件 “/usr/lib/gcc/x86_64-pc-linux-gnu/8.1.0/include/stdarg.h”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;usr&#x2F;lib&#x2F;gcc&#x2F;x86_64-pc-linux-gnu&#x2F;8.1.0&#x2F;include&#x2F;stdarg.h include&#x2F;</span><br></pre></td></tr></table></figure><p>软链接创建好后，就可以执行<code>make</code>编译成功</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo make install</span><br><span class="line">modprobe 8821ce</span><br></pre></td></tr></table></figure><p>最后，没有报错的话，通过<code>ip l</code> 就可以找到这个无线网卡了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: enp3s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 8c:16:45:3f:68:0d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: wlp5s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP mode DORMANT group default qlen 1000</span><br><span class="line">    link&#x2F;ether 70:c9:4e:d8:6d:01 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;最近更新系统，内核从4.15 更新到了 4.16.9发现原来的无线模块编译不通过，找不到头文件stdarg.h&lt;/p&gt;&lt;/blockquote&gt;&lt;h1 id=&quot;查看无线驱动信息&quot;&gt;&lt;a href=&quot;#查看无线驱动信息&quot; class=&quot;headerli
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="rtl8821ce" scheme="http://hcaijin.com/tags/rtl8821ce/"/>
    
  </entry>
  
  <entry>
    <title>博客系统从ghost 迁移hexo 安装与配置</title>
    <link href="http://hcaijin.com/hexo-install/"/>
    <id>http://hcaijin.com/hexo-install/</id>
    <published>2018-05-06T08:33:21.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<h1 id="备份Ghost"><a href="#备份Ghost" class="headerlink" title="备份Ghost"></a>备份Ghost</h1><p>后台export，导出后是一个JSON，包含所有文章以及一些元数据：修改日期、Tags 等等</p><p>图片等资源，可以到 assets 文件夹下，打包下载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;www&#x2F;ghost</span><br><span class="line">tar -zcvf images.tag assets&#x2F;content</span><br></pre></td></tr></table></figure><h1 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h1><h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacman -S npm</span><br></pre></td></tr></table></figure><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-cli -g</span><br><span class="line">cd &#x2F;data&#x2F;www&#x2F;</span><br><span class="line">hexo init hcaijin.com</span><br><span class="line">cd hcaijin.com</span><br><span class="line">hexo install</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><h1 id="迁移"><a href="#迁移" class="headerlink" title="迁移"></a>迁移</h1><h2 id="导入Ghost数据"><a href="#导入Ghost数据" class="headerlink" title="导入Ghost数据"></a>导入Ghost数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">## 安装数据转换插件</span><br><span class="line">npm install hexo-migrator-ghost --save</span><br><span class="line"></span><br><span class="line">## 导入数据</span><br><span class="line">hexo migrate ghost ghost-export.json</span><br></pre></td></tr></table></figure><h2 id="导入图片"><a href="#导入图片" class="headerlink" title="导入图片"></a>导入图片</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp images.tag &#x2F;data&#x2F;www&#x2F;hcaijin.com&#x2F;source&#x2F;</span><br><span class="line">cd &#x2F;data&#x2F;www&#x2F;hcaijin.com&#x2F;source&#x2F;</span><br><span class="line">tar -zxvf images.tag</span><br></pre></td></tr></table></figure><h1 id="最后，做一些必要的配置"><a href="#最后，做一些必要的配置" class="headerlink" title="最后，做一些必要的配置"></a>最后，做一些必要的配置</h1><h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><ul><li><a href="https://hexo.io/zh-cn/docs/configuration.html" target="_blank" rel="noopener">Hexo 配置</a></li><li><a href="http://theme-next.iissnan.com/getting-started.html" target="_blank" rel="noopener">NexT 配置</a></li><li><a href="http://theme-next.iissnan.com/theme-settings.html" target="_blank" rel="noopener">NexT 高级配置</a></li></ul><h2 id="安装其他插件"><a href="#安装其他插件" class="headerlink" title="安装其他插件"></a>安装其他插件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save                                                       </span><br><span class="line">npm install hexo-generator-sitemap --save                                                        </span><br><span class="line">npm install hexo-generator-feed --save                                                           </span><br><span class="line">npm install hexo-pwa --save                                                                      </span><br><span class="line">npm install hexo-all-minifier --save</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;备份Ghost&quot;&gt;&lt;a href=&quot;#备份Ghost&quot; class=&quot;headerlink&quot; title=&quot;备份Ghost&quot;&gt;&lt;/a&gt;备份Ghost&lt;/h1&gt;&lt;p&gt;后台export，导出后是一个JSON，包含所有文章以及一些元数据：修改日期、Tags 等等&lt;/p&gt;
      
    
    </summary>
    
    
    
      <category term="ghost" scheme="http://hcaijin.com/tags/ghost/"/>
    
      <category term="hexo" scheme="http://hcaijin.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>ghost 更新记录</title>
    <link href="http://hcaijin.com/ghost-upgrade/"/>
    <id>http://hcaijin.com/ghost-upgrade/</id>
    <published>2017-05-06T04:33:21.000Z</published>
    <updated>2020-05-06T19:05:11.192Z</updated>
    
    <content type="html"><![CDATA[<p>好久没有更新ghost 0.6.0，今天更新的时候发现最新版本，0.11.11 版本 更新安装的时候报错。</p><p>查看error日志，是依赖的npm和node版本问题。解决方法就是要么升级npm,node，要么降级ghost到npm,node支持的版本。</p><ul><li><p>升级npm,node在这里就不说了，网上有很多的方法，我用的是搬瓦工家的最便宜vps，使用的npm,node不好升级，估计还得升级linux内核，我就不打算使用这个方法了。</p></li><li><p>降级ghost到npm,node支持的版本。<br>我们到<a href="https://github.com/TryGhost/Ghost/releases" target="_blank" rel="noopener">Ghost各版本历史</a>去找一下历史版本，我尝试了几个版本，最后确定0.8.0这个版本是可以正常使用的。</p></li></ul><blockquote><p>这样我们就可以开始升级ghost了。升级ghost不需要停了当前的服务，但是，升级更新都要做好备份。</p></blockquote><h3 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h3><p>登陆并进入https://$HOSTNAME/ghost/debug这个页面导出备份。</p><p>最好能登陆到服务器进入ghost安装的目录备份一下根目录下的content，这一步要先暂停服务。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;data&#x2F;www&#x2F;ghost</span><br><span class="line">tar -zcvf ghost-content.tag content</span><br></pre></td></tr></table></figure><blockquote><p>备份好以后，我们就可以删除与升级相关的目录了文件。</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf core&#x2F; node_modules&#x2F; index.js *.json</span><br></pre></td></tr></table></figure><h3 id="下载最新版本"><a href="#下载最新版本" class="headerlink" title="下载最新版本"></a>下载最新版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -LOk https:&#x2F;&#x2F;github.com&#x2F;TryGhost&#x2F;Ghost&#x2F;releases&#x2F;download&#x2F;0.8.0&#x2F;Ghost-0.8.0.zip</span><br></pre></td></tr></table></figure><p>然后解压到/data/www/ghost</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">unzip -uo Ghost-0.8.0.zip -d &#x2F;data&#x2F;www&#x2F;ghost</span><br></pre></td></tr></table></figure><h3 id="安装并重启"><a href="#安装并重启" class="headerlink" title="安装并重启"></a>安装并重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm cache clear &amp;&amp; npm install --production</span><br></pre></td></tr></table></figure><p>没有报错的话就是安装成功了。</p><p>重启ghost</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NODE_ENV&#x3D;production pm2 start index.js --name &quot;ghost&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;好久没有更新ghost 0.6.0，今天更新的时候发现最新版本，0.11.11 版本 更新安装的时候报错。&lt;/p&gt;&lt;p&gt;查看error日志，是依赖的npm和node版本问题。解决方法就是要么升级npm,node，要么降级ghost到npm,node支持的版本。&lt;/p&gt;&lt;ul
      
    
    </summary>
    
    
    
      <category term="ghost" scheme="http://hcaijin.com/tags/ghost/"/>
    
  </entry>
  
  <entry>
    <title>Linux 系统Chrome,Firefox程序无用使用Fcitx的问题解决方法</title>
    <link href="http://hcaijin.com/linux-xi-tong-chromefirefoxcheng-xu-wu-yong-shi-yong-fcitxde-wen-ti-jie-jue-fang-fa/"/>
    <id>http://hcaijin.com/linux-xi-tong-chromefirefoxcheng-xu-wu-yong-shi-yong-fcitxde-wen-ti-jie-jue-fang-fa/</id>
    <published>2016-12-24T21:04:29.000Z</published>
    <updated>2017-01-08T14:16:21.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>使用的gentoo有半年没有更新系统了，原来用的好好的输入法，更新完以后，在其他的程序都可以正常使用fcitx。但是，在chrome,firefox（后来知道应该是GTK,QT相关的程序用了最新版导致的问题）就是用不了，网上也有很多人提问，也没有一个有效的解决方法。</p><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul><li>Linux hcj-arch 4.4.39-1-lts #1 SMP Thu Dec 15 21:10:18 CET 2016 x86_64 GNU/Linu</li><li>fcitx version: 4.2.9.1</li><li>Google Chrome 55.0.2883.87</li><li>Mozilla Firefox 50.1.0</li></ul><h3 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h3><p>首先保证环境变量有设置，当然，如果其他程序都可以使用，那这个应该是没有问题的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export GTK_IM_MODULE&#x3D;fcitx </span><br><span class="line">export QT_IM_MODULE&#x3D;fcitx </span><br><span class="line">export XMODIFIERS&#x3D;@im&#x3D;fcitx</span><br></pre></td></tr></table></figure><p>主要的问题就是我们要用命令 <code>fcitx-diagnose</code> 查看fcitx的相关模块是不是有安装。（更无脑的方式就是把这个命令里显示为红色的信息都看一遍，把相关的模块安装上就ok了）</p><p>那么，我们可以看到：<br><img data-src="/content/images/2017/01/Screenshot_2016-12-27_10-51-56.png" alt=""></p><p><img data-src="/content/images/2017/01/Screenshot_2016-12-27_10-52-09.png" alt=""></p><p>== 如上图所示，缺少gtk2,gtk3相关的模块支持，导致的Chrome,Firefox等gtk软件无法使用输入法的情况 ==</p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>我们先看一下fcitx构建时用到的USE标记，以下<br><img data-src="/content/images/2017/01/Screenshot_2017-01-09_11-06-32.png" alt=""><br>可以看到，我自己设置的是默认不安装gtk支持的，所以我们要加上，有以下两种方法：</p><ul><li>可以直接在/etc/portage/make.conf USE标记上加上gtk的支持</li><li>直接定义USE标记，加上gtk的支持<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USE&#x3D;&quot;X autostart cairo dbus enchant introspection nls pango qt4 table xml -debug gtk2 gtk3 -lua -opencc -static-libs &#123;-test&#125;&quot; sudo emerge fcitx</span><br></pre></td></tr></table></figure></li></ul><blockquote><p>最后，重新编译安装过fcitx以后，再看一下<code>fcitx-diagnose</code>，只要没有红色相关字体的警告信息，就说明已经可以正常使用了。把浏览器重启一下，如果还不行，得重启一下系统。</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;起因&quot;&gt;&lt;a href=&quot;#起因&quot; class=&quot;headerlink&quot; title=&quot;起因&quot;&gt;&lt;/a&gt;起因&lt;/h3&gt;&lt;p&gt;使用的gentoo有半年没有更新系统了，原来用的好好的输入法，更新完以后，在其他的程序都可以正常使用fcitx。但是，在chrome,fir
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="chrome" scheme="http://hcaijin.com/tags/chrome/"/>
    
      <category term="firefox" scheme="http://hcaijin.com/tags/firefox/"/>
    
      <category term="fcitx" scheme="http://hcaijin.com/tags/fcitx/"/>
    
  </entry>
  
  <entry>
    <title>Linux挂载Mac系统下的dmg文件</title>
    <link href="http://hcaijin.com/linuxgua-zai-mac-xi-tong-xia-de-dmgwen-jian/"/>
    <id>http://hcaijin.com/linuxgua-zai-mac-xi-tong-xia-de-dmgwen-jian/</id>
    <published>2016-05-26T21:06:32.000Z</published>
    <updated>2016-05-26T22:49:36.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近想在virtualbox下安装Mac系统，了解到Mac的安装镜像文件是dmg格式的，并下载到了 Install OS X Yosemite 10.10.1.dmg 安装包。</p></blockquote><h2 id="解压缩"><a href="#解压缩" class="headerlink" title="解压缩"></a>解压缩</h2><p>本来以为Mac的安装与其他系统的类似，只要把镜像包在虚拟机中做为cd启动就可以了，然而并没什么用 - -</p><p>这不，想到把dmg格式的包转化为iso的格式再在虚拟机中启动，这就有了这篇文章的问题了。</p><p>google到这个工具acetoneiso可以直接把dmg格式的转为iso</p><p>但是，我想是不是可以用更简单的方法来操作。<br>现在的dmg一般都使用(zlib 或者 bzip2压缩算法)压缩过</p><p>需要使用dmg2img把dmg文件转为img</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dmg2img Install\ OS\ X\ Yosemite\ 10.10.1.dmg yosemite.img</span><br></pre></td></tr></table></figure><p>提示如，就表示成功了：<br>Archive successfully decompressed as yosemite.img</p><h2 id="检查模块"><a href="#检查模块" class="headerlink" title="检查模块"></a>检查模块</h2><p>在挂载之前我们要先确保hfsplus模块启用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsmod | grep hfs</span><br></pre></td></tr></table></figure><p>如果没有输出，就表示模块未启用，使用如下命令启用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe hfsplus</span><br></pre></td></tr></table></figure><h2 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h2><p>启用成功后，就可以用mount挂载img，这里我挂载失败，提示存在坏道，在<a href="http://www.linuxquestions.org/questions/linux-software-2/how-to-mount-dos-img-file-4175430554/" target="_blank" rel="noopener">这里</a>才找到了解决的方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mount -t hfsplus -o loop my.img &#x2F;mnt&#x2F;hfs</span><br><span class="line"></span><br><span class="line">mount: wrong fs type, bad option, bad superblock on &#x2F;dev&#x2F;loop0,</span><br><span class="line">       missing codepage or helper program, or other error</span><br><span class="line">       In some cases useful info is found in syslog - try</span><br><span class="line">       dmesg | tail or so</span><br></pre></td></tr></table></figure><h3 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h3><p>查询系统日志在最下面提示如下信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dmesg | tail </span><br><span class="line">[2015609.436682] hfsplus: unable to find HFS+ superblock</span><br></pre></td></tr></table></figure><p>解决方案：</p><p>1.先用fdisk查询img扇区<br><img data-src="/content/images/2016/05/--_2016-05-27_17-42-21.png" alt=""><br>可以看到它有两个设备<em>.img1,</em>.img2</p><p>2.把img的文件挂载出来就得找到开始挂载的起始扇区，所以要设置一下offset的值，<br>这里<code>offset=1259643×512</code>，运行以下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t hfsplus -v -o loop,offset&#x3D;644937216 yosemite.img &#x2F;mnt&#x2F;hfs</span><br></pre></td></tr></table></figure><p>以上，就可以把镜像挂载到了目录/mnt/hfs下。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;最近想在virtualbox下安装Mac系统，了解到Mac的安装镜像文件是dmg格式的，并下载到了 Install OS X Yosemite 10.10.1.dmg 安装包。&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;解压缩&quot;&gt;&lt;a href
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="mount" scheme="http://hcaijin.com/tags/mount/"/>
    
      <category term="mac" scheme="http://hcaijin.com/tags/mac/"/>
    
      <category term="virtualbox" scheme="http://hcaijin.com/tags/virtualbox/"/>
    
  </entry>
  
  <entry>
    <title>idea tomcat 启动web应用异常处理</title>
    <link href="http://hcaijin.com/idea-tomcat-qi-dong-webying-yong-yi-chang-chu-li/"/>
    <id>http://hcaijin.com/idea-tomcat-qi-dong-webying-yong-yi-chang-chu-li/</id>
    <published>2016-05-10T21:28:04.000Z</published>
    <updated>2016-05-10T21:36:39.000Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2016-05-11 16:36:25.799 [RMI TCP Connection(4)-127.0.0.1] ERROR org.springframework.web.context.ContextLoader - Context initialization failed</span><br><span class="line">org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;shiroFilter&#39; defined in file [&#x2F;home&#x2F;hcj&#x2F;Work&#x2F;data&#x2F;ecerp-saas&#x2F;Sources&#x2F;ecerp&#x2F;out&#x2F;artifacts&#x2F;ecerp_web_war_exploded&#x2F;WEB-INF&#x2F;classes&#x2F;spring&#x2F;applicationContext.xml]: Cannot resolve reference to bean &#39;securityManager&#39; while setting bean property &#39;securityManager&#39;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;securityManager&#39; defined in file [&#x2F;home&#x2F;hcj&#x2F;Work&#x2F;data&#x2F;ecerp-saas&#x2F;Sources&#x2F;ecerp&#x2F;out&#x2F;artifacts&#x2F;ecerp_web_war_exploded&#x2F;WEB-INF&#x2F;classes&#x2F;spring&#x2F;applicationContext.xml]: Cannot resolve reference to bean &#39;shiroSubjectFactory&#39; while setting bean property &#39;subjectFactory&#39;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;shiroSubjectFactory&#39;: Injection of autowired dependencies failed; nested exception is org.springframework.beans.factory.BeanCreationException: Could not autowire field: private gy.erp.service.admin.SecurityMonitor gy.erp.shiro.ShiroSubjectFactory.securityMonitor; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;securityMonitor&#39; defined in class path resource [spring-domain.xml]: Cannot resolve reference to bean &#39;sessionService&#39; while setting bean property &#39;sessionService&#39;; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;sessionService&#39;: FactoryBean threw exception on object creation; nested exception is java.lang.IllegalArgumentException: Invalid registry store file &#x2F;data&#x2F;erp.guanyisoft.com&#x2F;tomcat&#x2F;ecerp-web.properties, cause: Failed to create directory &#x2F;data&#x2F;erp.guanyisoft.com&#x2F;tomcat!</span><br><span class="line">at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveReference(BeanDefinitionValueResolver.java:329) ~[spring-beans-3.2.0.RELEASE.jar:3.2.0.RELEASE]</span><br><span class="line">at org.springframework.beans.factory.support.BeanDefinitionValueResolver.resolveValueIfNecessary(BeanDefinitionValueResolver.java:107) ~[spring-beans-3.2.0.RELEASE.jar:3.2.0.RELEASE]</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyPropertyValues(AbstractAutowireCapableBeanFactory.java:1391) ~[spring-beans-3.2.0.RELEASE.jar:3.2.0.RELEASE]</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1132) ~[spring-beans-3.2.0.RELEASE.jar:3.2.0.RELEASE]</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:522) ~[spring-beans-3.2.0.RELEASE.jar:3.2.0.RELEASE]</span><br><span class="line">at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:461) ~[spring-beans-3.2.0.RELEASE.jar:3.2.0.RELEASE]</span><br><span class="line">at org.</span><br></pre></td></tr></table></figure><p>java报错总要看异常信息，以上主要关键的地方列在这里：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;nested exception is java.lang.IllegalArgumentException: Invalid registry store file &#x2F;data&#x2F;erp.guanyisoft.com&#x2F;tomcat&#x2F;ecerp-web.properties, cause: Failed to create directory &#x2F;data&#x2F;erp.guanyisoft.com&#x2F;tomcat!</span><br></pre></td></tr></table></figure><p>idea tomcat 在启动web应用的时候会生成一个注册dubbo服务的文件，需要指定生成路径，以前项目都是默认生成在out文件里的吧，最近，不知道什么变动，需要手工在项目配置文件application.properties 指定一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dubbo.registry.file &#x3D; &#x2F;home&#x2F;hcj&#x2F;Work&#x2F;data&#x2F;ecerp-web.properties</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class
      
    
    </summary>
    
    
    
      <category term="java" scheme="http://hcaijin.com/tags/java/"/>
    
      <category term="tomcat" scheme="http://hcaijin.com/tags/tomcat/"/>
    
      <category term="idea" scheme="http://hcaijin.com/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>Linux 声卡驱动问题</title>
    <link href="http://hcaijin.com/linux-sheng-qia-qu-dong-wen-ti/"/>
    <id>http://hcaijin.com/linux-sheng-qia-qu-dong-wen-ti/</id>
    <published>2016-03-20T17:54:57.000Z</published>
    <updated>2016-03-21T03:19:51.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近转Gentoo，一切安装就绪了，但是想使用youtube观看视频的时候，竟没有声音，估计又得折腾一下了。</p></blockquote><p>（Advanced Linux Sound Architecture，ALSA）是Linux中提供声音设备驱动的内核组件，用来代替原来的开放声音系统（Open Sound System，OSSv3）。</p><ul><li>系统环境：Linux hcj.com 4.1.15-gentoo-r1</li><li>组件：alsa</li><li>前提：内核已经配置支持</li></ul><h3 id="硬件设备显示"><a href="#硬件设备显示" class="headerlink" title="硬件设备显示"></a>硬件设备显示</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep -i audio</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-21_22-46-22.png" alt=""></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">euse -E alsa</span><br><span class="line">emerge --ask --changed-use --deep @world</span><br><span class="line">emerge --ask alsa-utils</span><br></pre></td></tr></table></figure><h3 id="启动声音服务"><a href="#启动声音服务" class="headerlink" title="启动声音服务"></a>启动声音服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;init.d&#x2F;alsasound start</span><br><span class="line">rc-update add alsasound boot      ###声音服务设置boot级别</span><br></pre></td></tr></table></figure><h3 id="列出设备名"><a href="#列出设备名" class="headerlink" title="列出设备名"></a>列出设备名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;sys&#x2F;class&#x2F;sound&#x2F;card*&#x2F;id</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-22_07-16-34.png" alt=""></p><h3 id="配置默认设备"><a href="#配置默认设备" class="headerlink" title="配置默认设备"></a>配置默认设备</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~&#x2F;.asoundrc</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-22_07-17-59.png" alt=""></p><p>最后，别忘了重启一下。</p><p><a href="https://wiki.archlinux.org/index.php/Advanced_Linux_Sound_Architecture" target="_blank" rel="noopener">参考链接1</a></p><p><a href="https://wiki.gentoo.org/wiki/ALSA" target="_blank" rel="noopener">参考链接2</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;最近转Gentoo，一切安装就绪了，但是想使用youtube观看视频的时候，竟没有声音，估计又得折腾一下了。&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;（Advanced Linux Sound Architecture，ALSA）是Linux中提供声音
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="alsamixer" scheme="http://hcaijin.com/tags/alsamixer/"/>
    
  </entry>
  
  <entry>
    <title>Gentoo安装RTL8723BE无线网卡驱动</title>
    <link href="http://hcaijin.com/an-zhuang-rtl8723bewu-xian-wang-qia-qu-dong/"/>
    <id>http://hcaijin.com/an-zhuang-rtl8723bewu-xian-wang-qia-qu-dong/</id>
    <published>2016-03-16T23:40:43.000Z</published>
    <updated>2016-03-17T00:43:22.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>新配了个ThinkPad E55c 安装Gentoo时无线网卡没能正确识别。网上查了一下是3.15内核版本之前还没有包含这个驱动，需要手动安装一下。但是我想说我安装的内核版本是4.1,而且也安装了linux-firmware固件，可是怎么就没有这个驱动呢 - - 暂时先不深究。</p></blockquote><ul><li>内核版本：Kernel: x86_64 Linux 4.1.15-gentoo-r1</li><li>网卡型号：RTL8723BE</li></ul><h3 id="确认网卡型号"><a href="#确认网卡型号" class="headerlink" title="确认网卡型号"></a>确认网卡型号</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci -k | grep Network</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-18_04-16-28.png" alt=""></p><h3 id="下载源码"><a href="#下载源码" class="headerlink" title="下载源码"></a>下载源码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;lwfinger&#x2F;rtlwifi_new.git</span><br><span class="line">cd rtlwifi_new&#x2F;</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><h3 id="手动加载模块"><a href="#手动加载模块" class="headerlink" title="手动加载模块"></a>手动加载模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">modprobe rtl8723be        ## 手动加载rtl8723be模块</span><br><span class="line">modinfo rtl8723be         ## 查看模块详情</span><br></pre></td></tr></table></figure><p>模块加载成功，使用<code>lspci -k</code>看一下,如果显示的是如下图说明无线网卡驱动安装成功：<br><img data-src="/content/images/2016/03/--_2016-03-18_04-17-37.png" alt=""><br>最后<code>ip addr show</code>可以看到对应的网卡设备了<br><img data-src="/content/images/2016/03/--_2016-03-18_04-30-58.png" alt=""></p><h3 id="自启动加载模块"><a href="#自启动加载模块" class="headerlink" title="自启动加载模块"></a>自启动加载模块</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;conf.d&#x2F;modules</span><br><span class="line">modules&#x3D;&quot;rtl8723be&quot;</span><br></pre></td></tr></table></figure><p><a href="https://wiki.archlinux.org/index.php/Wireless_network_configuration" target="_blank" rel="noopener">引用</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;新配了个ThinkPad E55c 安装Gentoo时无线网卡没能正确识别。网上查了一下是3.15内核版本之前还没有包含这个驱动，需要手动安装一下。但是我想说我安装的内核版本是4.1,而且也安装了linux-firmware固件，可是怎么就没有这个驱
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="Gentoo" scheme="http://hcaijin.com/tags/Gentoo/"/>
    
      <category term="rtl8723be" scheme="http://hcaijin.com/tags/rtl8723be/"/>
    
  </entry>
  
  <entry>
    <title>git常规使用</title>
    <link href="http://hcaijin.com/gitshi-yong/"/>
    <id>http://hcaijin.com/gitshi-yong/</id>
    <published>2016-03-14T18:21:09.000Z</published>
    <updated>2016-03-27T14:20:13.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="远程仓库有master和dev分支"><a href="#远程仓库有master和dev分支" class="headerlink" title="远程仓库有master和dev分支"></a>远程仓库有master和dev分支</h3><h4 id="克隆代码"><a href="#克隆代码" class="headerlink" title="克隆代码"></a>克隆代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone &lt;git url&gt;</span><br></pre></td></tr></table></figure><h4 id="查看所有分支"><a href="#查看所有分支" class="headerlink" title="查看所有分支"></a>查看所有分支</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --all</span><br></pre></td></tr></table></figure><blockquote><p>默认有了dev和master分支，所以会看到如下三个分支</p></blockquote><ul><li>master[本地主分支]</li><li>origin/master[远程主分支]</li><li>origin/dev[远程开发分支]</li></ul><p>==新克隆下来的代码默认master和origin/master是关联的，也就是他们的代码保持同步，但是origin/dev分支在本地没有任何的关联，所以我们无法在那里开发==</p><h4 id="创建本地关联origin-dev的分支"><a href="#创建本地关联origin-dev的分支" class="headerlink" title="创建本地关联origin/dev的分支"></a>创建本地关联origin/dev的分支</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev origin&#x2F;dev</span><br></pre></td></tr></table></figure><p>创建本地分支dev，并且和远程origin/dev分支关联，本地dev分支的初始代码和远程的dev分支代码一样</p><h4 id="切换到dev分支进行开发"><a href="#切换到dev分支进行开发" class="headerlink" title="切换到dev分支进行开发"></a>切换到dev分支进行开发</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev  # 这个是切换到dev分支，然后就是常规的开发</span><br></pre></td></tr></table></figure><h3 id="假设远程仓库只有mater分支"><a href="#假设远程仓库只有mater分支" class="headerlink" title="假设远程仓库只有mater分支"></a>假设远程仓库只有mater分支</h3><h4 id="克隆代码-1"><a href="#克隆代码-1" class="headerlink" title="克隆代码"></a>克隆代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone &lt;git url&gt;</span><br></pre></td></tr></table></figure><h4 id="查看所有分支-1"><a href="#查看所有分支-1" class="headerlink" title="查看所有分支"></a>查看所有分支</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --all</span><br></pre></td></tr></table></figure><blockquote><p>默认只有master分支，所以会看到如下两个分支</p></blockquote><ul><li>master[本地主分支]</li><li>origin/master[远程主分支]</li></ul><p>==新克隆下来的代码默认master和origin/master是关联的，也就是他们的代码保持同步==</p><h4 id="创建本地新的dev分支"><a href="#创建本地新的dev分支" class="headerlink" title="创建本地新的dev分支"></a>创建本地新的dev分支</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch dev  # 创建本地分支</span><br><span class="line">git branch  # 查看分支</span><br></pre></td></tr></table></figure><p>这时会看到master和dev，而且master上会有一个星号<br>这个时候dev是一个本地分支，远程仓库不知道它的存在<br>本地分支可以不同步到远程仓库，我们可以在dev开发，然后merge到master，使用master同步代码，当然也可以同步</p><h4 id="发布dev分支"><a href="#发布dev分支" class="headerlink" title="发布dev分支"></a>发布dev分支</h4><p>发布dev分支指的是同步dev分支的代码到远程服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin dev:dev  # 这样远程仓库也有一个dev分支了</span><br></pre></td></tr></table></figure><h4 id="在dev分支开发代码"><a href="#在dev分支开发代码" class="headerlink" title="在dev分支开发代码"></a>在dev分支开发代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout dev  # 切换到dev分支进行开发</span><br></pre></td></tr></table></figure><blockquote><p>开发代码之后，我们有两个选择</p></blockquote><ul><li>第一个：如果功能开发完成了，可以合并主分支</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git checkout master  # 切换到主分支</span><br><span class="line">git merge dev  # 把dev分支的更改和master合并</span><br><span class="line">git push  # 提交主分支代码远程</span><br><span class="line">git checkout dev  # 切换到dev远程分支</span><br><span class="line">git push  # 提交dev分支到远程</span><br></pre></td></tr></table></figure><ul><li>第二个：如果功能没有完成，可以直接推送</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push  # 提交到dev远程分支</span><br></pre></td></tr></table></figure><p>== 注意：在分支切换之前最好先commit全部的改变，除非你真的知道自己在做什么 ==</p><h4 id="删除分支"><a href="#删除分支" class="headerlink" title="删除分支"></a>删除分支</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :dev  # 删除远程dev分支，危险命令哦</span><br></pre></td></tr></table></figure><blockquote><p>下面两条是删除本地分支</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout master  # 切换到master分支</span><br><span class="line">git branch -d dev  # 删除本地dev分支</span><br></pre></td></tr></table></figure><h4 id="progit-pdf"><a href="#progit-pdf" class="headerlink" title="progit.pdf"></a>progit.pdf</h4><p>书籍格式和语言：中文、英文、PDF、ePub<br>下载地址：<a href="http://git-scm.com/book" target="_blank" rel="noopener">http://git-scm.com/book</a></p><p><a href="https://www.zhihu.com/question/21995370/answer/19975870" target="_blank" rel="noopener">转载</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;远程仓库有master和dev分支&quot;&gt;&lt;a href=&quot;#远程仓库有master和dev分支&quot; class=&quot;headerlink&quot; title=&quot;远程仓库有master和dev分支&quot;&gt;&lt;/a&gt;远程仓库有master和dev分支&lt;/h3&gt;&lt;h4 id=&quot;克隆代码&quot;
      
    
    </summary>
    
    
    
      <category term="git" scheme="http://hcaijin.com/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>ss-redir 的 iptables 配置(透明代理)</title>
    <link href="http://hcaijin.com/ss-redir-de-iptables-pei-zhi-tou-ming-dai-li/"/>
    <id>http://hcaijin.com/ss-redir-de-iptables-pei-zhi-tou-ming-dai-li/</id>
    <published>2016-03-09T00:22:01.000Z</published>
    <updated>2016-03-25T22:51:11.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>透明代理指对客户端透明，客户端不需要进行任何设置就使用了网管设置的代理规则<br>创建</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;ss-redir.json 本地监听 1080 运行ss-redir -v -c &#x2F;etc&#x2F;ss-redir.json</span><br></pre></td></tr></table></figure><h3 id="NAT表配置脚本"><a href="#NAT表配置脚本" class="headerlink" title="NAT表配置脚本"></a>NAT表配置脚本</h3><p>基本配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -N SHADOWSOCKS</span><br><span class="line"></span><br><span class="line"># 在 nat 表中创建新链</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -p tcp --dport 23596 -j RETURN</span><br><span class="line"></span><br><span class="line"># 23596 是 ss 代理服务器的端口，即远程 shadowsocks 服务器提供服务的端口，如果你有多个 ip 可用,但端口一致，就设置这个</span><br><span class="line"></span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 123.456.789.111 -j RETURN</span><br><span class="line"># 123.456.789.111 是 ss 代理服务器的 ip, 如果你只有一个 ss服务器的 ip，却能选择不同端口,就设置此条</span><br><span class="line"></span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 0.0.0.0&#x2F;8 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 10.0.0.0&#x2F;8 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 127.0.0.0&#x2F;8 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 169.254.0.0&#x2F;16 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 172.16.0.0&#x2F;12 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 192.168.0.0&#x2F;16 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 224.0.0.0&#x2F;4 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 240.0.0.0&#x2F;4 -j RETURN</span><br><span class="line"></span><br><span class="line">iptables -t nat -A SHADOWSOCKS -p tcp -j REDIRECT --to-ports 1080</span><br><span class="line"># 1080 是 ss-redir 的监听端口,ss-local 和 ss-redir 的监听端口不同,配置文件不同</span><br></pre></td></tr></table></figure><p>最后是应用上面的规则,将OUTPUT出去的tcp流量全部经过SOCKS链</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#如果是在openwrt上实现透明代理的话,使用下面被注释了的规则</span><br><span class="line"></span><br><span class="line">iptables -t nat -I PREROUTING -p tcp -j SHADOWSOCKS</span><br><span class="line"># 在 PREROUTING 链前插入 SHADOWSOCKS 链,使其生效</span><br><span class="line"></span><br><span class="line">在个人电脑上使用以下配置</span><br><span class="line">iptables -t nat -A OUTPUT -p tcp -j SHADOWSOCKS</span><br></pre></td></tr></table></figure><h3 id="如果要过滤国内流量可以"><a href="#如果要过滤国内流量可以" class="headerlink" title="如果要过滤国内流量可以"></a>如果要过滤国内流量可以</h3><p>列表太长了就不列出来了！</p><h3 id="清除自定义规则"><a href="#清除自定义规则" class="headerlink" title="清除自定义规则"></a>清除自定义规则</h3><p>清空整个链 iptables -F 链名,比如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -F SHADOWSOCKS</span><br></pre></td></tr></table></figure><p>删除指定的用户自定义链 iptables -X 链名 比如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -X SHADOWSOCKS</span><br></pre></td></tr></table></figure><p>从所选链中删除规则 iptables -D 链名 规则详情 比如:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -D SHADOWSOCKS -d 223.223.192.0&#x2F;255.255.240.0 -j RETURN</span><br></pre></td></tr></table></figure><h3 id="解决DNS污染的问题"><a href="#解决DNS污染的问题" class="headerlink" title="解决DNS污染的问题"></a>解决DNS污染的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pacman -S archlinuxcn&#x2F;dnsmasq-china-list-git</span><br><span class="line">$ sudo dnsmasq-update-china-list 114</span><br><span class="line">####脚本如下：</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  114)</span><br><span class="line">    DNS&#x3D;114.114.114.114</span><br><span class="line">    ;;</span><br><span class="line">  ali)</span><br><span class="line">    DNS&#x3D;223.5.5.5</span><br><span class="line">    ;;</span><br><span class="line">  cnnic)</span><br><span class="line">    DNS&#x3D;1.2.4.8</span><br><span class="line">    ;;</span><br><span class="line">  baidu)</span><br><span class="line">    DNS&#x3D;180.76.76.76</span><br><span class="line">    ;;</span><br><span class="line">  google)</span><br><span class="line">    DNS&#x3D;8.8.8.8</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    DNS&#x3D;$1</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">sed -i &quot;s|^\(server.*\)&#x2F;[^&#x2F;]*$|\1&#x2F;$DNS|&quot; &#x2F;etc&#x2F;dnsmasq.d&#x2F;accelerated-domains.china.conf</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;透明代理指对客户端透明，客户端不需要进行任何设置就使用了网管设置的代理规则&lt;br&gt;创建&lt;/p&gt;&lt;/blockquote&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pr
      
    
    </summary>
    
    
    
      <category term="iptables" scheme="http://hcaijin.com/tags/iptables/"/>
    
      <category term="shadowsocks" scheme="http://hcaijin.com/tags/shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title>Linux系统挂载NTFS移动硬盘</title>
    <link href="http://hcaijin.com/linuxxi-tong-gua-zai-ntfsyi-dong-ying-pan/"/>
    <id>http://hcaijin.com/linuxxi-tong-gua-zai-ntfsyi-dong-ying-pan/</id>
    <published>2016-03-07T18:19:36.000Z</published>
    <updated>2016-03-31T13:33:10.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>工作中，同事之间拷贝数据的时候，由于我用的linux系统无法识别同事的NTFS移动硬盘，这才网上查了一下，原来还得安装一个软件，以下是<a href="http://www.cnblogs.com/kerrycode/archive/2013/04/01/2993701.html" target="_blank" rel="noopener">转载</a>的文章,记录一下。</p></blockquote><hr><p>有时候做大数据量迁移时，为了快速迁移大数据，有可能在Linux服务器上临时挂载NTFS格式的移动硬盘， 一般情况下，Linux是识别不了NTFS格式移动硬盘的（需要重编译Linux核心才能，加挂NTFS分区），这时候为了能让Linux服务器能够识别NTFS的移动硬盘，就必须安装ntfs-3g（Third Generation Read/Write NTFS Driver）的包。</p><hr><p>NTFS-3G介绍<br>NTFS-3G是一个开源项目，NTFS-3G是为Linux, Android, Mac OS X, FreeBSD, NetBSD, OpenSolaris, QNX, Haiku,和其他操作系统提供的一个稳定的，功能齐全，读写NTFS的驱动程序的。它提供了安全处理Windows XP，Windows Server 2003，Windows 2000，Windows Vista，Windows Server 2008和Windows 7操作系统下的NTFS文件系统。</p><p>NTFS-3g是一个开源软件，它支持在Linux下面读写NTFS格式的分区。它非常的快速，同时也很安全。它支持Windows 2000、XP、2003和Vista，并且支持所有的符合POSIX标准的磁盘操作。 ntfs-3g的目的是为了持续的发展，各硬件平台和操作系统的用户需要可靠的互通与支持ntfs的驱动，ntfs-3g可以提供可信任的、功能丰富的高性能解决方案。经过了12年多的发展，ntfs-3g已经逐渐稳定；</p><blockquote><p>资料介绍</p></blockquote><ul><li>官方网址：<a href="http://www.tuxera.com/，" target="_blank" rel="noopener">http://www.tuxera.com/，</a></li><li>文档手册：<a href="http://www.tuxera.com/community/ntfs-3g-manual/" target="_blank" rel="noopener">http://www.tuxera.com/community/ntfs-3g-manual/</a></li><li>下载地址：<a href="http://www.tuxera.com/community/ntfs-3g-download/" target="_blank" rel="noopener">http://www.tuxera.com/community/ntfs-3g-download/</a></li></ul><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="解压安装NTFS-3G。"><a href="#解压安装NTFS-3G。" class="headerlink" title="解压安装NTFS-3G。"></a>解压安装NTFS-3G。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf ntfs-3g_ntfsprogs-2012.1.15.tgz　　</span><br><span class="line">cd ntfs-3g_ntfsprogs-2012.1.15</span><br><span class="line">　　.&#x2F;configure </span><br><span class="line">　　make </span><br><span class="line">　　make install</span><br></pre></td></tr></table></figure><p><em>如果没有报错，提示安装成功，下面就可以用ntfs-3g来实现对NTFS分区的读写了</em></p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="配置挂载NTFS格式的移动硬盘"><a href="#配置挂载NTFS格式的移动硬盘" class="headerlink" title="配置挂载NTFS格式的移动硬盘"></a>配置挂载NTFS格式的移动硬盘</h4><h5 id="首先得到NTFS分区的信息"><a href="#首先得到NTFS分区的信息" class="headerlink" title="首先得到NTFS分区的信息"></a>首先得到NTFS分区的信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fdisk -l | grep NTFS</span><br><span class="line">&#x2F;dev&#x2F;sdc1 * 1 244 1955776+ 7 HPFS&#x2F;NTFS</span><br></pre></td></tr></table></figure><h5 id="设置挂载点，用如下命令实现挂载"><a href="#设置挂载点，用如下命令实现挂载" class="headerlink" title="设置挂载点，用如下命令实现挂载"></a>设置挂载点，用如下命令实现挂载</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ntfs-3g &lt;NTFS Partition&gt; &lt;Mount Point&gt;</span><br></pre></td></tr></table></figure><blockquote><p>例如得到的NTFS分区信息为/dev/sdc1，挂载点设置在/mnt/usb下:</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mount -t ntfs-3g &#x2F;dev&#x2F;sdc1 &#x2F;mnt&#x2F;usb </span><br><span class="line">########## 或者直接用 #######</span><br><span class="line">$ ntfs-3g ntfs-3g &#x2F;dev&#x2F;sdc1 &#x2F;mnt&#x2F;usb</span><br></pre></td></tr></table></figure><h4 id="如果想实现开机自动挂载，可以在-etc-fstab里面添加如下格式语句"><a href="#如果想实现开机自动挂载，可以在-etc-fstab里面添加如下格式语句" class="headerlink" title="如果想实现开机自动挂载，可以在/etc/fstab里面添加如下格式语句"></a>如果想实现开机自动挂载，可以在/etc/fstab里面添加如下格式语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;NTFS Partition&gt; &lt;Mount Point&gt; ntfs-3g silent,umask&#x3D;0,locale&#x3D;zh_CN.utf8 0 0</span><br></pre></td></tr></table></figure><p>==这样可以实现NTFS分区里中文文件名的显示。 ==</p><p>　　</p><h3 id="卸载分区"><a href="#卸载分区" class="headerlink" title="卸载分区"></a>卸载分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ umount &lt;NTFS Partition&gt; 　　</span><br><span class="line">##### 或者 #####</span><br><span class="line">$ umount &lt;Mount Point&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;工作中，同事之间拷贝数据的时候，由于我用的linux系统无法识别同事的NTFS移动硬盘，这才网上查了一下，原来还得安装一个软件，以下是&lt;a href=&quot;http://www.cnblogs.com/kerrycode/archive/2013/04/
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="ntfs" scheme="http://hcaijin.com/tags/ntfs/"/>
    
  </entry>
  
  <entry>
    <title>Linux gentoo U盘安装指南</title>
    <link href="http://hcaijin.com/gentoo-upan-an-zhuang-zhi-nan/"/>
    <id>http://hcaijin.com/gentoo-upan-an-zhuang-zhi-nan/</id>
    <published>2016-03-04T17:43:55.000Z</published>
    <updated>2016-03-07T20:23:30.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>再一次捣鼓gentoo,还是遇到了相当多的麻烦，这里把安装的方法重新在blog里整理一下，跟着官方安装步骤一点点来。</p></blockquote><h2 id="准备安装之前"><a href="#准备安装之前" class="headerlink" title="准备安装之前"></a>准备安装之前</h2><h3 id="下载gentoo所需的引导镜像和系统文件压缩包"><a href="#下载gentoo所需的引导镜像和系统文件压缩包" class="headerlink" title="下载gentoo所需的引导镜像和系统文件压缩包"></a>下载gentoo所需的引导镜像和系统文件压缩包</h3><p>下载地址：<br><a href="https://www.gentoo.org/downloads/" target="_blank" rel="noopener">https://www.gentoo.org/downloads/</a></p><p>主要文件：</p><ul><li>install-amd64-minimal-20160303.iso</li><li>portage-latest.tar.bz2</li><li>stage3-amd64-20160303.tar.bz2</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir gentoo&#x2F;  &amp;&amp; cd gentoo&#x2F;</span><br><span class="line">$ wget -c  # http:&#x2F;&#x2F;mirrors.163.com&#x2F;gentoo&#x2F;releases&#x2F;amd64&#x2F;autobuilds&#x2F;20160303&#x2F;install-amd64-minimal-20160303.iso</span><br><span class="line">$ wget -c http:&#x2F;&#x2F;mirrors.163.com&#x2F;gentoo&#x2F;snapshots&#x2F;portage-latest.tar.bz2</span><br><span class="line">$ wget -c http:&#x2F;&#x2F;mirrors.163.com&#x2F;gentoo&#x2F;releases&#x2F;amd64&#x2F;autobuilds&#x2F;20160303&#x2F;stage3-amd64-20160303.tar.bz2</span><br></pre></td></tr></table></figure><h3 id="U盘准备"><a href="#U盘准备" class="headerlink" title="U盘准备"></a>U盘准备</h3><p>插入U盘，查看U盘设备名,不需求挂载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">$ sudo dd if&#x3D;install-amd64-minimal-20160303.iso of&#x3D;&#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure><p>这样，就制作好了U盘启动了，把U盘插入要安装的机子，配置BIOS通过U盘启动，就可以进入光盘引导的临时系统。</p><h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><h3 id="配置临时系统"><a href="#配置临时系统" class="headerlink" title="配置临时系统"></a>配置临时系统</h3><blockquote><p>安装gentoo最主要是先把网络配置好，这里我安装的时候遇到了个非常郁闷的问题，就是，公司的个别网段限制下载，导致我在配置网络的时候浪费了不少时间，所以最好先确认一下，你所在的网段是否可以使用wget下载文件。</p></blockquote><h4 id="配置IP"><a href="#配置IP" class="headerlink" title="配置IP"></a>配置IP</h4><p>通常启动U盘临时系统应该可以dhcp分配到一个ip,但是我因为是公司的网络，所以最好手动配置一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ip addr add 192.168.3.155&#x2F;24 dev enp0s25</span><br><span class="line"># ip route add default via 192.168.3.1 dev enp0s25</span><br><span class="line"># echo &quot;192.168.1.1&quot; &gt; &#x2F;etc&#x2F;resolv.conf</span><br></pre></td></tr></table></figure><h4 id="配置ssh链接"><a href="#配置ssh链接" class="headerlink" title="配置ssh链接"></a>配置ssh链接</h4><p>为了方便，最好远程链接到临时系统下，那么就得配置sshd服务。</p><p>==Tip: 最新的sshd服务器默认限制root登陆，需要修改一下/etc/ssh/sshd_config<br>配置PermitRootLogin 为 yes==</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;sshd start</span><br><span class="line"># passwd root               ####配置root用户密码</span><br></pre></td></tr></table></figure><p>以上，我们就可以到本机，使用ssh远程登陆这个U盘挂启的临时系统了</p><h3 id="安装到硬盘上"><a href="#安装到硬盘上" class="headerlink" title="安装到硬盘上"></a>安装到硬盘上</h3><h4 id="系统分区fdisk"><a href="#系统分区fdisk" class="headerlink" title="系统分区fdisk"></a>系统分区fdisk</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># fdisk -l</span><br><span class="line">Device     Boot     Start       End   Sectors  Size Id Type</span><br><span class="line">&#x2F;dev&#x2F;sda1            2048      6143      4096    2M ef EFI (FAT-12&#x2F;16&#x2F;32)</span><br><span class="line">&#x2F;dev&#x2F;sda2            6144    268287    262144  128M 83 Linux</span><br><span class="line">&#x2F;dev&#x2F;sda3          268288  17045503  16777216    8G 82 Linux swap &#x2F; Solaris</span><br><span class="line">&#x2F;dev&#x2F;sda4        17045504 937703087 920657584  439G  5 Extended</span><br><span class="line">&#x2F;dev&#x2F;sda5        17047552 226762751 209715200  100G 83 Linux</span><br><span class="line">&#x2F;dev&#x2F;sda6       226764800 937703087 710938288  339G 83 Linux</span><br><span class="line"># fdisk &#x2F;dev&#x2F;sda</span><br></pre></td></tr></table></figure><p>使用fdisk分区以前有详细的说明过，在这里就不再说了。不懂的，请写看一下这个<br><a href="https://www.hcaijin.com/shu-mei-pai-an-zhuang-gentoo-linux/" target="_blank" rel="noopener">树莓派安装Gentoo Linux</a> 1.1.3 节</p><p>也可以参照 <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Disks" target="_blank" rel="noopener">官方分区方案</a></p><h4 id="重新读取sda分区表"><a href="#重新读取sda分区表" class="headerlink" title="重新读取sda分区表:"></a>重新读取sda分区表:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># partx -a &#x2F;dev&#x2F;sda</span><br></pre></td></tr></table></figure><h4 id="格式化分区为文件系统"><a href="#格式化分区为文件系统" class="headerlink" title="格式化分区为文件系统"></a>格式化分区为文件系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mkfs.ext2 &#x2F;dev&#x2F;sda2</span><br><span class="line"># mkfs.ext4 &#x2F;dev&#x2F;sda5</span><br><span class="line"># mkfs.ext4 &#x2F;dev&#x2F;sda6</span><br></pre></td></tr></table></figure><h4 id="格式化swap分区并激活"><a href="#格式化swap分区并激活" class="headerlink" title="格式化swap分区并激活"></a>格式化swap分区并激活</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkswap &#x2F;dev&#x2F;sda3</span><br><span class="line"># swapon &#x2F;dev&#x2F;sda3</span><br></pre></td></tr></table></figure><h4 id="创建系统临时挂载点"><a href="#创建系统临时挂载点" class="headerlink" title="创建系统临时挂载点"></a>创建系统临时挂载点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># mount &#x2F;dev&#x2F;sda5 &#x2F;mnt&#x2F;gentoo</span><br><span class="line"># mkdir -p &#x2F;mnt&#x2F;gentoo&#x2F;&#123;boot,home,&#125;</span><br><span class="line"># mount &#x2F;dev&#x2F;sda2 &#x2F;mnt&#x2F;gentoo&#x2F;boot</span><br><span class="line"># mount &#x2F;dev&#x2F;sda6 &#x2F;mnt&#x2F;gentoo&#x2F;home</span><br></pre></td></tr></table></figure><h3 id="设定日期和时间"><a href="#设定日期和时间" class="headerlink" title="设定日期和时间"></a>设定日期和时间</h3><p>安装Gentoo之前，请确保日期和时间是否正确设置。错误配置的时钟可能会产生各种奇怪的错误！==主要==！！！</p><p>要验证当前日期和时间，运行日期：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># date</span><br><span class="line">Sat Mar  5 16:26:08 UTC 2016</span><br></pre></td></tr></table></figure><p>如果时间不对，请使用 <code>MMDDhhmmYYYY</code> 这样的格式配置一下日期和时间</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date 030516262016</span><br></pre></td></tr></table></figure><h3 id="下载和解压相关包"><a href="#下载和解压相关包" class="headerlink" title="下载和解压相关包"></a>下载和解压相关包</h3><h4 id="使用临时系统自带的links下载stage3和portage"><a href="#使用临时系统自带的links下载stage3和portage" class="headerlink" title="使用临时系统自带的links下载stage3和portage"></a>使用临时系统自带的links下载stage3和portage</h4><p>==Tip: 如果前面已经在本机下载过了可以跳过这一步==</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># links https:&#x2F;&#x2F;www.gentoo.org&#x2F;downloads&#x2F;mirrors&#x2F;</span><br></pre></td></tr></table></figure><p>或者配置代理下载：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># links -http-proxy proxy.server.com:8080   https:&#x2F;&#x2F;www.gentoo.org&#x2F;downloads&#x2F;mirrors&#x2F;</span><br></pre></td></tr></table></figure><h4 id="效验下载的文件"><a href="#效验下载的文件" class="headerlink" title="效验下载的文件"></a>效验下载的文件</h4><p>效验下载的文件是否完整，打开 .DIGESTS(.asc) 相关文件对比sha512加密的是否一至。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># openssl dgst -r -sha512 stage3-amd64-20160303.tar.bz2</span><br></pre></td></tr></table></figure><h4 id="解压stage3和portage"><a href="#解压stage3和portage" class="headerlink" title="解压stage3和portage"></a>解压stage3和portage</h4><p>把下载好的stage3和portage放到/mnt/gentoo目录下，进入目录解压：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;mnt&#x2F;gentoo&#x2F;</span><br><span class="line"># tar xvjpf stage3-*.tar.bz2 --xattrs</span><br></pre></td></tr></table></figure><p>==注: stage3解压的文件是Gentoo的目录结构，所以要解压到临时的系统目录下,即/mnt/gentoo，方便后面进行chroot==</p><p>下面解压portage，这个解压需要一点时间。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># tar jxvf portage-latest.tar.bz2 -C &#x2F;mnt&#x2F;gentoo&#x2F;usr</span><br></pre></td></tr></table></figure><p>==注: portage-latest.tar.bz2解压的文件为系统软件目录结构,需要解压到/mnt/gentoo/usr目录下==</p><h3 id="安装基本gentoo系统"><a href="#安装基本gentoo系统" class="headerlink" title="安装基本gentoo系统"></a>安装基本gentoo系统</h3><h4 id="配置portage-make-参数"><a href="#配置portage-make-参数" class="headerlink" title="配置portage make 参数"></a>配置portage make 参数</h4><ul><li>配置了MAKEOPTS为cpu核心数+1</li><li>配置就近的镜像地址 GETOO_MIRRORS 为厦门大学的镜像源<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;portage&#x2F;make.conf</span><br></pre></td></tr></table></figure><img data-src="/content/images/2016/03/--_2016-03-05_16-53-28.png" alt=""></li></ul><p>==Tip: 参数配置文件/mnt/gentoo/usr/share/portage/config/make.conf.example ==</p><h4 id="配置主要Gentoo的存储库"><a href="#配置主要Gentoo的存储库" class="headerlink" title="配置主要Gentoo的存储库"></a>配置主要Gentoo的存储库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir &#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;portage&#x2F;repos.conf</span><br><span class="line"># cp &#x2F;mnt&#x2F;gentoo&#x2F;usr&#x2F;share&#x2F;portage&#x2F;config&#x2F;repos.conf &#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;portage&#x2F;repos.conf&#x2F;gentoo.conf</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-05_17-00-14.png" alt=""></p><h4 id="配置chroot环境的dns"><a href="#配置chroot环境的dns" class="headerlink" title="配置chroot环境的dns"></a>配置chroot环境的dns</h4><p>只需要把livecd临时环境的resolv.conf复制到要chroot的目录里就好了，如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -L &#x2F;etc&#x2F;resolv.conf &#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;</span><br></pre></td></tr></table></figure><h4 id="挂载必要的文件系统"><a href="#挂载必要的文件系统" class="headerlink" title="挂载必要的文件系统"></a>挂载必要的文件系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mount -t proc proc &#x2F;mnt&#x2F;gentoo&#x2F;proc</span><br><span class="line"># mount --rbind &#x2F;sys &#x2F;mnt&#x2F;gentoo&#x2F;sys</span><br><span class="line"># mount --make-rslave &#x2F;mnt&#x2F;gentoo&#x2F;sys</span><br><span class="line"># mount --rbind &#x2F;dev &#x2F;mnt&#x2F;gentoo&#x2F;dev</span><br><span class="line"># mount --make-rslave &#x2F;mnt&#x2F;gentoo&#x2F;dev</span><br></pre></td></tr></table></figure><h4 id="Chroot-到新的环境"><a href="#Chroot-到新的环境" class="headerlink" title="Chroot 到新的环境"></a>Chroot 到新的环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chroot &#x2F;mnt&#x2F;gentoo &#x2F;bin&#x2F;bash</span><br><span class="line"># source &#x2F;etc&#x2F;profile</span><br><span class="line"># export PS1&#x3D;&quot;(chroot) $PS1&quot;</span><br></pre></td></tr></table></figure><h4 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h4><p>这不是必要的步骤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sed -i -e &#39;s&#x2F;hostname.*&#x2F;hostname&#x3D;&quot;hcj.com&quot;&#x2F;&#39; &#x2F;etc&#x2F;conf.d&#x2F;hostname</span><br><span class="line"># echo &quot;127.0.0.1 hcj.com localhost&quot; &gt; &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure><h4 id="配置Portage"><a href="#配置Portage" class="headerlink" title="配置Portage"></a>配置Portage</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># emerge-webrsync</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-05_17-33-41.png" alt=""></p><p>我在配置这个的时候报错了，按照提示删除tmestamp.x文件即可。</p><p>更新portage树</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># emerge --sync</span><br></pre></td></tr></table></figure><p>小内存的情况使用静默模式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># emerge --sync --quiet</span><br></pre></td></tr></table></figure><h4 id="配置系统环境"><a href="#配置系统环境" class="headerlink" title="配置系统环境"></a>配置系统环境</h4><p>查看更新的通知</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># eselect news list</span><br><span class="line"># eselect news read</span><br></pre></td></tr></table></figure><p>选择适合的配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># eselect profile list</span><br><span class="line"># eselect profile set 3    ### 我选择的是桌面环境系统</span><br></pre></td></tr></table></figure><p>更新timezone</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ls &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"># echo &quot;Asia&#x2F;Shanghai&quot; &gt; &#x2F;etc&#x2F;timezone</span><br><span class="line"># emerge --config sys-libs&#x2F;timezone-data</span><br></pre></td></tr></table></figure><p>配置语言编码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># nano -w &#x2F;etc&#x2F;locale.gen</span><br><span class="line"># locale-gen</span><br><span class="line"># eselect locale list</span><br><span class="line">Available targets for the LANG variable:</span><br><span class="line">  [1]   C</span><br><span class="line">  [2]   POSIX</span><br><span class="line">  [3]   en_US</span><br><span class="line">  [4]   en_US.iso88591</span><br><span class="line">  [5]   en_US.utf8</span><br><span class="line">  [6]   zh_CN.utf8 *</span><br><span class="line">  [ ]   (free form)</span><br><span class="line"></span><br><span class="line"># eselect locale set 6</span><br></pre></td></tr></table></figure><p>更新一下环境</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># env-update &amp;&amp; source &#x2F;etc&#x2F;profile &amp;&amp; export PS1&#x3D;&quot;(chroot) $PS1&quot;</span><br></pre></td></tr></table></figure><h3 id="内核配置"><a href="#内核配置" class="headerlink" title="内核配置"></a>内核配置</h3><h4 id="安装内核源码"><a href="#安装内核源码" class="headerlink" title="安装内核源码"></a>安装内核源码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># emerge --ask sys-kernel&#x2F;gentoo-sources</span><br><span class="line"># genkernel --install initramfs</span><br></pre></td></tr></table></figure><h4 id="配置fstab"><a href="#配置fstab" class="headerlink" title="配置fstab"></a>配置fstab</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure><p><img data-src="/content/images/2016/03/--_2016-03-05_20-12-09.png" alt=""></p><h4 id="编译内核文件"><a href="#编译内核文件" class="headerlink" title="编译内核文件"></a>编译内核文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genkernel all</span><br></pre></td></tr></table></figure><p>完成以上就可以在/boot目录下看到内核文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ls &#x2F;boot&#x2F;kernel* &#x2F;boot&#x2F;initramfs*</span><br></pre></td></tr></table></figure><p>==注: genkernel编译出的内核支持几乎所有硬件，编译需要一段很长的时间，一旦genkernel运行完成，一个包括全部模块和initrd的内核将被建立。在后面配置引导程序时我们将会用到这个内核和initrd。请记下内核和initrd的名字，因为您将在配置引导程序的时候用到他们。initrd将会在启动真正的系统前自动识别硬件（如同安装光盘一样）==</p><h3 id="安装其他软件"><a href="#安装其他软件" class="headerlink" title="安装其他软件"></a>安装其他软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># emerge vim                ### 安装vim 方便后面的配置</span><br><span class="line"># emerge syslog-ng          ### 安装系统日志管理</span><br><span class="line"># rc-update add sysklogd default</span><br><span class="line"># emerge logrotate          ### 日志格式化工具</span><br><span class="line"># emerge --ask sys-process&#x2F;cronie    ### 计划任务系统</span><br><span class="line"># rc-update add cronie default</span><br><span class="line"># emerge --ask net-misc&#x2F;dhcpcd   </span><br><span class="line"># emerge --ask sys-apps&#x2F;mlocate       ### 快速索引</span><br></pre></td></tr></table></figure><h4 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;conf.d&#x2F;net</span><br><span class="line">config_enp0s25&#x3D;&quot;192.168.3.155 netmask 255.255.255.0 brd 192.168.3.255&quot;</span><br><span class="line">routes_enp0s25&#x3D;&quot;default via 192.168.3.1&quot;</span><br><span class="line"># ln -s &#x2F;etc&#x2F;init.d&#x2F;net.lo &#x2F;etc&#x2F;init.d&#x2F;net.enp0s25</span><br><span class="line"># rc-update add net.enp0s25 default</span><br><span class="line"># rc-update add sshd default</span><br></pre></td></tr></table></figure><h4 id="配置root用户密码"><a href="#配置root用户密码" class="headerlink" title="配置root用户密码"></a>配置root用户密码</h4><p>这是必要的，为了从新系统能进入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># passwd</span><br></pre></td></tr></table></figure><h3 id="配置GRUB引导程序"><a href="#配置GRUB引导程序" class="headerlink" title="配置GRUB引导程序"></a>配置GRUB引导程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># emerge --ask sys-boot&#x2F;grub:2</span><br><span class="line"># grub2-install &#x2F;dev&#x2F;sda</span><br><span class="line"># grub2-mkconfig -o &#x2F;boot&#x2F;grub&#x2F;grub.cfg</span><br></pre></td></tr></table></figure><h3 id="最后重启一下系统"><a href="#最后重启一下系统" class="headerlink" title="最后重启一下系统"></a>最后重启一下系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># exit</span><br><span class="line"># cd</span><br><span class="line"># umount -l &#x2F;mnt&#x2F;gentoo&#x2F;dev&#123;&#x2F;shm,&#x2F;pts,&#125;</span><br><span class="line"># umount &#x2F;mnt&#x2F;gentoo&#123;&#x2F;boot,&#x2F;sys,&#x2F;proc,&#125;</span><br><span class="line"># reboot</span><br></pre></td></tr></table></figure><p><a href="https://gentoo-handbook.lugons.org/doc/zh_cn/handbook/handbook-amd64.xml" target="_blank" rel="noopener">引用</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;再一次捣鼓gentoo,还是遇到了相当多的麻烦，这里把安装的方法重新在blog里整理一下，跟着官方安装步骤一点点来。&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;准备安装之前&quot;&gt;&lt;a href=&quot;#准备安装之前&quot; class=&quot;headerlin
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="Gentoo" scheme="http://hcaijin.com/tags/Gentoo/"/>
    
  </entry>
  
  <entry>
    <title>ssh 服务端配置</title>
    <link href="http://hcaijin.com/ssh-fu-wu-duan-pei-zhi/"/>
    <id>http://hcaijin.com/ssh-fu-wu-duan-pei-zhi/</id>
    <published>2016-03-04T17:32:03.000Z</published>
    <updated>2016-03-04T17:42:17.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>最近，在使用U盘安装gentoo配置sshd服务端碰到了问题，记录一下ssh服务端的配置文件。</p></blockquote><h2 id="关于-SSH-Server-的整体设定，包含使用的-port-啦，以及使用的密码演算方式"><a href="#关于-SSH-Server-的整体设定，包含使用的-port-啦，以及使用的密码演算方式" class="headerlink" title="关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式"></a>关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Port 22　　　　　　　　　　# SSH 预设使用 22 这个 port，您也可以使用多的 port ！</span><br><span class="line">　　　　　　　　　　　　　 # 亦即重复使用 port 这个设定项目即可！</span><br><span class="line">Protocol 2,1　　　　　　　 # 选择的 SSH 协议版本，可以是 1 也可以是 2 ，</span><br><span class="line">　　　　　　　　　　　　　 # 如果要同时支持两者，就必须要使用 2,1 这个分隔了！</span><br><span class="line">#ListenAddress 0.0.0.0　　 # 监听的主机适配卡！举个例子来说，如果您有两个 IP，</span><br><span class="line">　　　　　　　　　　　　　 # 分别是 192.168.0.100 及 192.168.2.20 ，那么只想要</span><br><span class="line">　　　　　　　　　　　　　 # 开放 192.168.0.100 时，就可以写如同下面的样式：</span><br><span class="line">ListenAddress 192.168.0.100          # 只监听来自 192.168.0.100 这个 IP 的SSH联机。</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 如果不使用设定的话，则预设所有接口均接受 SSH</span><br><span class="line">PidFile &#x2F;var&#x2F;run&#x2F;sshd.pid　　　　　　# 可以放置 SSHD 这个 PID 的档案！左列为默认值</span><br><span class="line">LoginGraceTime 600　　　　 # 当使用者连上 SSH server 之后，会出现输入密码的画面，</span><br><span class="line">　　　　　　　　　　　　　 # 在该画面中，在多久时间内没有成功连上 SSH server ，</span><br><span class="line">　　　　　　　　　　　　　 # 就断线！时间为秒！</span><br><span class="line">Compression yes　　　　　　# 是否可以使用压缩指令？当然可以啰！</span><br></pre></td></tr></table></figure><p>　</p><h2 id="说明主机的-Private-Key-放置的档案，预设使用下面的档案即可！"><a href="#说明主机的-Private-Key-放置的档案，预设使用下面的档案即可！" class="headerlink" title="说明主机的 Private Key 放置的档案，预设使用下面的档案即可！"></a>说明主机的 Private Key 放置的档案，预设使用下面的档案即可！</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_key　　　　# SSH version 1 使用的私钥</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key　　# SSH version 2 使用的 RSA 私钥</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key　　# SSH version 2 使用的 DSA 私钥</span><br></pre></td></tr></table></figure><h3 id="关于-version-1-的一些设定！"><a href="#关于-version-1-的一些设定！" class="headerlink" title="关于 version 1 的一些设定！"></a>关于 version 1 的一些设定！</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KeyRegenerationInterval 3600　 　　　# 由前面联机的说明可以知道， version 1 会使用 </span><br><span class="line">　　　　　　　　　　　　　　　　　　 # server 的 Public Key ，那么如果这个 Public </span><br><span class="line">　　　　　　　　　　　　　　　　　　 # Key 被偷的话，岂不完蛋？所以需要每隔一段时间</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 来重新建立一次！这里的时间为秒！</span><br><span class="line">ServerKeyBits 768 　　　　　　　　　 # 没错！这个就是 Server key 的长度！</span><br></pre></td></tr></table></figure><h2 id="关于登录文件的讯息数据放置与-daemon-的名称！"><a href="#关于登录文件的讯息数据放置与-daemon-的名称！" class="headerlink" title="关于登录文件的讯息数据放置与 daemon 的名称！"></a>关于登录文件的讯息数据放置与 daemon 的名称！</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SyslogFacility AUTH　　　　　　　　　# 当有人使用 SSH 登入系统的时候，SSH会记录资</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 讯，这个信息要记录在什么 daemon name 底下？</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 预设是以 AUTH 来设定的，即是 &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 里面！什么？忘记了！回到 Linux 基础去翻一下</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 其它可用的 daemon name 为：DAEMON,USER,AUTH,</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # LOCAL0,LOCAL1,LOCAL2,LOCAL3,LOCAL4,LOCAL5,</span><br><span class="line">LogLevel INFO　　　　　　　　　　　　# 登录记录的等级！嘿嘿！任何讯息！</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 同样的，忘记了就回去参考！</span><br></pre></td></tr></table></figure><h2 id="安全设定项目！极重要！"><a href="#安全设定项目！极重要！" class="headerlink" title="安全设定项目！极重要！"></a>安全设定项目！极重要！</h2><h3 id="登入设定部分"><a href="#登入设定部分" class="headerlink" title="登入设定部分"></a>登入设定部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin no　　 　　# 是否允许 root 登入！最新版本的sshd配置默认是不允许使用root登陆的，如果要使用root登陆，要把no 改为 yes 。</span><br><span class="line">UserLogin no　　　　　　　 # 在 SSH 底下本来就不接受 login 这个程序的登入！</span><br><span class="line">StrictModes yes　　　　　　# 当使用者的 host key 改变之后，Server 就不接受联机，</span><br><span class="line">　　　　　　　　　　　　　 # 可以抵挡部分的木马程序！</span><br><span class="line">RSAAuthentication yes　　 # 是否使用纯的 RSA 认证！？仅针对 version 1 ！</span><br><span class="line">PubkeyAuthentication yes　 # 是否允许 Public Key ？当然允许啦！只有 version 2</span><br><span class="line">AuthorizedKeysFile      .ssh&#x2F;authorized_keys</span><br><span class="line">　　　　　　　　　　　　　 # 上面这个在设定若要使用不需要密码登入的账号时，那么那个</span><br><span class="line">　　　　　　　　　　　　　 # 账号的存放档案所在档名！</span><br></pre></td></tr></table></figure><h3 id="认证部分"><a href="#认证部分" class="headerlink" title="认证部分"></a>认证部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RhostsAuthentication no　　# 本机系统不止使用 .rhosts ，因为仅使用 .rhosts 太</span><br><span class="line">　　　　　　　　　　　　　 # 不安全了，所以这里一定要设定为 no ！</span><br><span class="line">IgnoreRhosts yes　　　　　 # 是否取消使用 ~&#x2F;.ssh&#x2F;.rhosts 来做为认证！当然是！</span><br><span class="line">RhostsRSAAuthentication no # 这个选项是专门给 version 1 用的，使用 rhosts 档案在</span><br><span class="line">　　　　　　　　　　　　　 # &#x2F;etc&#x2F;hosts.equiv配合 RSA 演算方式来进行认证！不要使用</span><br><span class="line">HostbasedAuthentication no # 这个项目与上面的项目类似，不过是给 version 2 使用的！</span><br><span class="line">IgnoreUserKnownHosts no　　# 是否忽略家目录内的 ~&#x2F;.ssh&#x2F;known_hosts 这个档案所记录</span><br><span class="line">　　　　　　　　　　　　　 # 的主机内容？当然不要忽略，所以这里就是 no 啦！</span><br><span class="line">PasswordAuthentication yes # 密码验证当然是需要的！所以这里写 yes 啰！</span><br><span class="line">PermitEmptyPasswords no　　# 若上面那一项如果设定为 yes 的话，这一项就最好设定</span><br><span class="line">　　　　　　　　　　　　　 # 为 no ，这个项目在是否允许以空的密码登入！当然不许！</span><br><span class="line">ChallengeResponseAuthentication yes  # 挑战任何的密码认证！所以，任何 login.conf </span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 规定的认证方式，均可适用！</span><br><span class="line">#PAMAuthenticationViaKbdInt yes      # 是否启用其它的 PAM 模块！启用这个模块将会</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 导致 PasswordAuthentication 设定失效！</span><br></pre></td></tr></table></figure><p>　</p><h3 id="与-Kerberos-有关的参数设定！因为我们没有-Kerberos-主机，所以底下不用设定！"><a href="#与-Kerberos-有关的参数设定！因为我们没有-Kerberos-主机，所以底下不用设定！" class="headerlink" title="与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！"></a>与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#KerberosAuthentication no</span><br><span class="line">#KerberosOrLocalPasswd yes</span><br><span class="line">#KerberosTicketCleanup yes</span><br><span class="line">#KerberosTgtPassing no</span><br></pre></td></tr></table></figure><h3 id="底下是有关在-X-Window-底下使用的相关设定！"><a href="#底下是有关在-X-Window-底下使用的相关设定！" class="headerlink" title="底下是有关在 X-Window 底下使用的相关设定！"></a>底下是有关在 X-Window 底下使用的相关设定！</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X11Forwarding yes</span><br><span class="line">#X11DisplayOffset 10</span><br><span class="line">#X11UseLocalhost yes</span><br></pre></td></tr></table></figure><h3 id="登入后的项目："><a href="#登入后的项目：" class="headerlink" title="登入后的项目："></a>登入后的项目：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PrintMotd no              # 登入后是否显示出一些信息呢？例如上次登入的时间、地点等</span><br><span class="line">　　　　　　　　　　　　　# 等，预设是 yes ，但是，如果为了安全，可以考虑改为 no ！</span><br><span class="line">PrintLastLog yes　　　　　# 显示上次登入的信息！可以啊！预设也是 yes ！</span><br><span class="line">KeepAlive yes　　　　　　 # 一般而言，如果设定这项目的话，那么 SSH Server 会传送</span><br><span class="line">　　　　　　　　　　　　　# KeepAlive 的讯息给 Client 端，以确保两者的联机正常！</span><br><span class="line">　　　　　　　　　　　　　# 在这个情况下，任何一端死掉后， SSH 可以立刻知道！而不会</span><br><span class="line">　　　　　　　　　　　　　# 有僵尸程序的发生！</span><br><span class="line">UsePrivilegeSeparation yes # 使用者的权限设定项目！就设定为 yes 吧！</span><br><span class="line">MaxStartups 10　　　　　　# 同时允许几个尚未登入的联机画面？当我们连上 SSH ，</span><br><span class="line">　　　　　　　　　　　　　# 但是尚未输入密码时，这个时候就是我们所谓的联机画面啦！</span><br><span class="line">　　　　　　　　　　　　　# 在这个联机画面中，为了保护主机，所以需要设定最大值，</span><br><span class="line">　　　　　　　　　　　　　# 预设最多十个联机画面，而已经建立联机的不计算在这十个当中</span><br></pre></td></tr></table></figure><h3 id="关于使用者抵挡的设定项目："><a href="#关于使用者抵挡的设定项目：" class="headerlink" title="关于使用者抵挡的设定项目："></a>关于使用者抵挡的设定项目：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DenyUsers *　　　　　　　 # 设定受抵挡的使用者名称，如果是全部的使用者，那就是全部</span><br><span class="line">　　　　　　　　　　　　　# 挡吧！若是部分使用者，可以将该账号填入！例如下列！</span><br><span class="line">DenyUsers test</span><br><span class="line">DenyGroups test　　　　　 # 与 DenyUsers 相同！仅抵挡几个群组而已！</span><br></pre></td></tr></table></figure><h2 id="关于-SFTP-服务的设定项目！"><a href="#关于-SFTP-服务的设定项目！" class="headerlink" title="关于 SFTP 服务的设定项目！"></a>关于 SFTP 服务的设定项目！</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subsystem       sftp    &#x2F;usr&#x2F;lib&#x2F;ssh&#x2F;sftp-server</span><br></pre></td></tr></table></figure><p>　<br>基本上，在您的系统中，『除非有必要，否则请不要更改 /etc/ssh/sshd_config 这个档案的设定值！』因为预设的情况下通常都是最严密的 SSH 保护了，因此，可以不需要更动他！上面的说明仅是在让大家了解每个细项的一些基本内容而已！需要注意的是最后一项，如果您不愿意开放 SFTP 的话，将最后一行批注掉即可！ 　</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;&lt;p&gt;最近，在使用U盘安装gentoo配置sshd服务端碰到了问题，记录一下ssh服务端的配置文件。&lt;/p&gt;&lt;/blockquote&gt;&lt;h2 id=&quot;关于-SSH-Server-的整体设定，包含使用的-port-啦，以及使用的密码演算方式&quot;&gt;&lt;a href
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="ssh" scheme="http://hcaijin.com/tags/ssh/"/>
    
      <category term="sshd" scheme="http://hcaijin.com/tags/sshd/"/>
    
  </entry>
  
  <entry>
    <title>10个很有用的 Git 命令（转）</title>
    <link href="http://hcaijin.com/10ge-hen-you-yong-de-git-ming-ling-zhuan/"/>
    <id>http://hcaijin.com/10ge-hen-you-yong-de-git-ming-ling-zhuan/</id>
    <published>2016-02-16T13:24:34.000Z</published>
    <updated>2016-02-16T13:31:04.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://blog.sae.sina.com.cn/archives/3003" target="_blank" rel="noopener">转自</a><a href="http://blog.sae.sina.com.cn/archives/3003" target="_blank" rel="noopener">http://blog.sae.sina.com.cn/archives/3003</a></p><blockquote><p>这里给大家分享一些很有用的 Git 命令，其中很多用法你可能都不知道，无论你是工作在团队环境中或在您的个人项目中，这些命令将对你帮助很大，让你可以更加高效的进行项目开发，更轻松愉快的工作和生活。</p></blockquote><h3 id="导出最后一次提交修改过的文件"><a href="#导出最后一次提交修改过的文件" class="headerlink" title="导出最后一次提交修改过的文件"></a>导出最后一次提交修改过的文件</h3><p>我一直在使用这个命令定期进行发送给其他人进行审查/整合。这条命令将把近期提交的修改过的文件导出到一个zip文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git archive -o ..&#x2F;updated.zip HEAD $(git diff --name-only HEAD^)</span><br></pre></td></tr></table></figure><h3 id="导出两次提交之间修改过的文件"><a href="#导出两次提交之间修改过的文件" class="headerlink" title="导出两次提交之间修改过的文件"></a>导出两次提交之间修改过的文件</h3><p>同样，如果你需要导出两次提交之间修改过的文件，你可以用这一个。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git archive -o ..&#x2F;latest.zip NEW_COMMIT_ID_HERE $(git diff --name-only </span><br><span class="line">OLD_COMMIT_ID_HERE NEW_COMMIT_ID_HERE)</span><br></pre></td></tr></table></figure><h3 id="克隆一个特定的远程分支"><a href="#克隆一个特定的远程分支" class="headerlink" title="克隆一个特定的远程分支"></a>克隆一个特定的远程分支</h3><p>如果你想从远程仓库克隆特定的一个分支，这条命令对你很有用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git init </span><br><span class="line"></span><br><span class="line">git remote add -t BRANCH_NAME_HERE -f origin REMOTE_REPO_URL_PATH_HERE </span><br><span class="line"></span><br><span class="line">git checkout BRANCH_NAME_HERE</span><br></pre></td></tr></table></figure><h3 id="从无关的本地仓库应用补丁"><a href="#从无关的本地仓库应用补丁" class="headerlink" title="从无关的本地仓库应用补丁"></a>从无关的本地仓库应用补丁</h3><p>如果您需要申请从提交的一些其他不相关的创库到本地存储库，这里是一个快捷的方式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git --git-dir&#x3D;PATH_TO_OTHER_REPOSITORY_HERE&#x2F;.git format-patch -k -1 --stdout</span><br><span class="line"></span><br><span class="line">COMMIT_HASH_ID_HERE| git am -3 -k</span><br></pre></td></tr></table></figure><h3 id="检查您的分支变化是是否其他分支的一部分"><a href="#检查您的分支变化是是否其他分支的一部分" class="headerlink" title="检查您的分支变化是是否其他分支的一部分"></a>检查您的分支变化是是否其他分支的一部分</h3><p>cherry 命令可以让你检查你的分支的变化是否存在于其他一些分支之中。它会显示在当前分支相对于给定的分支的修改，用+或-标志提示提交合并与否。+表示不存在，而-表示存在于给定的分支。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git cherry -v OTHER_BRANCH_NAME_HERE </span><br><span class="line"></span><br><span class="line">#For example: to check with master branch </span><br><span class="line">git cherry -v master</span><br></pre></td></tr></table></figure><h3 id="启动一个无历史的新分支"><a href="#启动一个无历史的新分支" class="headerlink" title="启动一个无历史的新分支"></a>启动一个无历史的新分支</h3><p>有时候，你需要启动一个新的分支，同时想摒弃历史信息，例如，你想将代码放在公共领域（开源）又不想共享历史信息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --orphan NEW_BRANCH_NAME_HERE</span><br></pre></td></tr></table></figure><h3 id="在不切换分支的情况下从其它分支检出文件"><a href="#在不切换分支的情况下从其它分支检出文件" class="headerlink" title="在不切换分支的情况下从其它分支检出文件"></a>在不切换分支的情况下从其它分支检出文件</h3><p>下面的命令是从其他分支获取文件，而不用切换分支。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout BRANCH_NAME_HERE -- PATH_TO_FILE_IN_BRANCH_HERE</span><br></pre></td></tr></table></figure><h3 id="忽略跟踪文件的修改"><a href="#忽略跟踪文件的修改" class="headerlink" title="忽略跟踪文件的修改"></a>忽略跟踪文件的修改</h3><p>如果你工作在一个团队，他们都是工作在同一个分支，你需要频繁的读取/合并文件。但是有时复位了你环境的特定配置，你必须在合并后每一次都再改一下。使用这个命令，你可以忽略更改特定的文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --assume-unchanged PATH_TO_FILE_HERE</span><br></pre></td></tr></table></figure><h3 id="检查提交的修改是否发布版本的一部分"><a href="#检查提交的修改是否发布版本的一部分" class="headerlink" title="检查提交的修改是否发布版本的一部分"></a>检查提交的修改是否发布版本的一部分</h3><p>这个 name-rev 命令可以告诉你提交相对于最新发布版本的位置。利用这一点，你可以检查你的变化是否发布版本的一部分。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git name-rev --name-only COMMIT_HASH_HERE</span><br></pre></td></tr></table></figure><h3 id="使用-pull-rebase-操作替代-merge"><a href="#使用-pull-rebase-操作替代-merge" class="headerlink" title="使用 pull rebase 操作替代 merge"></a>使用 pull rebase 操作替代 merge</h3><p>如果你工作的团队正工作在同一个分支，那么你所要做的获取/合并或经常拉取。分支合并的 git 记录与合并提交时提示功能分支被并入主干。但在多个团队成员工作的同一分支的情况下，经常合并导致在日志中多个合并的消息引起混乱。所以你可以使用 pull rebase，以保持历史信息清除了无用合并的消息。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config branch.BRANCH_NAME_HERE.rebase true</span><br></pre></td></tr></table></figure><p>此外，您可以配置一个特定的分支总是衍合：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;http://blog.sae.sina.com.cn/archives/3003&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;转自&lt;/a&gt;&lt;a href=&quot;http://blog.sae.sina.com.cn/archives/30
      
    
    </summary>
    
    
    
      <category term="linux" scheme="http://hcaijin.com/tags/linux/"/>
    
      <category term="git" scheme="http://hcaijin.com/tags/git/"/>
    
  </entry>
  
</feed>
