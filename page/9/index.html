<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/ipfs/content/images/ilogo-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/ipfs/content/images/ilogo-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/ipfs/content/images/ilogo-16x16.png">
  <link rel="mask-icon" href="/ipfs/content/images/logo.svg" color="#222">

<link rel="stylesheet" href="/ipfs/css/main.css">


<link rel="stylesheet" href="/ipfs/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hcaijin.com","root":"/ipfs/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="linux,java,php">
<meta property="og:type" content="website">
<meta property="og:title" content="hcaijin.com">
<meta property="og:url" content="http://hcaijin.com/page/9/index.html">
<meta property="og:site_name" content="hcaijin.com">
<meta property="og:description" content="linux,java,php">
<meta property="article:author" content="Graz">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://hcaijin.com/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>hcaijin.com</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/ipfs/atom.xml" title="hcaijin.com" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/ipfs/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">hcaijin.com</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Graz's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/ipfs/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/ipfs/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/ipfs/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/ipfs/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/linuxyong-extundeletehui-fu-ext2-ext3-ext4xia-rm-rfwu-shan-chu-de-shu-ju/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/linuxyong-extundeletehui-fu-ext2-ext3-ext4xia-rm-rfwu-shan-chu-de-shu-ju/" class="post-title-link" itemprop="url">linux用extundelete恢复ext2、ext3、ext4下rm -rf误删除的数据</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-05-12 23:40:20" itemprop="dateCreated datePublished" datetime="2015-05-12T23:40:20+08:00">2015-05-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-01-11 07:15:10" itemprop="dateModified" datetime="2016-01-11T07:15:10+08:00">2016-01-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>国外的Linux系统管理员守则中有这么一条：“慎用 rm -rf 命令，除非你知道此命令所带来的后果“</p>
<p>Linux下删除文件并不是真实的删除磁盘分区中的文件，而是将文件的inode节点中的扇区指针清除，同时释放这些数据对应的数据块，当释放的数据块被系统重新分配时，那些被删除的数据就会被覆盖，所以误删除数据后，应马上卸载文件所在的分区。<br>每个文件有inode和block组成，inode是文件系统组成的最基本单元，它保存着文件的基本属性(大小、权限、属主组等)和存放的位置信息。而block用来存储数据。类似key-value，inode就是key，block对应value，通过key查找key对应的value。类似python的字典。</p>
<h2 id="查看根目录的inode值"><a href="#查看根目录的inode值" class="headerlink" title="查看根目录的inode值"></a>查看根目录的inode值</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -id &#x2F;</span><br><span class="line">2 &#x2F;</span><br></pre></td></tr></table></figure>
<p>一般”根”目录的inode值为2,一个分区挂载到一个目录下时，这个”根”目录的inode值为2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mount &#x2F;dev&#x2F;sdb2 &#x2F;mnt</span><br><span class="line">ls -id &#x2F;mnt</span><br><span class="line">2 &#x2F;mnt</span><br></pre></td></tr></table></figure>

<h2 id="安装extundelete"><a href="#安装extundelete" class="headerlink" title="安装extundelete"></a>安装extundelete</h2><h3 id="下载extundelete"><a href="#下载extundelete" class="headerlink" title="下载extundelete"></a>下载extundelete</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget   http:&#x2F;&#x2F;ncu.dl.sourceforge.net&#x2F;project&#x2F;extundelete&#x2F;extundelete&#x2F;0.2.0&#x2F;extundelete-0.2.0.tar.bz2</span><br></pre></td></tr></table></figure>
<h3 id="所需依赖包"><a href="#所需依赖包" class="headerlink" title="所需依赖包"></a>所需依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install e2fsprogs e2fsprogs-libs e2fsprogs-devel</span><br></pre></td></tr></table></figure>
<h3 id="编译安装extundelte"><a href="#编译安装extundelte" class="headerlink" title="编译安装extundelte"></a>编译安装extundelte</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># tar jxvf extundelete-0.2.0.tar.bz2</span><br><span class="line"># cd extundelte-0.2.0</span><br><span class="line"># .&#x2F;configure</span><br><span class="line"># make; make install</span><br></pre></td></tr></table></figure>
<h2 id="用extundelete恢复文件"><a href="#用extundelete恢复文件" class="headerlink" title="用extundelete恢复文件"></a>用extundelete恢复文件</h2><h3 id="模拟数据误删除环境"><a href="#模拟数据误删除环境" class="headerlink" title="模拟数据误删除环境"></a>模拟数据误删除环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># mkdir &#x2F;data</span><br><span class="line"># mkfs.ext4 &#x2F;dev&#x2F;sdb2</span><br><span class="line"># mount &#x2F;dev&#x2F;sdb2 &#x2F;data</span><br><span class="line"># cp &#x2F;etc&#x2F;hosts &#x2F;data&#x2F;</span><br><span class="line"># mkdir &#x2F;data&#x2F;test</span><br><span class="line"># echo &quot;extundelete test&quot; &gt; &#x2F;data&#x2F;test&#x2F;geek.txt</span><br><span class="line"># md5sum hosts                           </span><br><span class="line">#获取文件校验码</span><br><span class="line">54fb6627dbaa37721048e4549db3224d  hosts</span><br><span class="line"># md5sum test&#x2F;geek.txt</span><br><span class="line">eb42e4b3f953ce00e78e11bf50652a80  test&#x2F;geek.txt</span><br><span class="line"># rm -fr &#x2F;data&#x2F;*</span><br></pre></td></tr></table></figure>
<h3 id="卸载磁盘分区"><a href="#卸载磁盘分区" class="headerlink" title="卸载磁盘分区"></a>卸载磁盘分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">umount &#x2F;dev&#x2F;sdb2</span><br></pre></td></tr></table></figure>
<h3 id="查询恢复数据信息"><a href="#查询恢复数据信息" class="headerlink" title="查询恢复数据信息"></a>查询恢复数据信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extundelete &#x2F;dev&#x2F;sdb2 --inode 2</span><br></pre></td></tr></table></figure>
<p>…..</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">File name                             | Inode number | Deleted status</span><br><span class="line">Directory block 8657:</span><br><span class="line">.                                          2</span><br><span class="line">..                                         2</span><br><span class="line">lost+found                                 11             Deleted</span><br><span class="line">hosts                                      12             Deleted</span><br><span class="line">test                                       130817         Deleted</span><br></pre></td></tr></table></figure>
<p>上面标记为Deleted是已经删除的文件或目录</p>
<h2 id="具体操作"><a href="#具体操作" class="headerlink" title="具体操作"></a>具体操作</h2><h3 id="开始恢复单个文件"><a href="#开始恢复单个文件" class="headerlink" title="开始恢复单个文件"></a>开始恢复单个文件</h3><p>默认恢复到当前目录下的RECOVERED_FILES目录中去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extundelete &#x2F;dev&#x2F;sdb2 --restore-file hosts</span><br></pre></td></tr></table></figure>
<h3 id="恢复一个目录"><a href="#恢复一个目录" class="headerlink" title="恢复一个目录"></a>恢复一个目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extundelete &#x2F;dev&#x2F;sdb2 --restore-directory test&#x2F;</span><br></pre></td></tr></table></figure>
<h3 id="全部恢复"><a href="#全部恢复" class="headerlink" title="全部恢复"></a>全部恢复</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extundelete &#x2F;dev&#x2F;sdb2 --restore-all</span><br></pre></td></tr></table></figure>

<h2 id="检测是否恢复成功"><a href="#检测是否恢复成功" class="headerlink" title="检测是否恢复成功"></a>检测是否恢复成功</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># md5sum RECOVERED_FILES&#x2F;hosts                     获取文件校验码</span><br><span class="line">54fb6627dbaa37721048e4549db3224d  RECOVERED_FILES&#x2F;hosts</span><br><span class="line"># md5sum RECOVERED_FILES&#x2F;test&#x2F;geek.txt</span><br><span class="line">eb42e4b3f953ce00e78e11bf50652a80  RECOVERED_FILES&#x2F;test&#x2F;geek.txt</span><br></pre></td></tr></table></figure>
<p>校验码与之前的完全一致。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/ghost-jia-zai-man-wen-ti-fen-xi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/ghost-jia-zai-man-wen-ti-fen-xi/" class="post-title-link" itemprop="url">Ghost 加载慢问题分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2015-05-11 01:52:45 / Modified: 02:22:15" itemprop="dateCreated datePublished" datetime="2015-05-11T01:52:45+08:00">2015-05-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Ghost 搭建完能正常访问，可是墙内访问实在太慢了，按F12打开Chrome 开发者工具可以看到主要是 <a href="http://fonts.googleapis.com" target="_blank" rel="noopener">http://fonts.googleapis.com</a> 这个访问使用了太长的时间。应该是GFW搞的鬼，使得 Google Fonts 服务也受影响了，Ghost 后台和默认主题都引用了 Google Fonts 服务，已至于每次打开自己的 Ghost 博客都很慢。</p>
<p><em>这样我们就知道了问题的关键，马上登陆服务器，进入ghost目录。</em></p>
<pre><code>$ cd /data/www/ghost
$ grep &apos;fonts.googleapis.com&apos; -n --color  -r  .</code></pre><p><img data-src="/content/images/2015/05/--_2015-05-11_14-04-18.png" alt=""><br><em>使用sed删除相应的行</em></p>
<pre><code>$ sudo sed -i &apos;19d&apos; ./content/themes/casper/default.hbs</code></pre><p>上面修改的地方其实就是删除 Ghost 系统内引用的 Google Fonts 英文字体文件，这对于国内的用户丝毫没有影响，毕竟我们用的是 中文 嘛。</p>
<p>经过修改，Google Fonts 文件就被彻底清除了。然后重启 Ghost 系统，再登录你的博客看看吧！</p>
<pre><code>$ sudo -i 
$ pm2 restart ghost</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/bao-chi-wen-jian-yuan-lai-pai-xu-qu-chu-zhong-fu-xing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/bao-chi-wen-jian-yuan-lai-pai-xu-qu-chu-zhong-fu-xing/" class="post-title-link" itemprop="url">保持文件原有排序去除重复行</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-05-11 00:41:42" itemprop="dateCreated datePublished" datetime="2015-05-11T00:41:42+08:00">2015-05-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-01-13 03:57:50" itemprop="dateModified" datetime="2016-01-13T03:57:50+08:00">2016-01-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>通常如果我们想获取一个文件里不重复的行的时候，我们可以直接通过 sort -u 命令，先把文件排序，然后去掉连续的重复行就行。</p>
<p>可是，如果我们去掉重复行之后，还想保留文件原有的顺序，该怎么办呢？虽然 Linux 下有个看上去似乎很有用的命令叫 uniq，但事实上 uniq 命令仅仅只对连续的重复行有效。譬如我们有这样一个文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cat file3</span><br><span class="line">AAAA</span><br><span class="line">FFFF</span><br><span class="line">BBBB</span><br><span class="line">BBBB</span><br><span class="line">CCCC</span><br><span class="line">AAAA</span><br><span class="line">FFFF</span><br><span class="line">DDDD</span><br></pre></td></tr></table></figure>
<p>如果不排序，直接使用 uniq 命令是没有用的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ uniq file3</span><br><span class="line">AAAA</span><br><span class="line">FFFF</span><br><span class="line">BBBB</span><br><span class="line">CCCC</span><br><span class="line">AAAA</span><br><span class="line">FFFF</span><br><span class="line">DDDD</span><br></pre></td></tr></table></figure>
<p>使用 sort -u 的话，我们就丢失了文件原有的行的顺序了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sort -u file3</span><br><span class="line">AAAA</span><br><span class="line">BBBB</span><br><span class="line">CCCC</span><br><span class="line">DDDD</span><br><span class="line">FFFF</span><br></pre></td></tr></table></figure>
<p>sort 和 uniq 一起用，和 sort -u 效果是一样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sort file3 | uniq</span><br><span class="line">AAAA</span><br><span class="line">BBBB</span><br><span class="line">CCCC</span><br><span class="line">DDDD</span><br><span class="line">FFFF</span><br></pre></td></tr></table></figure>
<p>一个终极的解决方案是使用 awk：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ awk &#39; !x[$0]++&#39; file3</span><br><span class="line">AAAA</span><br><span class="line">FFFF</span><br><span class="line">BBBB</span><br><span class="line">CCCC</span><br><span class="line">DDDD</span><br></pre></td></tr></table></figure>
<p>简要解释一下，awk 的基本执行流程是，对文件的每一行，做一个指定的逻辑判断，如果逻辑判断成立，则执行指定的命令；如果逻辑判断不成立，则直接跳过这一行。</p>
<p>我们这里写的 awk 命令是 !x[$0]++，意思是，首先创建一个 map 叫 x，然后用当前行的全文 $0 作为 map 的 key，到 map 中查找相应的 value，如果没找到，则整个表达式的值为真，可以执行之后的语句；如果找到了，则表达式的值为假，跳过这一行。由于表达式之后有 ++，因此如果某个 key 找不到对应的 value，该 ++ 操作会先把对应的 value 设成 0，然后再自增成 1，这样下次再遇到重复的行的时候，对应的 key 就能找到一个非 0 的 value 了。</p>
<p>我们前面说过，awk 的流程是先判断表达式，表达式为真的时候就执行语句，可是我们前面写的这个 awk 命令里只有表达式，没有语句，那我们执行什么呢？原来，当语句被省略的时候，awk 就执行默认的语句，即打印整个完整的当前行。就这样，我们通过这个非常简短的 awk 命令实现了去除重复行并保留原有文件顺序的功能。</p>
<p><a href="http://edyfox.codecarver.org/html/bash_unique_lines_no_sorting.html" target="_blank" rel="noopener">引用</a></p>
<p>本文部分翻译来自 <a href="http://www.unixcl.com/" target="_blank" rel="noopener">Jadu Saikia 的博客</a>，这个博客上有很多非常有用的小技巧，有空可以多看看。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/an-zhuang-pei-zhi-arch-linux-xiang-guan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/an-zhuang-pei-zhi-arch-linux-xiang-guan/" class="post-title-link" itemprop="url">安装配置Arch linux 相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2015-05-10 22:19:00 / Modified: 22:22:24" itemprop="dateCreated datePublished" datetime="2015-05-10T22:19:00+08:00">2015-05-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装-linux-lts-软件包"><a href="#安装-linux-lts-软件包" class="headerlink" title="安装 linux-lts 软件包"></a>安装 linux-lts 软件包</h2><p><em>小贴士: 强烈推荐安装linux-lts作为备用内核，因为默认安装的linux内核比较新，容易与其它软件发生冲突</em></p>
<blockquote>
<p>linux-lts 是 Arch 官方提供的基于 Linux kernel 3.0 的长期支持内核。内核上游开发者针对此版本提供了长期支持，包括安全补丁和功能 backports。适用于需要长期支持的服务器环境用户，也可以将此内核作为新内核升级的后备内核。</p>
</blockquote>
<p><code>$ sudo pacman -S linux-lts</code>   </p>
<h2 id="配置启动"><a href="#配置启动" class="headerlink" title="配置启动"></a>配置启动</h2><p>需要编辑 GRUB2 或 LILO 的启动加载项。<br>以 GRUB2 为例：<br>为了编辑/更新启动加载项，需要安装os-prober.<br>安装后,再执行<br><code>$ sudo grub-mkconfig -o /boot/grub/grub.cfg</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/linux-dd/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/linux-dd/" class="post-title-link" itemprop="url">Linux dd</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2015-05-03 23:09:39" itemprop="dateCreated datePublished" datetime="2015-05-03T23:09:39+08:00">2015-05-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2015-05-10 22:39:29" itemprop="dateModified" datetime="2015-05-10T22:39:29+08:00">2015-05-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>dd 是 Linux/UNIX 下的一个非常有用的命令，作用是用指定大小的块拷贝一个文件，并在拷贝的同时进行指定的转换。</p>
</blockquote>
<p>常用：<br>dd 命令生成文件test.data 大小为1024M<br><code>$ dd if=/dev/zero of=test.data bs=1024M count=1</code></p>
<h3 id="整盘数据备份与恢复"><a href="#整盘数据备份与恢复" class="headerlink" title="整盘数据备份与恢复"></a>整盘数据备份与恢复</h3><p>将本地的/dev/sda1整盘备份到/dev/sda2<br><code>$ dd if=/dev/sda1 of=/dev/sda2</code><br>将/dev/sda2全盘数据备份到指定路径的image文件<br><code>$ dd if=/dev/sda2 of=/path/to/image</code><br>备份/dev/hdx全盘数据，并利用gzip工具进行压缩，保存到指定路径<br><code>$ dd if=/dev/hdx | gzip &gt;/path/to/image.gz</code><br>将备份文件恢复到指定盘：<br><code>$ dd if=/path/to/image of=/dev/hdx</code><br>将压缩的备份文件恢复到指定盘:<br><code>$ gzip -dc /path/to/image.gz | dd of=/dev/hdx</code>   </p>
<h3 id="利用netcat远程备份"><a href="#利用netcat远程备份" class="headerlink" title="利用netcat远程备份"></a>利用netcat远程备份</h3><p>在源主机上执行此命令备份/dev/hda<br><code>$ dd if=/dev/hda bs=16065b | netcat &lt; targethost-IP &gt; 1234</code><br>在目的主机上执行此命令来接收数据并写入/dev/hdc<br><code>$ netcat -l -p 1234 | dd of=/dev/hdc bs=16065b</code><br>以下两条指令是目的主机指令的变化分别采用bzip2  gzip对数据进行压缩，并将备份文件保存在当前目录。  </p>
<pre><code>$ netcat -l -p 1234 | bzip2 &gt; partition.img
$ netcat -l -p 1234 | gzip &gt; partition.img</code></pre><h3 id="备份MBR"><a href="#备份MBR" class="headerlink" title="备份MBR"></a>备份MBR</h3><p>备份磁盘开始的512Byte大小的MBR信息到指定文件<br><code>$ dd if=/dev/hdx of=/path/to/image count=1 bs=512</code><br>将备份的MBR信息写到磁盘开始部分<br><code>$ dd if=/path/to/image of=/dev/hdx</code>   </p>
<h3 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h3><p><em>#### 得到最恰当的block size</em></p>
<pre><code>dd if=/dev/zero bs=1024 count=1000000 of=/root/1Gb.file 
           dd if=/dev/zero bs=2048 count=500000 of=/root/1Gb.file
           dd if=/dev/zero bs=4096 count=250000 of=/root/1Gb.file
           dd if=/dev/zero bs=8192 count=125000 of=/root/1Gb.file</code></pre><p>通过比较dd指令输出中所显示的命令执行时间，即可确定系统最佳的block size大小</p>
<p><em>#### 测试硬盘读写速度</em>   </p>
<pre><code>$ dd if=/root/1Gb.file bs=64k | dd of=/dev/null
           $ dd if=/dev/zero of=/root/1Gb.file bs=1024 count=1000000</code></pre><p>通过上两个命令输出的执行时间，可以计算出测试硬盘的读／写速度        </p>
<p><em>#### 修复硬盘</em><br><code>$ dd if=/dev/sda of=/dev/sda</code><br>当硬盘较长时间（比如1，2年）放置不使用后，磁盘上会产生magnetic flux point。当磁头读到这些区域时会遇到困难，并可能导致I/O错误。当这种情况影响到硬盘的第一个扇区时，可能导致硬盘报废。上边的命令有可能使这些数据起死回生。且这个过程是安全，高效的。</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p><em>#### 将软驱数据备份到当前目录的disk.img文件</em><br><code>dd if=/dev/fd0 of=disk.img count=1 bs=1440k</code>    </p>
<p><em>#### 拷贝内存资料到硬盘</em><br><code>$ dd if=/dev/mem of=/root/mem.bin bs=1024</code><br>将内存里的数据拷贝到root目录下的mem.bin文件</p>
<p><em>#### 从光盘拷贝iso镜像</em><br><code>$ dd if=/dev/cdrom of=/root/cd.iso</code><br>拷贝光盘数据到root文件夹下，并保存为cd.iso文件                </p>
<p><em>#### 增加Swap分区文件大小</em><br><code>$ dd if=/dev/zero of=/swapfile bs=1024 count=262144</code><br>创建一个足够大的文件（此处为256M）<br><code>$ mkswap /swapfile</code><br>把这个文件变成swap文件<br><code>$ swapon /swapfile</code><br>启用这个swap文件<br><code>$ /swapfile swap swap defaults 0 0</code><br>在每次开机的时候自动加载swap文件, 需要在 /etc/fstab 文件中增加一行</p>
<p><em>#### 销毁磁盘数据</em><br><code>$ dd if=/dev/urandom of=/dev/hda1</code><br>利用随机的数据填充硬盘，在某些必要的场合可以用来销毁数据。执行此操作以后，/dev/hda1将无法挂载，创建和拷贝操作无法执行。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/ipfs/page/8/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/ipfs/">1</a><span class="space">&hellip;</span><a class="page-number" href="/ipfs/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/ipfs/page/10/">10</a><a class="extend next" rel="next" href="/ipfs/page/10/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Graz</p>
  <div class="site-description" itemprop="description">linux,java,php</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/ipfs/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/ipfs/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hcaijin" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hcaijin" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hcjonline@gmail.com" title="E-Mail → mailto:hcjonline@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://groups.google.com/forum" title="https:&#x2F;&#x2F;groups.google.com&#x2F;forum" rel="noopener" target="_blank">Google 网上论坛</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://programgo.com/" title="http:&#x2F;&#x2F;programgo.com" rel="noopener" target="_blank">软件开发程序员博客文章收藏网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://bbs.chinaunix.net/" title="http:&#x2F;&#x2F;bbs.chinaunix.net" rel="noopener" target="_blank">论坛-ChinaUnix.net</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://bbs.pediy.com/" title="http:&#x2F;&#x2F;bbs.pediy.com" rel="noopener" target="_blank">看雪安全论坛</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.ibm.com/developerworks/cn" title="http:&#x2F;&#x2F;www.ibm.com&#x2F;developerworks&#x2F;cn" rel="noopener" target="_blank">IBM developerWorks 中国</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.wooyun.org/" title="http:&#x2F;&#x2F;www.wooyun.org" rel="noopener" target="_blank">WooYun.org</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://wiki.backbox.org/" title="http:&#x2F;&#x2F;wiki.backbox.org" rel="noopener" target="_blank">BackBox Wiki</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.freebuf.com/" title="http:&#x2F;&#x2F;www.freebuf.com" rel="noopener" target="_blank">关注黑客与极客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://mcs.une.edu.au/doc" title="http:&#x2F;&#x2F;mcs.une.edu.au&#x2F;doc" rel="noopener" target="_blank">Linux 在线学习文档</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://stackoverflow.com/" title="http:&#x2F;&#x2F;stackoverflow.com" rel="noopener" target="_blank">程序设计领域的问答网站</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://linuxfromscratch.org/" title="http:&#x2F;&#x2F;linuxfromscratch.org" rel="noopener" target="_blank">Linux 从零开始</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Graz</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/ipfs/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/ipfs/lib/velocity/velocity.min.js"></script>
  <script src="/ipfs/lib/velocity/velocity.ui.min.js"></script>

<script src="/ipfs/js/utils.js"></script>

<script src="/ipfs/js/motion.js"></script>


<script src="/ipfs/js/schemes/muse.js"></script>


<script src="/ipfs/js/next-boot.js"></script>




  




  
<script src="/ipfs/js/local-search.js"></script>













  

  

</body>
</html>
