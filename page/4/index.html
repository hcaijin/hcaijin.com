<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/ipfs/content/images/ilogo-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/ipfs/content/images/ilogo-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/ipfs/content/images/ilogo-16x16.png">
  <link rel="mask-icon" href="/ipfs/content/images/logo.svg" color="#222">

<link rel="stylesheet" href="/ipfs/css/main.css">


<link rel="stylesheet" href="/ipfs/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hcaijin.com","root":"/ipfs/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="linux,java,php">
<meta property="og:type" content="website">
<meta property="og:title" content="hcaijin.com">
<meta property="og:url" content="http://hcaijin.com/page/4/index.html">
<meta property="og:site_name" content="hcaijin.com">
<meta property="og:description" content="linux,java,php">
<meta property="article:author" content="Graz">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://hcaijin.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>hcaijin.com</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/ipfs/atom.xml" title="hcaijin.com" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/ipfs/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">hcaijin.com</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Graz's Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/ipfs/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/ipfs/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/ipfs/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/ipfs/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/ss-redir-de-iptables-pei-zhi-tou-ming-dai-li/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/ss-redir-de-iptables-pei-zhi-tou-ming-dai-li/" class="post-title-link" itemprop="url">ss-redir 的 iptables 配置(透明代理)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-09 08:22:01" itemprop="dateCreated datePublished" datetime="2016-03-09T08:22:01+08:00">2016-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-03-26 06:51:11" itemprop="dateModified" datetime="2016-03-26T06:51:11+08:00">2016-03-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>透明代理指对客户端透明，客户端不需要进行任何设置就使用了网管设置的代理规则<br>创建 </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;etc&#x2F;ss-redir.json 本地监听 1080 运行ss-redir -v -c &#x2F;etc&#x2F;ss-redir.json</span><br></pre></td></tr></table></figure>

<h3 id="NAT表配置脚本"><a href="#NAT表配置脚本" class="headerlink" title="NAT表配置脚本"></a>NAT表配置脚本</h3><p>基本配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -N SHADOWSOCKS</span><br><span class="line"></span><br><span class="line"># 在 nat 表中创建新链</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -p tcp --dport 23596 -j RETURN</span><br><span class="line"></span><br><span class="line"># 23596 是 ss 代理服务器的端口，即远程 shadowsocks 服务器提供服务的端口，如果你有多个 ip 可用,但端口一致，就设置这个</span><br><span class="line"></span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 123.456.789.111 -j RETURN</span><br><span class="line"># 123.456.789.111 是 ss 代理服务器的 ip, 如果你只有一个 ss服务器的 ip，却能选择不同端口,就设置此条</span><br><span class="line"></span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 0.0.0.0&#x2F;8 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 10.0.0.0&#x2F;8 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 127.0.0.0&#x2F;8 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 169.254.0.0&#x2F;16 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 172.16.0.0&#x2F;12 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 192.168.0.0&#x2F;16 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 224.0.0.0&#x2F;4 -j RETURN</span><br><span class="line">iptables -t nat -A SHADOWSOCKS -d 240.0.0.0&#x2F;4 -j RETURN</span><br><span class="line"></span><br><span class="line">iptables -t nat -A SHADOWSOCKS -p tcp -j REDIRECT --to-ports 1080</span><br><span class="line"># 1080 是 ss-redir 的监听端口,ss-local 和 ss-redir 的监听端口不同,配置文件不同</span><br></pre></td></tr></table></figure>

<p>最后是应用上面的规则,将OUTPUT出去的tcp流量全部经过SOCKS链</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#如果是在openwrt上实现透明代理的话,使用下面被注释了的规则</span><br><span class="line"></span><br><span class="line">iptables -t nat -I PREROUTING -p tcp -j SHADOWSOCKS</span><br><span class="line"># 在 PREROUTING 链前插入 SHADOWSOCKS 链,使其生效</span><br><span class="line"></span><br><span class="line">在个人电脑上使用以下配置</span><br><span class="line">iptables -t nat -A OUTPUT -p tcp -j SHADOWSOCKS</span><br></pre></td></tr></table></figure>
<h3 id="如果要过滤国内流量可以"><a href="#如果要过滤国内流量可以" class="headerlink" title="如果要过滤国内流量可以"></a>如果要过滤国内流量可以</h3><p>列表太长了就不列出来了！</p>
<h3 id="清除自定义规则"><a href="#清除自定义规则" class="headerlink" title="清除自定义规则"></a>清除自定义规则</h3><p>清空整个链 iptables -F 链名,比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -F SHADOWSOCKS</span><br></pre></td></tr></table></figure>
<p>删除指定的用户自定义链 iptables -X 链名 比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -X SHADOWSOCKS</span><br></pre></td></tr></table></figure>
<p>从所选链中删除规则 iptables -D 链名 规则详情 比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -D SHADOWSOCKS -d 223.223.192.0&#x2F;255.255.240.0 -j RETURN</span><br></pre></td></tr></table></figure>


<h3 id="解决DNS污染的问题"><a href="#解决DNS污染的问题" class="headerlink" title="解决DNS污染的问题"></a>解决DNS污染的问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pacman -S archlinuxcn&#x2F;dnsmasq-china-list-git</span><br><span class="line">$ sudo dnsmasq-update-china-list 114</span><br><span class="line">####脚本如下：</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">  114)</span><br><span class="line">    DNS&#x3D;114.114.114.114</span><br><span class="line">    ;;</span><br><span class="line">  ali)</span><br><span class="line">    DNS&#x3D;223.5.5.5</span><br><span class="line">    ;;</span><br><span class="line">  cnnic)</span><br><span class="line">    DNS&#x3D;1.2.4.8</span><br><span class="line">    ;;</span><br><span class="line">  baidu)</span><br><span class="line">    DNS&#x3D;180.76.76.76</span><br><span class="line">    ;;</span><br><span class="line">  google)</span><br><span class="line">    DNS&#x3D;8.8.8.8</span><br><span class="line">    ;;</span><br><span class="line">  *)</span><br><span class="line">    DNS&#x3D;$1</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">sed -i &quot;s|^\(server.*\)&#x2F;[^&#x2F;]*$|\1&#x2F;$DNS|&quot; &#x2F;etc&#x2F;dnsmasq.d&#x2F;accelerated-domains.china.conf</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/linuxxi-tong-gua-zai-ntfsyi-dong-ying-pan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/linuxxi-tong-gua-zai-ntfsyi-dong-ying-pan/" class="post-title-link" itemprop="url">Linux系统挂载NTFS移动硬盘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-08 02:19:36" itemprop="dateCreated datePublished" datetime="2016-03-08T02:19:36+08:00">2016-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-03-31 21:33:10" itemprop="dateModified" datetime="2016-03-31T21:33:10+08:00">2016-03-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>工作中，同事之间拷贝数据的时候，由于我用的linux系统无法识别同事的NTFS移动硬盘，这才网上查了一下，原来还得安装一个软件，以下是<a href="http://www.cnblogs.com/kerrycode/archive/2013/04/01/2993701.html" target="_blank" rel="noopener">转载</a>的文章,记录一下。</p>
</blockquote>
<hr>
<p>有时候做大数据量迁移时，为了快速迁移大数据，有可能在Linux服务器上临时挂载NTFS格式的移动硬盘， 一般情况下，Linux是识别不了NTFS格式移动硬盘的（需要重编译Linux核心才能，加挂NTFS分区），这时候为了能让Linux服务器能够识别NTFS的移动硬盘，就必须安装ntfs-3g（Third Generation Read/Write NTFS Driver）的包。</p>
<hr>
<p>NTFS-3G介绍<br>NTFS-3G是一个开源项目，NTFS-3G是为Linux, Android, Mac OS X, FreeBSD, NetBSD, OpenSolaris, QNX, Haiku,和其他操作系统提供的一个稳定的，功能齐全，读写NTFS的驱动程序的。它提供了安全处理Windows XP，Windows Server 2003，Windows 2000，Windows Vista，Windows Server 2008和Windows 7操作系统下的NTFS文件系统。</p>
<p>NTFS-3g是一个开源软件，它支持在Linux下面读写NTFS格式的分区。它非常的快速，同时也很安全。它支持Windows 2000、XP、2003和Vista，并且支持所有的符合POSIX标准的磁盘操作。 ntfs-3g的目的是为了持续的发展，各硬件平台和操作系统的用户需要可靠的互通与支持ntfs的驱动，ntfs-3g可以提供可信任的、功能丰富的高性能解决方案。经过了12年多的发展，ntfs-3g已经逐渐稳定； </p>
<blockquote>
<p>资料介绍</p>
</blockquote>
<ul>
<li>官方网址：<a href="http://www.tuxera.com/，" target="_blank" rel="noopener">http://www.tuxera.com/，</a></li>
<li>文档手册：<a href="http://www.tuxera.com/community/ntfs-3g-manual/" target="_blank" rel="noopener">http://www.tuxera.com/community/ntfs-3g-manual/</a></li>
<li>下载地址：<a href="http://www.tuxera.com/community/ntfs-3g-download/" target="_blank" rel="noopener">http://www.tuxera.com/community/ntfs-3g-download/</a></li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="解压安装NTFS-3G。"><a href="#解压安装NTFS-3G。" class="headerlink" title="解压安装NTFS-3G。"></a>解压安装NTFS-3G。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf ntfs-3g_ntfsprogs-2012.1.15.tgz　　</span><br><span class="line">cd ntfs-3g_ntfsprogs-2012.1.15</span><br><span class="line">　　.&#x2F;configure </span><br><span class="line">　　make </span><br><span class="line">　　make install</span><br></pre></td></tr></table></figure>
<p><em>如果没有报错，提示安装成功，下面就可以用ntfs-3g来实现对NTFS分区的读写了</em></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="配置挂载NTFS格式的移动硬盘"><a href="#配置挂载NTFS格式的移动硬盘" class="headerlink" title="配置挂载NTFS格式的移动硬盘"></a>配置挂载NTFS格式的移动硬盘</h4><h5 id="首先得到NTFS分区的信息"><a href="#首先得到NTFS分区的信息" class="headerlink" title="首先得到NTFS分区的信息"></a>首先得到NTFS分区的信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo fdisk -l | grep NTFS</span><br><span class="line">&#x2F;dev&#x2F;sdc1 * 1 244 1955776+ 7 HPFS&#x2F;NTFS</span><br></pre></td></tr></table></figure>

<h5 id="设置挂载点，用如下命令实现挂载"><a href="#设置挂载点，用如下命令实现挂载" class="headerlink" title="设置挂载点，用如下命令实现挂载"></a>设置挂载点，用如下命令实现挂载</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t ntfs-3g &lt;NTFS Partition&gt; &lt;Mount Point&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>例如得到的NTFS分区信息为/dev/sdc1，挂载点设置在/mnt/usb下:</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mount -t ntfs-3g &#x2F;dev&#x2F;sdc1 &#x2F;mnt&#x2F;usb </span><br><span class="line">########## 或者直接用 #######</span><br><span class="line">$ ntfs-3g ntfs-3g &#x2F;dev&#x2F;sdc1 &#x2F;mnt&#x2F;usb</span><br></pre></td></tr></table></figure>

<h4 id="如果想实现开机自动挂载，可以在-etc-fstab里面添加如下格式语句"><a href="#如果想实现开机自动挂载，可以在-etc-fstab里面添加如下格式语句" class="headerlink" title="如果想实现开机自动挂载，可以在/etc/fstab里面添加如下格式语句"></a>如果想实现开机自动挂载，可以在/etc/fstab里面添加如下格式语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;NTFS Partition&gt; &lt;Mount Point&gt; ntfs-3g silent,umask&#x3D;0,locale&#x3D;zh_CN.utf8 0 0</span><br></pre></td></tr></table></figure>
<p>==这样可以实现NTFS分区里中文文件名的显示。 ==</p>
<p>　　</p>
<h3 id="卸载分区"><a href="#卸载分区" class="headerlink" title="卸载分区"></a>卸载分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ umount &lt;NTFS Partition&gt; 　　</span><br><span class="line">##### 或者 #####</span><br><span class="line">$ umount &lt;Mount Point&gt;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/gentoo-upan-an-zhuang-zhi-nan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/gentoo-upan-an-zhuang-zhi-nan/" class="post-title-link" itemprop="url">Linux gentoo U盘安装指南</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2016-03-05 01:43:55" itemprop="dateCreated datePublished" datetime="2016-03-05T01:43:55+08:00">2016-03-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2016-03-08 04:23:30" itemprop="dateModified" datetime="2016-03-08T04:23:30+08:00">2016-03-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>再一次捣鼓gentoo,还是遇到了相当多的麻烦，这里把安装的方法重新在blog里整理一下，跟着官方安装步骤一点点来。</p>
</blockquote>
<h2 id="准备安装之前"><a href="#准备安装之前" class="headerlink" title="准备安装之前"></a>准备安装之前</h2><h3 id="下载gentoo所需的引导镜像和系统文件压缩包"><a href="#下载gentoo所需的引导镜像和系统文件压缩包" class="headerlink" title="下载gentoo所需的引导镜像和系统文件压缩包"></a>下载gentoo所需的引导镜像和系统文件压缩包</h3><p>下载地址：<br><a href="https://www.gentoo.org/downloads/" target="_blank" rel="noopener">https://www.gentoo.org/downloads/</a></p>
<p>主要文件：</p>
<ul>
<li>install-amd64-minimal-20160303.iso            </li>
<li>portage-latest.tar.bz2</li>
<li>stage3-amd64-20160303.tar.bz2</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir gentoo&#x2F;  &amp;&amp; cd gentoo&#x2F;</span><br><span class="line">$ wget -c  # http:&#x2F;&#x2F;mirrors.163.com&#x2F;gentoo&#x2F;releases&#x2F;amd64&#x2F;autobuilds&#x2F;20160303&#x2F;install-amd64-minimal-20160303.iso</span><br><span class="line">$ wget -c http:&#x2F;&#x2F;mirrors.163.com&#x2F;gentoo&#x2F;snapshots&#x2F;portage-latest.tar.bz2</span><br><span class="line">$ wget -c http:&#x2F;&#x2F;mirrors.163.com&#x2F;gentoo&#x2F;releases&#x2F;amd64&#x2F;autobuilds&#x2F;20160303&#x2F;stage3-amd64-20160303.tar.bz2</span><br></pre></td></tr></table></figure>
<h3 id="U盘准备"><a href="#U盘准备" class="headerlink" title="U盘准备"></a>U盘准备</h3><p>插入U盘，查看U盘设备名,不需求挂载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">$ sudo dd if&#x3D;install-amd64-minimal-20160303.iso of&#x3D;&#x2F;dev&#x2F;sdb</span><br></pre></td></tr></table></figure>
<p>这样，就制作好了U盘启动了，把U盘插入要安装的机子，配置BIOS通过U盘启动，就可以进入光盘引导的临时系统。</p>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><h3 id="配置临时系统"><a href="#配置临时系统" class="headerlink" title="配置临时系统"></a>配置临时系统</h3><blockquote>
<p>安装gentoo最主要是先把网络配置好，这里我安装的时候遇到了个非常郁闷的问题，就是，公司的个别网段限制下载，导致我在配置网络的时候浪费了不少时间，所以最好先确认一下，你所在的网段是否可以使用wget下载文件。</p>
</blockquote>
<h4 id="配置IP"><a href="#配置IP" class="headerlink" title="配置IP"></a>配置IP</h4><p>通常启动U盘临时系统应该可以dhcp分配到一个ip,但是我因为是公司的网络，所以最好手动配置一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ip addr add 192.168.3.155&#x2F;24 dev enp0s25</span><br><span class="line"># ip route add default via 192.168.3.1 dev enp0s25</span><br><span class="line"># echo &quot;192.168.1.1&quot; &gt; &#x2F;etc&#x2F;resolv.conf</span><br></pre></td></tr></table></figure>

<h4 id="配置ssh链接"><a href="#配置ssh链接" class="headerlink" title="配置ssh链接"></a>配置ssh链接</h4><p>为了方便，最好远程链接到临时系统下，那么就得配置sshd服务。</p>
<p>==Tip: 最新的sshd服务器默认限制root登陆，需要修改一下/etc/ssh/sshd_config<br>配置PermitRootLogin 为 yes==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;etc&#x2F;init.d&#x2F;sshd start</span><br><span class="line"># passwd root               ####配置root用户密码</span><br></pre></td></tr></table></figure>
<p>以上，我们就可以到本机，使用ssh远程登陆这个U盘挂启的临时系统了</p>
<h3 id="安装到硬盘上"><a href="#安装到硬盘上" class="headerlink" title="安装到硬盘上"></a>安装到硬盘上</h3><h4 id="系统分区fdisk"><a href="#系统分区fdisk" class="headerlink" title="系统分区fdisk"></a>系统分区fdisk</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># fdisk -l</span><br><span class="line">Device     Boot     Start       End   Sectors  Size Id Type</span><br><span class="line">&#x2F;dev&#x2F;sda1            2048      6143      4096    2M ef EFI (FAT-12&#x2F;16&#x2F;32)</span><br><span class="line">&#x2F;dev&#x2F;sda2            6144    268287    262144  128M 83 Linux</span><br><span class="line">&#x2F;dev&#x2F;sda3          268288  17045503  16777216    8G 82 Linux swap &#x2F; Solaris</span><br><span class="line">&#x2F;dev&#x2F;sda4        17045504 937703087 920657584  439G  5 Extended</span><br><span class="line">&#x2F;dev&#x2F;sda5        17047552 226762751 209715200  100G 83 Linux</span><br><span class="line">&#x2F;dev&#x2F;sda6       226764800 937703087 710938288  339G 83 Linux</span><br><span class="line"># fdisk &#x2F;dev&#x2F;sda</span><br></pre></td></tr></table></figure>
<p>使用fdisk分区以前有详细的说明过，在这里就不再说了。不懂的，请写看一下这个<br><a href="https://www.hcaijin.com/shu-mei-pai-an-zhuang-gentoo-linux/" target="_blank" rel="noopener">树莓派安装Gentoo Linux</a> 1.1.3 节</p>
<p>也可以参照 <a href="https://wiki.gentoo.org/wiki/Handbook:AMD64/Installation/Disks" target="_blank" rel="noopener">官方分区方案</a></p>
<h4 id="重新读取sda分区表"><a href="#重新读取sda分区表" class="headerlink" title="重新读取sda分区表:"></a>重新读取sda分区表:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># partx -a &#x2F;dev&#x2F;sda</span><br></pre></td></tr></table></figure>
<h4 id="格式化分区为文件系统"><a href="#格式化分区为文件系统" class="headerlink" title="格式化分区为文件系统"></a>格式化分区为文件系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mkfs.ext2 &#x2F;dev&#x2F;sda2</span><br><span class="line"># mkfs.ext4 &#x2F;dev&#x2F;sda5</span><br><span class="line"># mkfs.ext4 &#x2F;dev&#x2F;sda6</span><br></pre></td></tr></table></figure>
<h4 id="格式化swap分区并激活"><a href="#格式化swap分区并激活" class="headerlink" title="格式化swap分区并激活"></a>格式化swap分区并激活</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkswap &#x2F;dev&#x2F;sda3</span><br><span class="line"># swapon &#x2F;dev&#x2F;sda3</span><br></pre></td></tr></table></figure>

<h4 id="创建系统临时挂载点"><a href="#创建系统临时挂载点" class="headerlink" title="创建系统临时挂载点"></a>创建系统临时挂载点</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># mount &#x2F;dev&#x2F;sda5 &#x2F;mnt&#x2F;gentoo</span><br><span class="line"># mkdir -p &#x2F;mnt&#x2F;gentoo&#x2F;&#123;boot,home,&#125;</span><br><span class="line"># mount &#x2F;dev&#x2F;sda2 &#x2F;mnt&#x2F;gentoo&#x2F;boot</span><br><span class="line"># mount &#x2F;dev&#x2F;sda6 &#x2F;mnt&#x2F;gentoo&#x2F;home</span><br></pre></td></tr></table></figure>

<h3 id="设定日期和时间"><a href="#设定日期和时间" class="headerlink" title="设定日期和时间"></a>设定日期和时间</h3><p>安装Gentoo之前，请确保日期和时间是否正确设置。错误配置的时钟可能会产生各种奇怪的错误！==主要==！！！</p>
<p>要验证当前日期和时间，运行日期：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># date</span><br><span class="line">Sat Mar  5 16:26:08 UTC 2016</span><br></pre></td></tr></table></figure>
<p>如果时间不对，请使用 <code>MMDDhhmmYYYY</code> 这样的格式配置一下日期和时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date 030516262016</span><br></pre></td></tr></table></figure>

<h3 id="下载和解压相关包"><a href="#下载和解压相关包" class="headerlink" title="下载和解压相关包"></a>下载和解压相关包</h3><h4 id="使用临时系统自带的links下载stage3和portage"><a href="#使用临时系统自带的links下载stage3和portage" class="headerlink" title="使用临时系统自带的links下载stage3和portage"></a>使用临时系统自带的links下载stage3和portage</h4><p>==Tip:  如果前面已经在本机下载过了可以跳过这一步==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># links https:&#x2F;&#x2F;www.gentoo.org&#x2F;downloads&#x2F;mirrors&#x2F;</span><br></pre></td></tr></table></figure>
<p>或者配置代理下载：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># links -http-proxy proxy.server.com:8080   https:&#x2F;&#x2F;www.gentoo.org&#x2F;downloads&#x2F;mirrors&#x2F;</span><br></pre></td></tr></table></figure>
<h4 id="效验下载的文件"><a href="#效验下载的文件" class="headerlink" title="效验下载的文件"></a>效验下载的文件</h4><p>效验下载的文件是否完整，打开 .DIGESTS(.asc) 相关文件对比sha512加密的是否一至。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># openssl dgst -r -sha512 stage3-amd64-20160303.tar.bz2</span><br></pre></td></tr></table></figure>

<h4 id="解压stage3和portage"><a href="#解压stage3和portage" class="headerlink" title="解压stage3和portage"></a>解压stage3和portage</h4><p>把下载好的stage3和portage放到/mnt/gentoo目录下，进入目录解压：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;mnt&#x2F;gentoo&#x2F;</span><br><span class="line"># tar xvjpf stage3-*.tar.bz2 --xattrs</span><br></pre></td></tr></table></figure>
<p>==注: stage3解压的文件是Gentoo的目录结构，所以要解压到临时的系统目录下,即/mnt/gentoo，方便后面进行chroot==</p>
<p>下面解压portage，这个解压需要一点时间。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># tar jxvf portage-latest.tar.bz2 -C &#x2F;mnt&#x2F;gentoo&#x2F;usr</span><br></pre></td></tr></table></figure>
<p>==注: portage-latest.tar.bz2解压的文件为系统软件目录结构,需要解压到/mnt/gentoo/usr目录下==</p>
<h3 id="安装基本gentoo系统"><a href="#安装基本gentoo系统" class="headerlink" title="安装基本gentoo系统"></a>安装基本gentoo系统</h3><h4 id="配置portage-make-参数"><a href="#配置portage-make-参数" class="headerlink" title="配置portage make 参数"></a>配置portage make 参数</h4><ul>
<li>配置了MAKEOPTS为cpu核心数+1</li>
<li>配置就近的镜像地址 GETOO_MIRRORS 为厦门大学的镜像源<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;portage&#x2F;make.conf</span><br></pre></td></tr></table></figure>
<img data-src="/content/images/2016/03/--_2016-03-05_16-53-28.png" alt=""></li>
</ul>
<p>==Tip: 参数配置文件/mnt/gentoo/usr/share/portage/config/make.conf.example ==</p>
<h4 id="配置主要Gentoo的存储库"><a href="#配置主要Gentoo的存储库" class="headerlink" title="配置主要Gentoo的存储库"></a>配置主要Gentoo的存储库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># mkdir &#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;portage&#x2F;repos.conf</span><br><span class="line"># cp &#x2F;mnt&#x2F;gentoo&#x2F;usr&#x2F;share&#x2F;portage&#x2F;config&#x2F;repos.conf &#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;portage&#x2F;repos.conf&#x2F;gentoo.conf</span><br></pre></td></tr></table></figure>
<p><img data-src="/content/images/2016/03/--_2016-03-05_17-00-14.png" alt=""></p>
<h4 id="配置chroot环境的dns"><a href="#配置chroot环境的dns" class="headerlink" title="配置chroot环境的dns"></a>配置chroot环境的dns</h4><p>只需要把livecd临时环境的resolv.conf复制到要chroot的目录里就好了，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -L &#x2F;etc&#x2F;resolv.conf &#x2F;mnt&#x2F;gentoo&#x2F;etc&#x2F;</span><br></pre></td></tr></table></figure>
<h4 id="挂载必要的文件系统"><a href="#挂载必要的文件系统" class="headerlink" title="挂载必要的文件系统"></a>挂载必要的文件系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># mount -t proc proc &#x2F;mnt&#x2F;gentoo&#x2F;proc</span><br><span class="line"># mount --rbind &#x2F;sys &#x2F;mnt&#x2F;gentoo&#x2F;sys</span><br><span class="line"># mount --make-rslave &#x2F;mnt&#x2F;gentoo&#x2F;sys</span><br><span class="line"># mount --rbind &#x2F;dev &#x2F;mnt&#x2F;gentoo&#x2F;dev</span><br><span class="line"># mount --make-rslave &#x2F;mnt&#x2F;gentoo&#x2F;dev</span><br></pre></td></tr></table></figure>

<h4 id="Chroot-到新的环境"><a href="#Chroot-到新的环境" class="headerlink" title="Chroot 到新的环境"></a>Chroot 到新的环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># chroot &#x2F;mnt&#x2F;gentoo &#x2F;bin&#x2F;bash</span><br><span class="line"># source &#x2F;etc&#x2F;profile</span><br><span class="line"># export PS1&#x3D;&quot;(chroot) $PS1&quot;</span><br></pre></td></tr></table></figure>

<h4 id="设置主机名"><a href="#设置主机名" class="headerlink" title="设置主机名"></a>设置主机名</h4><p>这不是必要的步骤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># sed -i -e &#39;s&#x2F;hostname.*&#x2F;hostname&#x3D;&quot;hcj.com&quot;&#x2F;&#39; &#x2F;etc&#x2F;conf.d&#x2F;hostname</span><br><span class="line"># echo &quot;127.0.0.1 hcj.com localhost&quot; &gt; &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure>

<h4 id="配置Portage"><a href="#配置Portage" class="headerlink" title="配置Portage"></a>配置Portage</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># emerge-webrsync</span><br></pre></td></tr></table></figure>
<p><img data-src="/content/images/2016/03/--_2016-03-05_17-33-41.png" alt=""></p>
<p>我在配置这个的时候报错了，按照提示删除tmestamp.x文件即可。</p>
<p>更新portage树</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># emerge --sync</span><br></pre></td></tr></table></figure>
<p>小内存的情况使用静默模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># emerge --sync --quiet</span><br></pre></td></tr></table></figure>

<h4 id="配置系统环境"><a href="#配置系统环境" class="headerlink" title="配置系统环境"></a>配置系统环境</h4><p>查看更新的通知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># eselect news list</span><br><span class="line"># eselect news read</span><br></pre></td></tr></table></figure>
<p>选择适合的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># eselect profile list</span><br><span class="line"># eselect profile set 3    ### 我选择的是桌面环境系统</span><br></pre></td></tr></table></figure>
<p>更新timezone</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ls &#x2F;usr&#x2F;share&#x2F;zoneinfo</span><br><span class="line"># echo &quot;Asia&#x2F;Shanghai&quot; &gt; &#x2F;etc&#x2F;timezone</span><br><span class="line"># emerge --config sys-libs&#x2F;timezone-data</span><br></pre></td></tr></table></figure>

<p>配置语言编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># nano -w &#x2F;etc&#x2F;locale.gen</span><br><span class="line"># locale-gen</span><br><span class="line"># eselect locale list</span><br><span class="line">Available targets for the LANG variable:</span><br><span class="line">  [1]   C</span><br><span class="line">  [2]   POSIX</span><br><span class="line">  [3]   en_US</span><br><span class="line">  [4]   en_US.iso88591</span><br><span class="line">  [5]   en_US.utf8</span><br><span class="line">  [6]   zh_CN.utf8 *</span><br><span class="line">  [ ]   (free form)</span><br><span class="line"></span><br><span class="line"># eselect locale set 6</span><br></pre></td></tr></table></figure>
<p>更新一下环境</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># env-update &amp;&amp; source &#x2F;etc&#x2F;profile &amp;&amp; export PS1&#x3D;&quot;(chroot) $PS1&quot;</span><br></pre></td></tr></table></figure>

<h3 id="内核配置"><a href="#内核配置" class="headerlink" title="内核配置"></a>内核配置</h3><h4 id="安装内核源码"><a href="#安装内核源码" class="headerlink" title="安装内核源码"></a>安装内核源码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># emerge --ask sys-kernel&#x2F;gentoo-sources</span><br><span class="line"># genkernel --install initramfs</span><br></pre></td></tr></table></figure>
<h4 id="配置fstab"><a href="#配置fstab" class="headerlink" title="配置fstab"></a>配置fstab</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;fstab</span><br></pre></td></tr></table></figure>
<p><img data-src="/content/images/2016/03/--_2016-03-05_20-12-09.png" alt=""></p>
<h4 id="编译内核文件"><a href="#编译内核文件" class="headerlink" title="编译内核文件"></a>编译内核文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genkernel all</span><br></pre></td></tr></table></figure>
<p>完成以上就可以在/boot目录下看到内核文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ls &#x2F;boot&#x2F;kernel* &#x2F;boot&#x2F;initramfs*</span><br></pre></td></tr></table></figure>
<p>==注: genkernel编译出的内核支持几乎所有硬件，编译需要一段很长的时间，一旦genkernel运行完成，一个包括全部模块和initrd的内核将被建立。在后面配置引导程序时我们将会用到这个内核和initrd。请记下内核和initrd的名字，因为您将在配置引导程序的时候用到他们。initrd将会在启动真正的系统前自动识别硬件（如同安装光盘一样）==</p>
<h3 id="安装其他软件"><a href="#安装其他软件" class="headerlink" title="安装其他软件"></a>安装其他软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># emerge vim                ### 安装vim 方便后面的配置</span><br><span class="line"># emerge syslog-ng          ### 安装系统日志管理</span><br><span class="line"># rc-update add sysklogd default</span><br><span class="line"># emerge logrotate          ### 日志格式化工具</span><br><span class="line"># emerge --ask sys-process&#x2F;cronie    ### 计划任务系统</span><br><span class="line"># rc-update add cronie default</span><br><span class="line"># emerge --ask net-misc&#x2F;dhcpcd   </span><br><span class="line"># emerge --ask sys-apps&#x2F;mlocate       ### 快速索引</span><br></pre></td></tr></table></figure>
<h4 id="配置网络"><a href="#配置网络" class="headerlink" title="配置网络"></a>配置网络</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cat &#x2F;etc&#x2F;conf.d&#x2F;net</span><br><span class="line">config_enp0s25&#x3D;&quot;192.168.3.155 netmask 255.255.255.0 brd 192.168.3.255&quot;</span><br><span class="line">routes_enp0s25&#x3D;&quot;default via 192.168.3.1&quot;</span><br><span class="line"># ln -s &#x2F;etc&#x2F;init.d&#x2F;net.lo &#x2F;etc&#x2F;init.d&#x2F;net.enp0s25</span><br><span class="line"># rc-update add net.enp0s25 default</span><br><span class="line"># rc-update add sshd default</span><br></pre></td></tr></table></figure>
<h4 id="配置root用户密码"><a href="#配置root用户密码" class="headerlink" title="配置root用户密码"></a>配置root用户密码</h4><p>这是必要的，为了从新系统能进入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># passwd</span><br></pre></td></tr></table></figure>

<h3 id="配置GRUB引导程序"><a href="#配置GRUB引导程序" class="headerlink" title="配置GRUB引导程序"></a>配置GRUB引导程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># emerge --ask sys-boot&#x2F;grub:2</span><br><span class="line"># grub2-install &#x2F;dev&#x2F;sda</span><br><span class="line"># grub2-mkconfig -o &#x2F;boot&#x2F;grub&#x2F;grub.cfg</span><br></pre></td></tr></table></figure>

<h3 id="最后重启一下系统"><a href="#最后重启一下系统" class="headerlink" title="最后重启一下系统"></a>最后重启一下系统</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># exit</span><br><span class="line"># cd</span><br><span class="line"># umount -l &#x2F;mnt&#x2F;gentoo&#x2F;dev&#123;&#x2F;shm,&#x2F;pts,&#125;</span><br><span class="line"># umount &#x2F;mnt&#x2F;gentoo&#123;&#x2F;boot,&#x2F;sys,&#x2F;proc,&#125;</span><br><span class="line"># reboot</span><br></pre></td></tr></table></figure>

<p><a href="https://gentoo-handbook.lugons.org/doc/zh_cn/handbook/handbook-amd64.xml" target="_blank" rel="noopener">引用</a> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/ssh-fu-wu-duan-pei-zhi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/ssh-fu-wu-duan-pei-zhi/" class="post-title-link" itemprop="url">ssh 服务端配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-03-05 01:32:03 / Modified: 01:42:17" itemprop="dateCreated datePublished" datetime="2016-03-05T01:32:03+08:00">2016-03-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>最近，在使用U盘安装gentoo配置sshd服务端碰到了问题，记录一下ssh服务端的配置文件。</p>
</blockquote>
<h2 id="关于-SSH-Server-的整体设定，包含使用的-port-啦，以及使用的密码演算方式"><a href="#关于-SSH-Server-的整体设定，包含使用的-port-啦，以及使用的密码演算方式" class="headerlink" title="关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式"></a>关于 SSH Server 的整体设定，包含使用的 port 啦，以及使用的密码演算方式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Port 22　　　　　　　　　　# SSH 预设使用 22 这个 port，您也可以使用多的 port ！</span><br><span class="line">　　　　　　　　　　　　　 # 亦即重复使用 port 这个设定项目即可！</span><br><span class="line">Protocol 2,1　　　　　　　 # 选择的 SSH 协议版本，可以是 1 也可以是 2 ，</span><br><span class="line">　　　　　　　　　　　　　 # 如果要同时支持两者，就必须要使用 2,1 这个分隔了！</span><br><span class="line">#ListenAddress 0.0.0.0　　 # 监听的主机适配卡！举个例子来说，如果您有两个 IP，</span><br><span class="line">　　　　　　　　　　　　　 # 分别是 192.168.0.100 及 192.168.2.20 ，那么只想要</span><br><span class="line">　　　　　　　　　　　　　 # 开放 192.168.0.100 时，就可以写如同下面的样式：</span><br><span class="line">ListenAddress 192.168.0.100          # 只监听来自 192.168.0.100 这个 IP 的SSH联机。</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 如果不使用设定的话，则预设所有接口均接受 SSH</span><br><span class="line">PidFile &#x2F;var&#x2F;run&#x2F;sshd.pid　　　　　　# 可以放置 SSHD 这个 PID 的档案！左列为默认值</span><br><span class="line">LoginGraceTime 600　　　　 # 当使用者连上 SSH server 之后，会出现输入密码的画面，</span><br><span class="line">　　　　　　　　　　　　　 # 在该画面中，在多久时间内没有成功连上 SSH server ，</span><br><span class="line">　　　　　　　　　　　　　 # 就断线！时间为秒！</span><br><span class="line">Compression yes　　　　　　# 是否可以使用压缩指令？当然可以啰！</span><br></pre></td></tr></table></figure>
<p>　</p>
<h2 id="说明主机的-Private-Key-放置的档案，预设使用下面的档案即可！"><a href="#说明主机的-Private-Key-放置的档案，预设使用下面的档案即可！" class="headerlink" title="说明主机的 Private Key 放置的档案，预设使用下面的档案即可！"></a>说明主机的 Private Key 放置的档案，预设使用下面的档案即可！</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_key　　　　# SSH version 1 使用的私钥</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_rsa_key　　# SSH version 2 使用的 RSA 私钥</span><br><span class="line">HostKey &#x2F;etc&#x2F;ssh&#x2F;ssh_host_dsa_key　　# SSH version 2 使用的 DSA 私钥</span><br></pre></td></tr></table></figure>
<h3 id="关于-version-1-的一些设定！"><a href="#关于-version-1-的一些设定！" class="headerlink" title="关于 version 1 的一些设定！"></a>关于 version 1 的一些设定！</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">KeyRegenerationInterval 3600　 　　　# 由前面联机的说明可以知道， version 1 会使用 </span><br><span class="line">　　　　　　　　　　　　　　　　　　 # server 的 Public Key ，那么如果这个 Public </span><br><span class="line">　　　　　　　　　　　　　　　　　　 # Key 被偷的话，岂不完蛋？所以需要每隔一段时间</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 来重新建立一次！这里的时间为秒！</span><br><span class="line">ServerKeyBits 768 　　　　　　　　　 # 没错！这个就是 Server key 的长度！</span><br></pre></td></tr></table></figure>
<h2 id="关于登录文件的讯息数据放置与-daemon-的名称！"><a href="#关于登录文件的讯息数据放置与-daemon-的名称！" class="headerlink" title="关于登录文件的讯息数据放置与 daemon 的名称！"></a>关于登录文件的讯息数据放置与 daemon 的名称！</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SyslogFacility AUTH　　　　　　　　　# 当有人使用 SSH 登入系统的时候，SSH会记录资</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 讯，这个信息要记录在什么 daemon name 底下？</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 预设是以 AUTH 来设定的，即是 &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 里面！什么？忘记了！回到 Linux 基础去翻一下</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 其它可用的 daemon name 为：DAEMON,USER,AUTH,</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # LOCAL0,LOCAL1,LOCAL2,LOCAL3,LOCAL4,LOCAL5,</span><br><span class="line">LogLevel INFO　　　　　　　　　　　　# 登录记录的等级！嘿嘿！任何讯息！</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 同样的，忘记了就回去参考！</span><br></pre></td></tr></table></figure>
<h2 id="安全设定项目！极重要！"><a href="#安全设定项目！极重要！" class="headerlink" title="安全设定项目！极重要！"></a>安全设定项目！极重要！</h2><h3 id="登入设定部分"><a href="#登入设定部分" class="headerlink" title="登入设定部分"></a>登入设定部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin no　　 　　# 是否允许 root 登入！最新版本的sshd配置默认是不允许使用root登陆的，如果要使用root登陆，要把no 改为 yes 。</span><br><span class="line">UserLogin no　　　　　　　 # 在 SSH 底下本来就不接受 login 这个程序的登入！</span><br><span class="line">StrictModes yes　　　　　　# 当使用者的 host key 改变之后，Server 就不接受联机，</span><br><span class="line">　　　　　　　　　　　　　 # 可以抵挡部分的木马程序！</span><br><span class="line">RSAAuthentication yes　　 # 是否使用纯的 RSA 认证！？仅针对 version 1 ！</span><br><span class="line">PubkeyAuthentication yes　 # 是否允许 Public Key ？当然允许啦！只有 version 2</span><br><span class="line">AuthorizedKeysFile      .ssh&#x2F;authorized_keys</span><br><span class="line">　　　　　　　　　　　　　 # 上面这个在设定若要使用不需要密码登入的账号时，那么那个</span><br><span class="line">　　　　　　　　　　　　　 # 账号的存放档案所在档名！</span><br></pre></td></tr></table></figure>
<h3 id="认证部分"><a href="#认证部分" class="headerlink" title="认证部分"></a>认证部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">RhostsAuthentication no　　# 本机系统不止使用 .rhosts ，因为仅使用 .rhosts 太</span><br><span class="line">　　　　　　　　　　　　　 # 不安全了，所以这里一定要设定为 no ！</span><br><span class="line">IgnoreRhosts yes　　　　　 # 是否取消使用 ~&#x2F;.ssh&#x2F;.rhosts 来做为认证！当然是！</span><br><span class="line">RhostsRSAAuthentication no # 这个选项是专门给 version 1 用的，使用 rhosts 档案在</span><br><span class="line">　　　　　　　　　　　　　 # &#x2F;etc&#x2F;hosts.equiv配合 RSA 演算方式来进行认证！不要使用</span><br><span class="line">HostbasedAuthentication no # 这个项目与上面的项目类似，不过是给 version 2 使用的！</span><br><span class="line">IgnoreUserKnownHosts no　　# 是否忽略家目录内的 ~&#x2F;.ssh&#x2F;known_hosts 这个档案所记录</span><br><span class="line">　　　　　　　　　　　　　 # 的主机内容？当然不要忽略，所以这里就是 no 啦！</span><br><span class="line">PasswordAuthentication yes # 密码验证当然是需要的！所以这里写 yes 啰！</span><br><span class="line">PermitEmptyPasswords no　　# 若上面那一项如果设定为 yes 的话，这一项就最好设定</span><br><span class="line">　　　　　　　　　　　　　 # 为 no ，这个项目在是否允许以空的密码登入！当然不许！</span><br><span class="line">ChallengeResponseAuthentication yes  # 挑战任何的密码认证！所以，任何 login.conf </span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 规定的认证方式，均可适用！</span><br><span class="line">#PAMAuthenticationViaKbdInt yes      # 是否启用其它的 PAM 模块！启用这个模块将会</span><br><span class="line">　　　　　　　　　　　　　　　　　　 # 导致 PasswordAuthentication 设定失效！</span><br></pre></td></tr></table></figure>
<p>　</p>
<h3 id="与-Kerberos-有关的参数设定！因为我们没有-Kerberos-主机，所以底下不用设定！"><a href="#与-Kerberos-有关的参数设定！因为我们没有-Kerberos-主机，所以底下不用设定！" class="headerlink" title="与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！"></a>与 Kerberos 有关的参数设定！因为我们没有 Kerberos 主机，所以底下不用设定！</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#KerberosAuthentication no</span><br><span class="line">#KerberosOrLocalPasswd yes</span><br><span class="line">#KerberosTicketCleanup yes</span><br><span class="line">#KerberosTgtPassing no</span><br></pre></td></tr></table></figure>

<h3 id="底下是有关在-X-Window-底下使用的相关设定！"><a href="#底下是有关在-X-Window-底下使用的相关设定！" class="headerlink" title="底下是有关在 X-Window 底下使用的相关设定！"></a>底下是有关在 X-Window 底下使用的相关设定！</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">X11Forwarding yes</span><br><span class="line">#X11DisplayOffset 10</span><br><span class="line">#X11UseLocalhost yes</span><br></pre></td></tr></table></figure>
<h3 id="登入后的项目："><a href="#登入后的项目：" class="headerlink" title="登入后的项目："></a>登入后的项目：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PrintMotd no              # 登入后是否显示出一些信息呢？例如上次登入的时间、地点等</span><br><span class="line">　　　　　　　　　　　　　# 等，预设是 yes ，但是，如果为了安全，可以考虑改为 no ！</span><br><span class="line">PrintLastLog yes　　　　　# 显示上次登入的信息！可以啊！预设也是 yes ！</span><br><span class="line">KeepAlive yes　　　　　　 # 一般而言，如果设定这项目的话，那么 SSH Server 会传送</span><br><span class="line">　　　　　　　　　　　　　# KeepAlive 的讯息给 Client 端，以确保两者的联机正常！</span><br><span class="line">　　　　　　　　　　　　　# 在这个情况下，任何一端死掉后， SSH 可以立刻知道！而不会</span><br><span class="line">　　　　　　　　　　　　　# 有僵尸程序的发生！</span><br><span class="line">UsePrivilegeSeparation yes # 使用者的权限设定项目！就设定为 yes 吧！</span><br><span class="line">MaxStartups 10　　　　　　# 同时允许几个尚未登入的联机画面？当我们连上 SSH ，</span><br><span class="line">　　　　　　　　　　　　　# 但是尚未输入密码时，这个时候就是我们所谓的联机画面啦！</span><br><span class="line">　　　　　　　　　　　　　# 在这个联机画面中，为了保护主机，所以需要设定最大值，</span><br><span class="line">　　　　　　　　　　　　　# 预设最多十个联机画面，而已经建立联机的不计算在这十个当中</span><br></pre></td></tr></table></figure>
<h3 id="关于使用者抵挡的设定项目："><a href="#关于使用者抵挡的设定项目：" class="headerlink" title="关于使用者抵挡的设定项目："></a>关于使用者抵挡的设定项目：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DenyUsers *　　　　　　　 # 设定受抵挡的使用者名称，如果是全部的使用者，那就是全部</span><br><span class="line">　　　　　　　　　　　　　# 挡吧！若是部分使用者，可以将该账号填入！例如下列！</span><br><span class="line">DenyUsers test</span><br><span class="line">DenyGroups test　　　　　 # 与 DenyUsers 相同！仅抵挡几个群组而已！</span><br></pre></td></tr></table></figure>
<h2 id="关于-SFTP-服务的设定项目！"><a href="#关于-SFTP-服务的设定项目！" class="headerlink" title="关于 SFTP 服务的设定项目！"></a>关于 SFTP 服务的设定项目！</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Subsystem       sftp    &#x2F;usr&#x2F;lib&#x2F;ssh&#x2F;sftp-server</span><br></pre></td></tr></table></figure>
<p>　<br>基本上，在您的系统中，『除非有必要，否则请不要更改 /etc/ssh/sshd_config 这个档案的设定值！』因为预设的情况下通常都是最严密的 SSH 保护了，因此，可以不需要更动他！上面的说明仅是在让大家了解每个细项的一些基本内容而已！需要注意的是最后一项，如果您不愿意开放 SFTP 的话，将最后一行批注掉即可！
　</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://hcaijin.com/10ge-hen-you-yong-de-git-ming-ling-zhuan/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ipfs/images/avatar.gif">
      <meta itemprop="name" content="Graz">
      <meta itemprop="description" content="linux,java,php">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="hcaijin.com">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ipfs/10ge-hen-you-yong-de-git-ming-ling-zhuan/" class="post-title-link" itemprop="url">10个很有用的 Git 命令（转）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2016-02-16 21:24:34 / Modified: 21:31:04" itemprop="dateCreated datePublished" datetime="2016-02-16T21:24:34+08:00">2016-02-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="http://blog.sae.sina.com.cn/archives/3003" target="_blank" rel="noopener">转自</a><a href="http://blog.sae.sina.com.cn/archives/3003" target="_blank" rel="noopener">http://blog.sae.sina.com.cn/archives/3003</a></p>
<blockquote>
<p>这里给大家分享一些很有用的 Git 命令，其中很多用法你可能都不知道，无论你是工作在团队环境中或在您的个人项目中，这些命令将对你帮助很大，让你可以更加高效的进行项目开发，更轻松愉快的工作和生活。</p>
</blockquote>
<h3 id="导出最后一次提交修改过的文件"><a href="#导出最后一次提交修改过的文件" class="headerlink" title="导出最后一次提交修改过的文件"></a>导出最后一次提交修改过的文件</h3><p>我一直在使用这个命令定期进行发送给其他人进行审查/整合。这条命令将把近期提交的修改过的文件导出到一个zip文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git archive -o ..&#x2F;updated.zip HEAD $(git diff --name-only HEAD^)</span><br></pre></td></tr></table></figure>
<h3 id="导出两次提交之间修改过的文件"><a href="#导出两次提交之间修改过的文件" class="headerlink" title="导出两次提交之间修改过的文件"></a>导出两次提交之间修改过的文件</h3><p>同样，如果你需要导出两次提交之间修改过的文件，你可以用这一个。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git archive -o ..&#x2F;latest.zip NEW_COMMIT_ID_HERE $(git diff --name-only </span><br><span class="line">OLD_COMMIT_ID_HERE NEW_COMMIT_ID_HERE)</span><br></pre></td></tr></table></figure>
<h3 id="克隆一个特定的远程分支"><a href="#克隆一个特定的远程分支" class="headerlink" title="克隆一个特定的远程分支"></a>克隆一个特定的远程分支</h3><p>如果你想从远程仓库克隆特定的一个分支，这条命令对你很有用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git init </span><br><span class="line"></span><br><span class="line">git remote add -t BRANCH_NAME_HERE -f origin REMOTE_REPO_URL_PATH_HERE </span><br><span class="line"></span><br><span class="line">git checkout BRANCH_NAME_HERE</span><br></pre></td></tr></table></figure>

<h3 id="从无关的本地仓库应用补丁"><a href="#从无关的本地仓库应用补丁" class="headerlink" title="从无关的本地仓库应用补丁"></a>从无关的本地仓库应用补丁</h3><p>如果您需要申请从提交的一些其他不相关的创库到本地存储库，这里是一个快捷的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git --git-dir&#x3D;PATH_TO_OTHER_REPOSITORY_HERE&#x2F;.git format-patch -k -1 --stdout</span><br><span class="line"></span><br><span class="line">COMMIT_HASH_ID_HERE| git am -3 -k</span><br></pre></td></tr></table></figure>

<h3 id="检查您的分支变化是是否其他分支的一部分"><a href="#检查您的分支变化是是否其他分支的一部分" class="headerlink" title="检查您的分支变化是是否其他分支的一部分"></a>检查您的分支变化是是否其他分支的一部分</h3><p>cherry 命令可以让你检查你的分支的变化是否存在于其他一些分支之中。它会显示在当前分支相对于给定的分支的修改，用+或-标志提示提交合并与否。+表示不存在，而-表示存在于给定的分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git cherry -v OTHER_BRANCH_NAME_HERE </span><br><span class="line"></span><br><span class="line">#For example: to check with master branch </span><br><span class="line">git cherry -v master</span><br></pre></td></tr></table></figure>

<h3 id="启动一个无历史的新分支"><a href="#启动一个无历史的新分支" class="headerlink" title="启动一个无历史的新分支"></a>启动一个无历史的新分支</h3><p>有时候，你需要启动一个新的分支，同时想摒弃历史信息，例如，你想将代码放在公共领域（开源）又不想共享历史信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --orphan NEW_BRANCH_NAME_HERE</span><br></pre></td></tr></table></figure>

<h3 id="在不切换分支的情况下从其它分支检出文件"><a href="#在不切换分支的情况下从其它分支检出文件" class="headerlink" title="在不切换分支的情况下从其它分支检出文件"></a>在不切换分支的情况下从其它分支检出文件</h3><p>下面的命令是从其他分支获取文件，而不用切换分支。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout BRANCH_NAME_HERE -- PATH_TO_FILE_IN_BRANCH_HERE</span><br></pre></td></tr></table></figure>

<h3 id="忽略跟踪文件的修改"><a href="#忽略跟踪文件的修改" class="headerlink" title="忽略跟踪文件的修改"></a>忽略跟踪文件的修改</h3><p>如果你工作在一个团队，他们都是工作在同一个分支，你需要频繁的读取/合并文件。但是有时复位了你环境的特定配置，你必须在合并后每一次都再改一下。使用这个命令，你可以忽略更改特定的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git update-index --assume-unchanged PATH_TO_FILE_HERE</span><br></pre></td></tr></table></figure>

<h3 id="检查提交的修改是否发布版本的一部分"><a href="#检查提交的修改是否发布版本的一部分" class="headerlink" title="检查提交的修改是否发布版本的一部分"></a>检查提交的修改是否发布版本的一部分</h3><p>这个 name-rev 命令可以告诉你提交相对于最新发布版本的位置。利用这一点，你可以检查你的变化是否发布版本的一部分。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git name-rev --name-only COMMIT_HASH_HERE</span><br></pre></td></tr></table></figure>

<h3 id="使用-pull-rebase-操作替代-merge"><a href="#使用-pull-rebase-操作替代-merge" class="headerlink" title="使用 pull rebase 操作替代 merge"></a>使用 pull rebase 操作替代 merge</h3><p>如果你工作的团队正工作在同一个分支，那么你所要做的获取/合并或经常拉取。分支合并的 git 记录与合并提交时提示功能分支被并入主干。但在多个团队成员工作的同一分支的情况下，经常合并导致在日志中多个合并的消息引起混乱。所以你可以使用 pull rebase，以保持历史信息清除了无用合并的消息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config branch.BRANCH_NAME_HERE.rebase true</span><br></pre></td></tr></table></figure>
<p>此外，您可以配置一个特定的分支总是衍合：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/ipfs/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/ipfs/">1</a><span class="space">&hellip;</span><a class="page-number" href="/ipfs/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/ipfs/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/ipfs/page/10/">10</a><a class="extend next" rel="next" href="/ipfs/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Graz</p>
  <div class="site-description" itemprop="description">linux,java,php</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/ipfs/archives/">
        
          <span class="site-state-item-count">47</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/ipfs/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hcaijin" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hcaijin" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hcjonline@gmail.com" title="E-Mail → mailto:hcjonline@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://groups.google.com/forum" title="https:&#x2F;&#x2F;groups.google.com&#x2F;forum" rel="noopener" target="_blank">Google 网上论坛</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://programgo.com/" title="http:&#x2F;&#x2F;programgo.com" rel="noopener" target="_blank">软件开发程序员博客文章收藏网</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://bbs.chinaunix.net/" title="http:&#x2F;&#x2F;bbs.chinaunix.net" rel="noopener" target="_blank">论坛-ChinaUnix.net</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://bbs.pediy.com/" title="http:&#x2F;&#x2F;bbs.pediy.com" rel="noopener" target="_blank">看雪安全论坛</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.ibm.com/developerworks/cn" title="http:&#x2F;&#x2F;www.ibm.com&#x2F;developerworks&#x2F;cn" rel="noopener" target="_blank">IBM developerWorks 中国</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.wooyun.org/" title="http:&#x2F;&#x2F;www.wooyun.org" rel="noopener" target="_blank">WooYun.org</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://wiki.backbox.org/" title="http:&#x2F;&#x2F;wiki.backbox.org" rel="noopener" target="_blank">BackBox Wiki</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.freebuf.com/" title="http:&#x2F;&#x2F;www.freebuf.com" rel="noopener" target="_blank">关注黑客与极客</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://mcs.une.edu.au/doc" title="http:&#x2F;&#x2F;mcs.une.edu.au&#x2F;doc" rel="noopener" target="_blank">Linux 在线学习文档</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://stackoverflow.com/" title="http:&#x2F;&#x2F;stackoverflow.com" rel="noopener" target="_blank">程序设计领域的问答网站</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://linuxfromscratch.org/" title="http:&#x2F;&#x2F;linuxfromscratch.org" rel="noopener" target="_blank">Linux 从零开始</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Graz</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/ipfs/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/ipfs/lib/velocity/velocity.min.js"></script>
  <script src="/ipfs/lib/velocity/velocity.ui.min.js"></script>

<script src="/ipfs/js/utils.js"></script>

<script src="/ipfs/js/motion.js"></script>


<script src="/ipfs/js/schemes/muse.js"></script>


<script src="/ipfs/js/next-boot.js"></script>




  




  
<script src="/ipfs/js/local-search.js"></script>













  

  

</body>
</html>
